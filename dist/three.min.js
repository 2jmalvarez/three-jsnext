!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,function(e){"use strict";function t(){console.log.apply(console,arguments)}function r(){console.warn.apply(console,arguments)}function i(){console.error.apply(console,arguments)}function n(){this.isProjector=!0,i("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){r("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){r("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){i("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function a(){this.isCanvasRenderer=!0,i("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}function o(){this.isMatrix4=!0,this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&i("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function s(e,t,r,i){this.isQuaternion=!0,this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1}function h(e,t,r){this.isVector3=!0,this.x=e||0,this.y=t||0,this.z=r||0}function l(){this.isEventDispatcher=!0}function u(e,t,r,i){this.isEuler=!0,this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||u.DefaultOrder}function c(){this.isObject3D=!0,Object.defineProperty(this,"id",{value:d()}),this.uuid=e.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=c.DefaultUp.clone();var t=new h,r=new u,i=new s,n=new h(1,1,1),a=function(){i.setFromEuler(r,!1)},l=function(){r.setFromQuaternion(i,void 0,!1)};r.onChange(a),i.onChange(l),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n}}),this.rotationAutoUpdate=!0,this.matrix=new o,this.matrixWorld=new o,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function d(){return rr++}function f(){this.isCamera=!0,c.call(this),this.type="Camera",this.matrixWorldInverse=new o,this.projectionMatrix=new o}function p(e,t){this.isVector2=!0,this.x=e||0,this.y=t||0}function m(t,r,i){this.isWebGLRenderTarget=!0,this.width=t,this.height=r,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:e.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:e.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:e.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new p(0,0),this.repeat=new p(1,1),this.format=void 0!==i.format?i.format:e.RGBAFormat,this.type=void 0!==i.type?i.type:e.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null}function g(e,t,r){this.isWebGLRenderTargetCube=!0,m.call(this,e,t,r),this.activeCubeFace=0}function v(e,t,r,i){this.isPerspectiveCamera=!0,f.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()}function y(t,r,i){this.isCubeCamera=!0,c.call(this),this.type="CubeCamera";var n=90,a=1,o=new v(n,a,t,r);o.up.set(0,-1,0),o.lookAt(new h(1,0,0)),this.add(o);var s=new v(n,a,t,r);s.up.set(0,-1,0),s.lookAt(new h(-1,0,0)),this.add(s);var l=new v(n,a,t,r);l.up.set(0,0,1),l.lookAt(new h(0,1,0)),this.add(l);var u=new v(n,a,t,r);u.up.set(0,0,-1),u.lookAt(new h(0,-1,0)),this.add(u);var d=new v(n,a,t,r);d.up.set(0,-1,0),d.lookAt(new h(0,0,1)),this.add(d);var f=new v(n,a,t,r);f.up.set(0,-1,0),f.lookAt(new h(0,0,-1)),this.add(f),this.renderTarget=new g(i,i,{format:e.RGBFormat,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,o,r),r.activeCubeFace=1,e.render(t,s,r),r.activeCubeFace=2,e.render(t,l,r),r.activeCubeFace=3,e.render(t,u,r),r.activeCubeFace=4,e.render(t,d,r),r.generateMipmaps=i,r.activeCubeFace=5,e.render(t,f,r)}}function x(e,t,r,i,n,a){this.isOrthographicCamera=!0,f.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function b(e,t){this.isBufferAttribute=!0,this.array=e,this.itemSize=t,this.needsUpdate=!1}function _(e,t){return this.isInt8Attribute=!0,r("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function w(e,t){return this.isUint8Attribute=!0,r("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function M(e,t){return this.isUint8ClampedAttribute=!0,r("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function S(e,t){return this.isInt16Attribute=!0,r("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function T(e,t){return this.isUint16Attribute=!0,r("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function E(e,t){return this.isInt32Attribute=!0,r("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function A(e,t){return this.isUint32Attribute=!0,r("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function C(e,t){return this.isFloat32Attribute=!0,r("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function L(e,t){return this.isFloat64Attribute=!0,r("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new b(e,t)}function R(e){return this.isColor=!0,3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)}function P(e,t,r,i,n,a){this.isFace3=!0,this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new h,this.vertexNormals=i instanceof Array?i:[],this.color=n&&n.isColor?n:new R,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0}function F(){this.isMatrix3=!0,this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&i("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function U(e,t){this.isBox3=!0,this.min=void 0!==e?e:new h(1/0,1/0,1/0),this.max=void 0!==t?t:new h(-(1/0),-(1/0),-(1/0))}function D(e,t){this.isSphere=!0,this.center=void 0!==e?e:new h,this.radius=void 0!==t?t:0}function B(e,t,r,i){this.isVector4=!0,this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}function z(){this.isGeometry=!0,Object.defineProperty(this,"id",{value:k()}),this.uuid=e.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function k(){return ir++}function N(){this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:k()}),this.uuid=e.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null}function O(e){this.isClock=!0,this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function I(e,t){this.isDynamicBufferAttribute=!0,b.call(this,e,t),this.updateRange={offset:0,count:-1}}function H(e,t,i,n,a,o,s){return this.isFace4=!0,r("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new P(e,t,i,a,o,s)}function V(){this.isCurve=!0}function W(e,t){this.isLineCurve=!0,this.v1=e,this.v2=t}function G(){this.isCurvePath=!0,this.curves=[],this.bends=[],this.autoClose=!1}function j(e,t,r){this.isQuadraticBezierCurve=!0,this.v0=e,this.v1=t,this.v2=r}function X(e,t,r,i){this.isCubicBezierCurve=!0,this.v0=e,this.v1=t,this.v2=r,this.v3=i}function q(e){this.isSplineCurve=!0,this.points=void 0==e?[]:e}function Y(e,t,r,i,n,a,o){this.isEllipseCurve=!0,this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o}function K(e){this.isPath=!0,G.call(this),this.actions=[],e&&this.fromPoints(e)}function Z(e,t,r,i,n,a){function o(e,t,r){return F.vertices.push(new h(e,t,r))-1}this.isTubeGeometry=!0,z.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:n},t=t||64,r=r||1,i=i||8,n=n||!1,a=a||Z.NoTaper;var s,l,u,c,d,f,m,g,v,y,x,b,_,w,M,S,T,E,A,C,L,R=[],F=this,U=t+1,D=new h,B=new Z.FrenetFrames(e,t,n),k=B.tangents,N=B.normals,O=B.binormals;for(this.tangents=k,this.normals=N,this.binormals=O,y=0;U>y;y++)for(R[y]=[],c=y/(U-1),v=e.getPointAt(c),s=k[y],l=N[y],u=O[y],f=r*a(c),x=0;i>x;x++)d=x/i*2*Math.PI,m=-f*Math.cos(d),g=f*Math.sin(d),D.copy(v),D.x+=m*l.x+g*u.x,D.y+=m*l.y+g*u.y,D.z+=m*l.z+g*u.z,R[y][x]=o(D.x,D.y,D.z);for(y=0;t>y;y++)for(x=0;i>x;x++)b=n?(y+1)%t:y+1,_=(x+1)%i,w=R[y][x],M=R[b][x],S=R[b][_],T=R[y][_],E=new p(y/t,x/i),A=new p((y+1)/t,x/i),C=new p((y+1)/t,(x+1)/i),L=new p(y/t,(x+1)/i),this.faces.push(new P(w,M,T)),this.faceVertexUvs[0].push([E,A,L]),this.faces.push(new P(M,S,T)),this.faceVertexUvs[0].push([A.clone(),C,L.clone()]);this.computeFaceNormals(),this.computeVertexNormals()}function Q(e,t){return this.isExtrudeGeometry=!0,"undefined"==typeof e?void(e=[]):(z.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())}function J(e,t){this.isShapeGeometry=!0,z.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()}function $(){this.isShape=!0,K.apply(this,arguments),this.holes=[]}function ee(t,r,i,n,a,o,s,h,l){this.isTexture=!0,Object.defineProperty(this,"id",{value:te()}),this.uuid=e.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==t?t:ee.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==r?r:ee.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:e.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:e.ClampToEdgeWrapping,this.magFilter=void 0!==a?a:e.LinearFilter,this.minFilter=void 0!==o?o:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:e.RGBAFormat,this.type=void 0!==h?h:e.UnsignedByteType,this.offset=new p(0,0),this.repeat=new p(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null}function te(){return nr++}function re(e,t,r,i,n,a,o,s,h,l,u){this.isDataTexture=!0,ee.call(this,null,a,o,s,h,l,i,n,u),this.image={data:e,width:t,height:r}}function ie(t,r,i,n,a,o,s,h,l){this.isCubeTexture=!0,r=void 0!==r?r:e.CubeReflectionMapping,ee.call(this,t,r,i,n,a,o,s,h,l),this.images=t}function ne(e,t,r){this.isLoadingManager=!0;var i=this,n=0,a=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(){a++},this.itemEnd=function(e){n++,void 0!==i.onProgress&&i.onProgress(e,n,a),n===a&&void 0!==i.onLoad&&i.onLoad()}}function ae(t){this.isImageLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function oe(){this.isMaterial=!0,Object.defineProperty(this,"id",{value:se()}),this.uuid=e.Math.generateUUID(),this.name="",this.type="Material",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function se(){return ar++}function he(t){this.isMeshBasicMaterial=!0,oe.call(this),this.type="MeshBasicMaterial",this.color=new R(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)}function le(e,t){this.isPlane=!0,this.normal=void 0!==e?e:new h(1,0,0),this.constant=void 0!==t?t:0}function ue(e,t,r){this.isTriangle=!0,this.a=void 0!==e?e:new h,this.b=void 0!==t?t:new h,this.c=void 0!==r?r:new h}function ce(e,t){this.isRay=!0,this.origin=void 0!==e?e:new h,this.direction=void 0!==t?t:new h}function de(e,t){this.isMesh=!0,c.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new z,this.material=void 0!==t?t:new he({color:16777215*Math.random()}),this.updateMorphTargets()}function fe(t,r){this.isAnimation=!0,this.root=t,this.data=e.AnimationHandler.init(r),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=e.AnimationHandler.LINEAR}function pe(t){this.isKeyFrameAnimation=!0,this.root=t.node,this.data=e.AnimationHandler.init(t),this.hierarchy=e.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var r=0,i=this.hierarchy.length;i>r;r++){var n=this.data.hierarchy[r].keys,a=this.data.hierarchy[r].sids,o=this.hierarchy[r];if(n.length&&a){for(var s=0;s<a.length;s++){var h=a[s],l=this.getNextKeyWith(h,r,0);l&&l.apply(h)}o.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}}function me(e){this.isMorphAnimation=!0,this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1}function ge(e){this.isAudio=!0,c.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1}function ve(){this.isAudioListener=!0,c.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)}function ye(){this.isGyroscope=!0,c.call(this)}function xe(e,t,r,i,n,a){this.isArcCurve=!0,Y.call(this,e,t,r,r,i,n,a)}function be(e,t,r,i,n,a){function o(e,t,r,i,n,a,o,l){var u,c,d,f=s.widthSegments,m=s.heightSegments,g=n/2,v=a/2,y=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?u="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(u="y",m=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(u="x",f=s.depthSegments);var x=f+1,b=m+1,_=n/f,w=a/m,M=new h;for(M[u]=o>0?1:-1,d=0;b>d;d++)for(c=0;x>c;c++){var S=new h;S[e]=(c*_-g)*r,S[t]=(d*w-v)*i,S[u]=o,s.vertices.push(S)}for(d=0;m>d;d++)for(c=0;f>c;c++){var T=c+x*d,E=c+x*(d+1),A=c+1+x*(d+1),C=c+1+x*d,L=new p(c/f,1-d/m),R=new p(c/f,1-(d+1)/m),F=new p((c+1)/f,1-(d+1)/m),U=new p((c+1)/f,1-d/m),D=new P(T+y,E+y,C+y);D.normal.copy(M),D.vertexNormals.push(M.clone(),M.clone(),M.clone()),D.materialIndex=l,s.faces.push(D),s.faceVertexUvs[0].push([L,R,U]),D=new P(E+y,A+y,C+y),D.normal.copy(M),D.vertexNormals.push(M.clone(),M.clone(),M.clone()),D.materialIndex=l,s.faces.push(D),s.faceVertexUvs[0].push([R.clone(),F,U.clone()])}}this.isBoxGeometry=!0,z.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=a||1;var s=this,l=e/2,u=t/2,c=r/2;o("z","y",-1,-1,r,t,l,0),o("z","y",1,-1,r,t,-l,1),o("x","z",1,1,e,r,u,2),o("x","z",1,-1,e,r,-u,3),o("x","y",1,-1,e,t,c,4),o("x","y",-1,-1,e,t,-c,5),this.mergeVertices()}function _e(e,t,r,i){this.isCircleGeometry=!0,z.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n,a=[],o=new h,s=new p(.5,.5);for(this.vertices.push(o),a.push(s),n=0;t>=n;n++){var l=new h,u=r+n/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),this.vertices.push(l),a.push(new p((l.x/e+1)/2,(l.y/e+1)/2))}var c=new h(0,0,1);for(n=1;t>=n;n++)this.faces.push(new P(n,n+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([a[n].clone(),a[n+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new D(new h,e)}function we(e,t,i,n,a,o){return this.isCubeGeometry=!0,r("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new be(e,t,i,n,a,o)}function Me(e,t,r,i,n,a,o,s){this.isCylinderGeometry=!0,z.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,i=i||8,n=n||1,a=void 0!==a?a:!1,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var l,u,c=r/2,d=[],f=[];for(u=0;n>=u;u++){var m=[],g=[],v=u/n,y=v*(t-e)+e;for(l=0;i>=l;l++){var x=l/i,b=new h;b.x=y*Math.sin(x*s+o),b.y=-v*r+c,b.z=y*Math.cos(x*s+o),this.vertices.push(b),m.push(this.vertices.length-1),g.push(new p(x,1-v))}d.push(m),f.push(g)}var _,w,M=(t-e)/r;for(l=0;i>l;l++)for(0!==e?(_=this.vertices[d[0][l]].clone(),w=this.vertices[d[0][l+1]].clone()):(_=this.vertices[d[1][l]].clone(),w=this.vertices[d[1][l+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*M).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*M).normalize(),u=0;n>u;u++){var S=d[u][l],T=d[u+1][l],E=d[u+1][l+1],A=d[u][l+1],C=_.clone(),L=_.clone(),R=w.clone(),F=w.clone(),U=f[u][l].clone(),D=f[u+1][l].clone(),B=f[u+1][l+1].clone(),k=f[u][l+1].clone();this.faces.push(new P(S,T,A,[C,L,F])),this.faceVertexUvs[0].push([U,D,k]),this.faces.push(new P(T,E,A,[L.clone(),R,F.clone()])),this.faceVertexUvs[0].push([D.clone(),B,k.clone()])}if(a===!1&&e>0)for(this.vertices.push(new h(0,c,0)),l=0;i>l;l++){var S=d[0][l],T=d[0][l+1],E=this.vertices.length-1,C=new h(0,1,0),L=new h(0,1,0),R=new h(0,1,0),U=f[0][l].clone(),D=f[0][l+1].clone(),B=new p(D.x,0);this.faces.push(new P(S,T,E,[C,L,R])),this.faceVertexUvs[0].push([U,D,B])}if(a===!1&&t>0)for(this.vertices.push(new h(0,-c,0)),l=0;i>l;l++){var S=d[n][l+1],T=d[n][l],E=this.vertices.length-1,C=new h(0,-1,0),L=new h(0,-1,0),R=new h(0,-1,0),U=f[n][l+1].clone(),D=f[n][l].clone(),B=new p(D.x,1);this.faces.push(new P(S,T,E,[C,L,R])),this.faceVertexUvs[0].push([U,D,B])}this.computeFaceNormals()}function Se(e,t,r,i){function n(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var r=s(e)/2/Math.PI+.5,i=l(e)/Math.PI+.5;return t.uv=new p(r,1-i),t}function a(e,t,r){var i=new P(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);c.faces.push(i),_.copy(e).add(t).add(r).divideScalar(3);var n=s(_);c.faceVertexUvs[0].push([u(e.uv,e,n),u(t.uv,t,n),u(r.uv,r,n)])}function o(e,t){for(var r=Math.pow(2,t),i=n(c.vertices[e.a]),o=n(c.vertices[e.b]),s=n(c.vertices[e.c]),h=[],l=0;r>=l;l++){h[l]=[];for(var u=n(i.clone().lerp(s,l/r)),d=n(o.clone().lerp(s,l/r)),f=r-l,p=0;f>=p;p++)h[l][p]=0==p&&l==r?u:n(u.clone().lerp(d,p/f))}for(var l=0;r>l;l++)for(var p=0;2*(r-l)-1>p;p++){var m=Math.floor(p/2);p%2==0?a(h[l][m+1],h[l+1][m],h[l][m]):a(h[l][m+1],h[l+1][m+1],h[l+1][m])}}function s(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function u(e,t,r){return 0>r&&1===e.x&&(e=new p(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new p(r/2/Math.PI+.5,e.y)),e.clone()}this.isPolyhedronGeometry=!0,z.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;for(var c=this,d=0,f=e.length;f>d;d+=3)n(new h(e[d],e[d+1],e[d+2]));for(var m=this.vertices,g=[],d=0,v=0,f=t.length;f>d;d+=3,v++){var y=m[t[d]],x=m[t[d+1]],b=m[t[d+2]];g[v]=new P(y.index,x.index,b.index,[y.clone(),x.clone(),b.clone()])}for(var _=new h,d=0,f=g.length;f>d;d++)o(g[d],i);for(var d=0,f=this.faceVertexUvs[0].length;f>d;d++){var w=this.faceVertexUvs[0][d],M=w[0].x,S=w[1].x,T=w[2].x,E=Math.max(M,Math.max(S,T)),A=Math.min(M,Math.min(S,T));E>.9&&.1>A&&(.2>M&&(w[0].x+=1),.2>S&&(w[1].x+=1),.2>T&&(w[2].x+=1))}for(var d=0,f=this.vertices.length;f>d;d++)this.vertices[d].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new D(new h,r)}function Te(e,t){this.isDodecahedronGeometry=!0,this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Se.call(this,n,a,e,t)}function Ee(e,t){this.isIcosahedronGeometry=!0;var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Se.call(this,i,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}function Ae(e,t,r,i){this.isLatheGeometry=!0,z.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),a=1/t,o=0,s=t;s>=o;o++)for(var l=r+o*a*i,u=Math.cos(l),c=Math.sin(l),d=0,f=e.length;f>d;d++){var m=e[d],g=new h;g.x=u*m.x-c*m.y,g.y=c*m.x+u*m.y,g.z=m.z,this.vertices.push(g)}for(var v=e.length,o=0,s=t;s>o;o++)for(var d=0,f=e.length-1;f>d;d++){var y=d+v*o,x=y,b=y+v,u=y+1+v,_=y+1,w=o*a,M=d*n,S=w+a,T=M+n;this.faces.push(new P(x,b,_)),this.faceVertexUvs[0].push([new p(w,M),new p(S,M),new p(w,T)]),this.faces.push(new P(b,u,_)),this.faceVertexUvs[0].push([new p(S,M),new p(S,T),new p(w,T)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()}function Ce(e,t){this.isOctahedronGeometry=!0,this.parameters={radius:e,detail:t};var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Se.call(this,r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}function Le(e,t,r){this.isParametricGeometry=!0,z.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,a,o,s,h=this.vertices,l=this.faces,u=this.faceVertexUvs[0],c=t+1;for(i=0;r>=i;i++)for(s=i/r,n=0;t>=n;n++)o=n/t,a=e(o,s),h.push(a);var d,f,m,g,v,y,x,b;for(i=0;r>i;i++)for(n=0;t>n;n++)d=i*c+n,f=i*c+n+1,m=(i+1)*c+n+1,g=(i+1)*c+n,v=new p(n/t,i/r),y=new p((n+1)/t,i/r),x=new p((n+1)/t,(i+1)/r),b=new p(n/t,(i+1)/r),l.push(new P(d,f,g)),u.push([v,y,b]),l.push(new P(f,m,g)),u.push([y.clone(),x,b.clone()]);this.computeFaceNormals(),this.computeVertexNormals()}function Re(e,t,r,i){this.isPlaneBufferGeometry=!0,N.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};for(var n=e/2,a=t/2,o=r||1,s=i||1,h=o+1,l=s+1,u=e/o,c=t/s,d=new Float32Array(h*l*3),f=new Float32Array(h*l*3),p=new Float32Array(h*l*2),m=0,g=0,v=0;l>v;v++)for(var y=v*c-a,x=0;h>x;x++){var _=x*u-n;d[m]=_,d[m+1]=-y,f[m+2]=1,p[g]=x/o,p[g+1]=1-v/s,m+=3,g+=2}m=0;for(var w=new(d.length/3>65535?Uint32Array:Uint16Array)(o*s*6),v=0;s>v;v++)for(var x=0;o>x;x++){var M=x+h*v,S=x+h*(v+1),T=x+1+h*(v+1),E=x+1+h*v;w[m]=M,w[m+1]=S,w[m+2]=E,w[m+3]=S,w[m+4]=T,w[m+5]=E,m+=6}this.addAttribute("index",new b(w,1)),this.addAttribute("position",new b(d,3)),this.addAttribute("normal",new b(f,3)),this.addAttribute("uv",new b(p,2))}function Pe(e,t,r,i){this.isPlaneGeometry=!0,console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),z.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new Re(e,t,r,i))}function Fe(e,t,r,i,n,a){this.isRingGeometry=!0,z.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},e=e||0,t=t||50,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):8;var o,s,l=[],u=e,c=(t-e)/i;for(o=0;i+1>o;o++){for(s=0;r+1>s;s++){var d=new h,f=n+s/r*a;d.x=u*Math.cos(f),d.y=u*Math.sin(f),this.vertices.push(d),l.push(new p((d.x/t+1)/2,(d.y/t+1)/2))}u+=c}var m=new h(0,0,1);for(o=0;i>o;o++){var g=o*(r+1);for(s=0;r>s;s++){var f=s+g,v=f,y=f+r+1,x=f+r+2;this.faces.push(new P(v,y,x,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[y].clone(),l[x].clone()]),v=f,y=f+r+2,x=f+1,this.faces.push(new P(v,y,x,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[y].clone(),l[x].clone()])}}this.computeFaceNormals(),this.boundingSphere=new D(new h,u)}function Ue(e,t,r,i,n,a,o){this.isSphereGeometry=!0,z.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,u=[],c=[];for(l=0;r>=l;l++){var d=[],f=[];for(s=0;t>=s;s++){var m=s/t,g=l/r,v=new h;v.x=-e*Math.cos(i+m*n)*Math.sin(a+g*o),v.y=e*Math.cos(a+g*o),v.z=e*Math.sin(i+m*n)*Math.sin(a+g*o),this.vertices.push(v),d.push(this.vertices.length-1),f.push(new p(m,1-g))}u.push(d),c.push(f)}for(l=0;r>l;l++)for(s=0;t>s;s++){var y=u[l][s+1],x=u[l][s],b=u[l+1][s],_=u[l+1][s+1],w=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),S=this.vertices[b].clone().normalize(),T=this.vertices[_].clone().normalize(),E=c[l][s+1].clone(),A=c[l][s].clone(),C=c[l+1][s].clone(),L=c[l+1][s+1].clone();Math.abs(this.vertices[y].y)===e?(E.x=(E.x+A.x)/2,this.faces.push(new P(y,b,_,[w,S,T])),this.faceVertexUvs[0].push([E,C,L])):Math.abs(this.vertices[b].y)===e?(C.x=(C.x+L.x)/2,this.faces.push(new P(y,x,b,[w,M,S])),this.faceVertexUvs[0].push([E,A,C])):(this.faces.push(new P(y,x,_,[w,M,T])),this.faceVertexUvs[0].push([E,A,L]),this.faces.push(new P(x,b,_,[M.clone(),S,T.clone()])),this.faceVertexUvs[0].push([A.clone(),C,L.clone()]))}this.computeFaceNormals(),this.boundingSphere=new D(new h,e)}function De(e,t){this.isTetrahedronGeometry=!0;var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];Se.call(this,r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}function Be(t,r){this.isTextGeometry=!0,r=r||{};var i=e.FontUtils.generateShapes(t,r);r.amount=void 0!==r.height?r.height:50,void 0===r.bevelThickness&&(r.bevelThickness=10),void 0===r.bevelSize&&(r.bevelSize=8),void 0===r.bevelEnabled&&(r.bevelEnabled=!1),Q.call(this,i,r),this.type="TextGeometry"}function ze(e,t,r,i,n){this.isTorusGeometry=!0,z.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||100,t=t||40,r=r||8,i=i||6,n=n||2*Math.PI;for(var a=new h,o=[],s=[],l=0;r>=l;l++)for(var u=0;i>=u;u++){var c=u/i*n,d=l/r*Math.PI*2;a.x=e*Math.cos(c),a.y=e*Math.sin(c);var f=new h;f.x=(e+t*Math.cos(d))*Math.cos(c),f.y=(e+t*Math.cos(d))*Math.sin(c),f.z=t*Math.sin(d),this.vertices.push(f),o.push(new p(u/i,l/r)),s.push(f.clone().sub(a).normalize())}for(var l=1;r>=l;l++)for(var u=1;i>=u;u++){var m=(i+1)*l+u-1,g=(i+1)*(l-1)+u-1,v=(i+1)*(l-1)+u,y=(i+1)*l+u,x=new P(m,g,y,[s[m].clone(),s[g].clone(),s[y].clone()]);this.faces.push(x),this.faceVertexUvs[0].push([o[m].clone(),o[g].clone(),o[y].clone()]),x=new P(g,v,y,[s[g].clone(),s[v].clone(),s[y].clone()]),this.faces.push(x),this.faceVertexUvs[0].push([o[g].clone(),o[v].clone(),o[y].clone()])}this.computeFaceNormals()}function ke(e,t,r,i,n,a,o){function s(e,t,r,i,n){var a=Math.cos(e),o=Math.sin(e),s=t/r*e,l=Math.cos(s),u=i*(2+l)*.5*a,c=i*(2+l)*o*.5,d=n*i*Math.sin(s)*.5;return new h(u,c,d)}this.isTorusKnotGeometry=!0,z.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,p:n,q:a,heightScale:o},e=e||100,t=t||40,r=r||64,i=i||8,n=n||2,a=a||3,o=o||1;for(var l=new Array(r),u=new h,c=new h,d=new h,f=0;r>f;++f){l[f]=new Array(i);var m=f/r*2*n*Math.PI,g=s(m,a,n,e,o),v=s(m+.01,a,n,e,o);u.subVectors(v,g),c.addVectors(v,g),d.crossVectors(u,c),c.crossVectors(d,u),d.normalize(),c.normalize();for(var y=0;i>y;++y){var x=y/i*2*Math.PI,b=-t*Math.cos(x),_=t*Math.sin(x),w=new h;w.x=g.x+b*c.x+_*d.x,w.y=g.y+b*c.y+_*d.y,w.z=g.z+b*c.z+_*d.z,l[f][y]=this.vertices.push(w)-1}}for(var f=0;r>f;++f)for(var y=0;i>y;++y){var M=(f+1)%r,S=(y+1)%i,T=l[f][y],E=l[M][y],A=l[M][S],C=l[f][S],L=new p(f/r,y/i),R=new p((f+1)/r,y/i),F=new p((f+1)/r,(y+1)/i),U=new p(f/r,(y+1)/i);this.faces.push(new P(T,E,C)),this.faceVertexUvs[0].push([L,R,U]),this.faces.push(new P(E,A,C)),this.faceVertexUvs[0].push([R.clone(),F,U.clone()])}this.computeFaceNormals(),this.computeVertexNormals()}function Ne(t){this.isLineBasicMaterial=!0,oe.call(this),this.type="LineBasicMaterial",this.color=new R(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=e.NoColors,this.fog=!0,this.setValues(t)}function Oe(t,r,i){this.isLine=!0,c.call(this),this.type="Line",this.geometry=void 0!==t?t:new z,this.material=void 0!==r?r:new Ne({color:16777215*Math.random()}),this.mode=void 0!==i?i:e.LineStrip}function Ie(t){this.isAxisHelper=!0,t=t||1;var r=new Float32Array([0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new N;n.addAttribute("position",new b(r,3)),n.addAttribute("color",new b(i,3));var a=new Ne({vertexColors:e.VertexColors});Oe.call(this,n,a,e.LinePieces)}function He(e,t){this.isBoundingBoxHelper=!0;var r=void 0!==t?t:8947848;this.object=e,this.box=new U,de.call(this,new be(1,1,1),new he({color:r,wireframe:!0}))}function Ve(t){this.isBoxHelper=!0;var r=new N;r.addAttribute("position",new b(new Float32Array(72),3)),Oe.call(this,r,new Ne({color:16776960}),e.LinePieces),void 0!==t&&this.update(t)}function We(t){function r(e,t,r){i(e,r),i(t,r)}function i(e,t){n.vertices.push(new h),n.colors.push(new R(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}this.isCameraHelper=!0;var n=new z,a=new Ne({color:16777215,vertexColors:e.FaceColors}),o={},s=16755200,l=16711680,u=43775,c=16777215,d=3355443;r("n1","n2",s),r("n2","n4",s),r("n4","n3",s),r("n3","n1",s),r("f1","f2",s),r("f2","f4",s),r("f4","f3",s),r("f3","f1",s),r("n1","f1",s),r("n2","f2",s),r("n3","f3",s),r("n4","f4",s),r("p","n1",l),r("p","n2",l),r("p","n3",l),r("p","n4",l),r("u1","u2",u),r("u2","u3",u),r("u3","u1",u),r("c","t",c),r("p","c",d),r("cn1","cn2",d),r("cn3","cn4",d),r("cf1","cf2",d),r("cf3","cf4",d),Oe.call(this,n,a,e.LinePieces),this.camera=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Ge(e,t){this.isDirectionalLightHelper=!0,c.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new z;r.vertices.push(new h(-t,t,0),new h(t,t,0),new h(t,-t,0),new h(-t,-t,0),new h(-t,t,0));

var i=new Ne({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new Oe(r,i),this.add(this.lightPlane),r=new z,r.vertices.push(new h,new h),i=new Ne({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new Oe(r,i),this.add(this.targetLine),this.update()}function je(t,r,i){this.isEdgesHelper=!0;var n=void 0!==r?r:16777215;i=void 0!==i?i:1;var a,o=Math.cos(e.Math.degToRad(i)),s=[0,0],h={},l=function(e,t){return e-t},u=["a","b","c"],c=new N;t.geometry&&t.geometry.isBufferGeometry?(a=new z,a.fromBufferGeometry(t.geometry)):a=t.geometry.clone(),a.mergeVertices(),a.computeFaceNormals();for(var d=a.vertices,f=a.faces,p=0,m=0,g=f.length;g>m;m++)for(var v=f[m],y=0;3>y;y++){s[0]=v[u[y]],s[1]=v[u[(y+1)%3]],s.sort(l);var x=s.toString();void 0===h[x]?(h[x]={vert1:s[0],vert2:s[1],face1:m,face2:void 0},p++):h[x].face2=m}var _=new Float32Array(2*p*3),w=0;for(var x in h){var M=h[x];if(void 0===M.face2||f[M.face1].normal.dot(f[M.face2].normal)<=o){var S=d[M.vert1];_[w++]=S.x,_[w++]=S.y,_[w++]=S.z,S=d[M.vert2],_[w++]=S.x,_[w++]=S.y,_[w++]=S.z}}c.addAttribute("position",new b(_,3)),Oe.call(this,c,new Ne({color:n}),e.LinePieces),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Xe(t,r,i,n){this.isFaceNormalsHelper=!0,this.object=t,this.size=void 0!==r?r:1;for(var a=void 0!==i?i:16776960,o=void 0!==n?n:1,s=new z,l=this.object.geometry.faces,u=0,c=l.length;c>u;u++)s.vertices.push(new h,new h);Oe.call(this,s,new Ne({color:a,linewidth:o}),e.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new F,this.update()}function qe(t,r){this.isGridHelper=!0;var i=new z,n=new Ne({vertexColors:e.VertexColors});this.color1=new R(4473924),this.color2=new R(8947848);for(var a=-t;t>=a;a+=r){i.vertices.push(new h(-t,0,a),new h(t,0,a),new h(a,0,-t),new h(a,0,t));var o=0===a?this.color1:this.color2;i.colors.push(o,o,o,o)}Oe.call(this,i,n,e.LinePieces)}function Ye(t,r){this.isHemisphereLightHelper=!0,c.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new R,new R];var i=new Ue(r,4,2);i.applyMatrix((new o).makeRotationX(-Math.PI/2));for(var n=0,a=8;a>n;n++)i.faces[n].color=this.colors[4>n?0:1];var s=new he({vertexColors:e.FaceColors,wireframe:!0});this.lightSphere=new de(i,s),this.add(this.lightSphere),this.update()}function Ke(e,t){this.isPointLightHelper=!0,this.light=e,this.light.updateMatrixWorld();var r=new Ue(t,4,2),i=new he({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),de.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function Ze(t){this.isSkeletonHelper=!0,this.bones=this.getBoneList(t);for(var r=new z,i=0;i<this.bones.length;i++){var n=this.bones[i];n.parent&&n.parent.isBone&&(r.vertices.push(new h),r.vertices.push(new h),r.colors.push(new R(0,0,1)),r.colors.push(new R(0,1,0)))}var a=new Ne({vertexColors:e.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});Oe.call(this,r,a,e.LinePieces),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Qe(e){this.isSpotLightHelper=!0,c.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new Me(0,1,1,8,1,!0);t.applyMatrix((new o).makeTranslation(0,-.5,0)),t.applyMatrix((new o).makeRotationX(-Math.PI/2));var r=new he({wireframe:!0,fog:!1});this.cone=new de(t,r),this.add(this.cone),this.update()}function Je(t,r,i,n){this.isVertexNormalsHelper=!0,this.object=t,this.size=void 0!==r?r:1;for(var a=void 0!==i?i:16711680,o=void 0!==n?n:1,s=new z,l=t.geometry.faces,u=0,c=l.length;c>u;u++)for(var d=l[u],f=0,p=d.vertexNormals.length;p>f;f++)s.vertices.push(new h,new h);Oe.call(this,s,new Ne({color:a,linewidth:o}),e.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new F,this.update()}function $e(t,r,i,n){this.isVertexTangentsHelper=!0,this.object=t,this.size=void 0!==r?r:1;for(var a=void 0!==i?i:255,o=void 0!==n?n:1,s=new z,l=t.geometry.faces,u=0,c=l.length;c>u;u++)for(var d=l[u],f=0,p=d.vertexTangents.length;p>f;f++)s.vertices.push(new h),s.vertices.push(new h);Oe.call(this,s,new Ne({color:a,linewidth:o}),e.LinePieces),this.matrixAutoUpdate=!1,this.update()}function et(t,r){this.isWireframeHelper=!0;var i=void 0!==r?r:16777215,n=[0,0],a={},o=function(e,t){return e-t},s=["a","b","c"],h=new N;if(t.geometry&&t.geometry.isGeometry){for(var l=t.geometry.vertices,u=t.geometry.faces,c=0,d=new Uint32Array(6*u.length),f=0,p=u.length;p>f;f++)for(var m=u[f],g=0;3>g;g++){n[0]=m[s[g]],n[1]=m[s[(g+1)%3]],n.sort(o);var v=n.toString();void 0===a[v]&&(d[2*c]=n[0],d[2*c+1]=n[1],a[v]=!0,c++)}for(var y=new Float32Array(2*c*3),f=0,p=c;p>f;f++)for(var g=0;2>g;g++){var x=l[d[2*f+g]],_=6*f+3*g;y[_+0]=x.x,y[_+1]=x.y,y[_+2]=x.z}h.addAttribute("position",new b(y,3))}else if(t.geometry&&t.geometry.isBufferGeometry)if(void 0!==t.geometry.attributes.index){var l=t.geometry.attributes.position.array,w=t.geometry.attributes.index.array,M=t.geometry.drawcalls,c=0;0===M.length&&(M=[{count:w.length,index:0,start:0}]);for(var d=new Uint32Array(2*w.length),S=0,T=M.length;T>S;++S)for(var E=M[S].start,A=M[S].count,_=M[S].index,f=E,C=E+A;C>f;f+=3)for(var g=0;3>g;g++){n[0]=_+w[f+g],n[1]=_+w[f+(g+1)%3],n.sort(o);var v=n.toString();void 0===a[v]&&(d[2*c]=n[0],d[2*c+1]=n[1],a[v]=!0,c++)}for(var y=new Float32Array(2*c*3),f=0,p=c;p>f;f++)for(var g=0;2>g;g++){var _=6*f+3*g,L=3*d[2*f+g];y[_+0]=l[L],y[_+1]=l[L+1],y[_+2]=l[L+2]}h.addAttribute("position",new b(y,3))}else{for(var l=t.geometry.attributes.position.array,c=l.length/3,R=c/3,y=new Float32Array(2*c*3),f=0,p=R;p>f;f++)for(var g=0;3>g;g++){var _=18*f+6*g,P=9*f+3*g;y[_+0]=l[P],y[_+1]=l[P+1],y[_+2]=l[P+2];var L=9*f+3*((g+1)%3);y[_+3]=l[L],y[_+4]=l[L+1],y[_+5]=l[L+2]}h.addAttribute("position",new b(y,3))}Oe.call(this,h,new Ne({color:i}),e.LinePieces),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function tt(){this.isImmediateRenderObject=!0,c.call(this),this.render=function(){}}function rt(e,t){this.isMorphBlendMesh=!0,de.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",n=0,a=r-1,o=r/1;this.createAnimation(i,n,a,o),this.setAnimationWeight(i,1)}function it(e){this.isLight=!0,c.call(this),this.type="Light",this.color=new R(e)}function nt(e){this.isAmbientLight=!0,it.call(this,e),this.type="AmbientLight"}function at(e,t){this.isAreaLight=!0,it.call(this,e),this.type="AreaLight",this.normal=new h(0,-1,0),this.right=new h(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1}function ot(e,t){this.isDirectionalLight=!0,it.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new c,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new h(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null}function st(e,t,r){this.isHemisphereLight=!0,it.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new R(t),this.intensity=void 0!==r?r:1}function ht(e,t,r,i){this.isPointLight=!0,it.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1}function lt(e,t,r,i,n,a){this.isSpotLight=!0,it.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new c,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==a?a:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null}function ut(t){this.isXHRLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function ct(t){this.isBufferGeometryLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function dt(e,t,r,i,n,a,o,s,h,l,u){this.isCompressedTexture=!0,ee.call(this,null,a,o,s,h,l,i,n,u),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function ft(){this.isCompressedTextureLoader=!0,this._parser=null}function pt(t){this.isGeometryLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function mt(e){this.isLoader=!0,this.showStatus=e,this.statusDomElement=e?mt.prototype.addStatusElement():null,this.imageLoader=new ae,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function gt(e){this.isJSONLoader=!0,mt.call(this,e),this.withCredentials=!1}function vt(t){this.isMaterialLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function yt(){this.isGroup=!0,c.call(this),this.type="Group"}function xt(e){this.isSpriteMaterial=!0,oe.call(this),this.type="SpriteMaterial",this.color=new R(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)}function bt(t){this.isPointCloudMaterial=!0,oe.call(this),this.type="PointCloudMaterial",this.color=new R(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=e.NoColors,this.fog=!0,this.setValues(t)}function _t(e){return this.isParticleBasicMaterial=!0,r("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new bt(e)}function wt(e){return this.isParticleSystemMaterial=!0,r("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new bt(e)}function Mt(e,t){this.isPointCloud=!0,c.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new z,this.material=void 0!==t?t:new bt({color:16777215*Math.random()})}function St(e,t){return this.isParticleSystem=!0,r("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new Mt(e,t)}function Tt(){this.isScene=!0,c.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Et(t){this.isObjectLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager,this.texturePath=""}function At(t){this.isTextureLoader=!0,this.manager=void 0!==t?t:e.DefaultLoadingManager}function Ct(e){this.isLineDashedMaterial=!0,oe.call(this),this.type="LineDashedMaterial",this.color=new R(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)}function Lt(e){this.isMeshDepthMaterial=!0,oe.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}function Rt(t){this.isMeshFaceMaterial=!0,this.uuid=e.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=t instanceof Array?t:[]}function Pt(t){this.isMeshLambertMaterial=!0,oe.call(this),this.type="MeshLambertMaterial",this.color=new R(16777215),this.emissive=new R(0),this.wrapAround=!1,this.wrapRGB=new h(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ft(e){this.isMeshNormalMaterial=!0,oe.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)}function Ut(t){this.isMeshPhongMaterial=!0,oe.call(this),this.type="MeshPhongMaterial",this.color=new R(16777215),this.emissive=new R(0),this.specular=new R(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new h(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new p(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Dt(t){this.isShaderMaterial=!0,oe.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=e.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(t)}function Bt(e){this.isRawShaderMaterial=!0,Dt.call(this,e),this.type="RawShaderMaterial"}function zt(e,t){this.isBox2=!0,this.min=void 0!==e?e:new p(1/0,1/0),this.max=void 0!==t?t:new p(-(1/0),-(1/0))}function kt(e,t,r,i,n,a){this.isFrustum=!0,this.planes=[void 0!==e?e:new le,void 0!==t?t:new le,void 0!==r?r:new le,void 0!==i?i:new le,void 0!==n?n:new le,void 0!==a?a:new le]}function Nt(e,t){this.isLine3=!0,this.start=void 0!==e?e:new h,this.end=void 0!==t?t:new h}function Ot(e){function t(e,t,r,i,n,a,o){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t}this.isSpline=!0,this.points=e;var r,i,n,a,o,s,l,u,c,d=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),n=r-i,d[0]=0===i?i:i-1,d[1]=i,d[2]=i>this.points.length-2?this.points.length-1:i+1,d[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[d[0]],l=this.points[d[1]],u=this.points[d[2]],c=this.points[d[3]],a=n*n,o=n*a,f.x=t(s.x,l.x,u.x,c.x,n,a,o),f.y=t(s.y,l.y,u.y,c.y,n,a,o),f.z=t(s.z,l.z,u.z,c.z,n,a,o),f},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;r>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,a=0,o=0,s=0,l=new h,u=new h,c=[],d=0;for(c[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;i>t;t++)r=t/i,n=this.getPoint(r),u.copy(n),d+=u.distanceTo(l),l.copy(n),a=(this.points.length-1)*r,o=Math.floor(a),o!=s&&(c[o]=d,s=o);return c[c.length]=d,{chunks:c,total:d}},this.reparametrizeByArcLength=function(e){var t,r,i,n,a,o,s,l,u=[],c=new h,d=this.getLength();for(u.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(o=d.chunks[t]-d.chunks[t-1],s=Math.ceil(e*o/d.total),n=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;s-1>r;r++)i=n+r*(1/s)*(a-n),l=this.getPoint(i),u.push(c.copy(l).clone());u.push(c.copy(this.points[t]).clone())}this.points=u}}function It(e){this.isBone=!0,c.call(this),this.type="Bone",this.skin=e}function Ht(){this.isLOD=!0,c.call(this),this.objects=[]}function Vt(e,t,r,i,n){this.isLensFlare=!0,c.call(this),this.lensFlares=[],this.positionScreen=new h,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)}function Wt(e,t){this.isMorphAnimMesh=!0,de.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)}function Gt(t,i,n){if(this.isSkeleton=!0,this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new o,t=t||[],this.bones=t.slice(0),this.useVertexTexture){var a;a=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=a,this.boneTextureHeight=a,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new re(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===i)this.calculateInverses();else if(this.bones.length===i.length)this.boneInverses=i.slice(0);else{r("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var s=0,h=this.bones.length;h>s;s++)this.boneInverses.push(new o)}}function jt(e,t,r){this.isSkinnedMesh=!0,de.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new o,this.bindMatrixInverse=new o;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,a,s,h,l,u=0,c=this.geometry.bones.length;c>u;++u)a=this.geometry.bones[u],s=a.pos,h=a.rotq,l=a.scl,n=new It(this),i.push(n),n.name=a.name,n.position.set(s[0],s[1],s[2]),n.quaternion.set(h[0],h[1],h[2],h[3]),void 0!==l?n.scale.set(l[0],l[1],l[2]):n.scale.set(1,1,1);for(var u=0,c=this.geometry.bones.length;c>u;++u)a=this.geometry.bones[u],-1!==a.parent?i[a.parent].add(i[u]):this.add(i[u])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Gt(i,void 0,r))}function Xt(e,t){function r(t){var r=d.createProgram(),i=d.createShader(d.FRAGMENT_SHADER),n=d.createShader(d.VERTEX_SHADER),a="precision "+e.getPrecision()+" float;\n";return d.shaderSource(i,a+t.fragmentShader),d.shaderSource(n,a+t.vertexShader),d.compileShader(i),d.compileShader(n),d.attachShader(r,i),d.attachShader(r,n),d.linkProgram(r),r}this.isLensFlarePlugin=!0;var i,n,a,o,s,l,u,c,d=e.context,f=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);i=d.createBuffer(),n=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,i),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,n),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),u=d.createTexture(),c=d.createTexture(),d.bindTexture(d.TEXTURE_2D,u),d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.bindTexture(d.TEXTURE_2D,c),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),l=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var h;h=l?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=r(h),o={vertex:d.getAttribLocation(a,"position"),uv:d.getAttribLocation(a,"uv")},s={renderType:d.getUniformLocation(a,"renderType"),map:d.getUniformLocation(a,"map"),occlusionMap:d.getUniformLocation(a,"occlusionMap"),opacity:d.getUniformLocation(a,"opacity"),color:d.getUniformLocation(a,"color"),scale:d.getUniformLocation(a,"scale"),rotation:d.getUniformLocation(a,"rotation"),screenPosition:d.getUniformLocation(a,"screenPosition")}};this.render=function(r,m,g,v){if(0!==t.length){var y=new h,x=v/g,b=.5*g,_=.5*v,w=16/v,M=new p(w*x,w),S=new h(1,1,0),T=new p(1,1);void 0===a&&f(),d.useProgram(a),d.enableVertexAttribArray(o.vertex),d.enableVertexAttribArray(o.uv),d.uniform1i(s.occlusionMap,0),d.uniform1i(s.map,1),d.bindBuffer(d.ARRAY_BUFFER,i),d.vertexAttribPointer(o.vertex,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(o.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,n),d.disable(d.CULL_FACE),d.depthMask(!1);for(var E=0,A=t.length;A>E;E++){w=16/v,M.set(w*x,w);var C=t[E];if(y.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]),y.applyMatrix4(m.matrixWorldInverse),y.applyProjection(m.projectionMatrix),S.copy(y),T.x=S.x*b+b,T.y=S.y*_+_,l||T.x>0&&T.x<g&&T.y>0&&T.y<v){d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,u),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,T.x-8,T.y-8,16,16,0),d.uniform1i(s.renderType,0),d.uniform2f(s.scale,M.x,M.y),d.uniform3f(s.screenPosition,S.x,S.y,S.z),d.disable(d.BLEND),d.enable(d.DEPTH_TEST),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,c),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,T.x-8,T.y-8,16,16,0),d.uniform1i(s.renderType,1),d.disable(d.DEPTH_TEST),d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,u),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),C.positionScreen.copy(S),C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares(),d.uniform1i(s.renderType,2),d.enable(d.BLEND);for(var L=0,R=C.lensFlares.length;R>L;L++){var P=C.lensFlares[L];P.opacity>.001&&P.scale>.001&&(S.x=P.x,S.y=P.y,S.z=P.z,w=P.size*P.scale/v,M.x=w*x,M.y=w,d.uniform3f(s.screenPosition,S.x,S.y,S.z),d.uniform2f(s.scale,M.x,M.y),d.uniform1f(s.rotation,P.rotation),d.uniform1f(s.opacity,P.opacity),d.uniform3f(s.color,P.color.r,P.color.g,P.color.b),e.state.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture(P.texture,1),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0))}}}d.enable(d.CULL_FACE),d.enable(d.DEPTH_TEST),d.depthMask(!0),e.resetGLState()}}}function qt(e,t){function r(){var t=d.createProgram(),r=d.createShader(d.VERTEX_SHADER),i=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),d.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),d.compileShader(r),d.compileShader(i),d.attachShader(t,r),d.attachShader(t,i),d.linkProgram(t),t}function i(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.isSpritePlugin=!0;var n,a,o,l,u,c,d=e.context,f=new h,p=new s,m=new h,g=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=d.createBuffer(),a=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,n),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),o=r(),l={position:d.getAttribLocation(o,"position"),uv:d.getAttribLocation(o,"uv")},u={uvOffset:d.getUniformLocation(o,"uvOffset"),uvScale:d.getUniformLocation(o,"uvScale"),rotation:d.getUniformLocation(o,"rotation"),scale:d.getUniformLocation(o,"scale"),color:d.getUniformLocation(o,"color"),map:d.getUniformLocation(o,"map"),opacity:d.getUniformLocation(o,"opacity"),modelViewMatrix:d.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:d.getUniformLocation(o,"projectionMatrix"),fogType:d.getUniformLocation(o,"fogType"),fogDensity:d.getUniformLocation(o,"fogDensity"),fogNear:d.getUniformLocation(o,"fogNear"),fogFar:d.getUniformLocation(o,"fogFar"),fogColor:d.getUniformLocation(o,"fogColor"),alphaTest:d.getUniformLocation(o,"alphaTest")};var i=document.createElement("canvas");i.width=8,i.height=8;var s=i.getContext("2d");s.fillStyle="white",s.fillRect(0,0,8,8),c=new ee(i),c.needsUpdate=!0};this.render=function(r,s){if(0!==t.length){void 0===o&&g(),d.useProgram(o),d.enableVertexAttribArray(l.position),d.enableVertexAttribArray(l.uv),d.disable(d.CULL_FACE),d.enable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,n),d.vertexAttribPointer(l.position,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(l.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),d.uniformMatrix4fv(u.projectionMatrix,!1,s.projectionMatrix.elements),d.activeTexture(d.TEXTURE0),d.uniform1i(u.map,0);var h=0,v=0,y=r.fog;y?(d.uniform3f(u.fogColor,y.color.r,y.color.g,y.color.b),y&&y.isFog?(d.uniform1f(u.fogNear,y.near),d.uniform1f(u.fogFar,y.far),d.uniform1i(u.fogType,1),h=1,v=1):y&&y.isFogExp2&&(d.uniform1f(u.fogDensity,y.density),d.uniform1i(u.fogType,2),h=2,v=2)):(d.uniform1i(u.fogType,0),h=0,v=0);for(var x=0,b=t.length;b>x;x++){var _=t[x];_._modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,_.matrixWorld),_.z=-_._modelViewMatrix.elements[14]}t.sort(i);for(var w=[],x=0,b=t.length;b>x;x++){var _=t[x],M=_.material;d.uniform1f(u.alphaTest,M.alphaTest),d.uniformMatrix4fv(u.modelViewMatrix,!1,_._modelViewMatrix.elements),_.matrixWorld.decompose(f,p,m),w[0]=m.x,w[1]=m.y;var S=0;r.fog&&M.fog&&(S=v),h!==S&&(d.uniform1i(u.fogType,S),h=S),null!==M.map?(d.uniform2f(u.uvOffset,M.map.offset.x,M.map.offset.y),d.uniform2f(u.uvScale,M.map.repeat.x,M.map.repeat.y)):(d.uniform2f(u.uvOffset,0,0),d.uniform2f(u.uvScale,1,1)),d.uniform1f(u.opacity,M.opacity),d.uniform3f(u.color,M.color.r,M.color.g,M.color.b),d.uniform1f(u.rotation,M.rotation),d.uniform2fv(u.scale,w),e.state.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),e.state.setDepthTest(M.depthTest),e.state.setDepthWrite(M.depthWrite),M.map&&M.map.image&&M.map.image.width?e.setTexture(M.map,0):e.setTexture(c,0),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}d.enable(d.CULL_FACE),e.resetGLState()}}}function Yt(t,r,n,a){function s(e,t,r){if(t.visible){var i=n[t.id];if(i&&t.castShadow&&(t.frustumCulled===!1||w.intersectsObject(t)===!0))for(var a=0,o=i.length;o>a;a++){var h=i[a];t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),A.push(h)}for(var a=0,o=t.children.length;o>a;a++)s(e,t.children[a],r)}}function l(e,t){var r=new ot;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,n=r.pointsFrustum,a=0;8>a;a++)i[a]=new h,n[a]=new h;var o=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,o),n[1].set(1,-1,o),n[2].set(-1,1,o),n[3].set(1,1,o),n[4].set(-1,-1,s),n[5].set(1,-1,s),n[6].set(-1,1,s),n[7].set(1,1,s),r}function u(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],a=r.pointsFrustum;a[0].z=i,a[1].z=i,a[2].z=i,a[3].z=i,a[4].z=n,a[5].z=n,a[6].z=n,a[7].z=n}function c(e,t){var r=t.shadowCamera,i=t.pointsFrustum,n=t.pointsWorld;S.set(1/0,1/0,1/0),T.set(-(1/0),-(1/0),-(1/0));for(var a=0;8>a;a++){var o=n[a];o.copy(i[a]),o.unproject(e),o.applyMatrix4(r.matrixWorldInverse),o.x<S.x&&(S.x=o.x),o.x>T.x&&(T.x=o.x),o.y<S.y&&(S.y=o.y),o.y>T.y&&(T.y=o.y),o.z<S.z&&(S.z=o.z),o.z>T.z&&(T.z=o.z)}r.left=S.x,r.right=T.x,r.top=T.y,
r.bottom=S.y,r.updateProjectionMatrix()}function d(e){return e.material&&e.material.isMeshFaceMaterial?e.material.materials[0]:e.material}this.isShadowMapPlugin=!0;var f,g,y,b,_=t.context,w=new kt,M=new o,S=new h,T=new h,E=new h,A=[],C=e.ShaderLib.depthRGBA,L=e.UniformsUtils.clone(C.uniforms);f=new Dt({uniforms:L,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader}),g=new Dt({uniforms:L,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,morphTargets:!0}),y=new Dt({uniforms:L,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,skinning:!0}),b=new Dt({uniforms:L,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,morphTargets:!0,skinning:!0}),f._shadowPass=!0,g._shadowPass=!0,y._shadowPass=!0,b._shadowPass=!0,this.render=function(n,h){if(t.shadowMapEnabled!==!1){var S,T,C,L,R,P,F,U,D,B,z,k,N,O=[],I=0,H=null;for(_.clearColor(1,1,1,1),_.disable(_.BLEND),_.enable(_.CULL_FACE),_.frontFace(_.CCW),_.cullFace(t.shadowMapCullFace===e.CullFaceFront?_.FRONT:_.BACK),t.state.setDepthTest(!0),S=0,T=r.length;T>S;S++)if(N=r[S],N.castShadow)if(N&&N.isDirectionalLight&&N.shadowCascade)for(R=0;R<N.shadowCascadeCount;R++){var V;if(N.shadowCascadeArray[R])V=N.shadowCascadeArray[R];else{V=l(N,R),V.originalCamera=h;var W=new ye;W.position.copy(N.shadowCascadeOffset),W.add(V),W.add(V.target),h.add(W),N.shadowCascadeArray[R]=V}u(N,R),O[I]=V,I++}else O[I]=N,I++;for(S=0,T=O.length;T>S;S++){if(N=O[S],!N.shadowMap){var G=e.LinearFilter;t.shadowMapType===e.PCFSoftShadowMap&&(G=e.NearestFilter);var j={minFilter:G,magFilter:G,format:e.RGBAFormat};N.shadowMap=new m(N.shadowMapWidth,N.shadowMapHeight,j),N.shadowMapSize=new p(N.shadowMapWidth,N.shadowMapHeight),N.shadowMatrix=new o}if(!N.shadowCamera){if(N&&N.isSpotLight)N.shadowCamera=new v(N.shadowCameraFov,N.shadowMapWidth/N.shadowMapHeight,N.shadowCameraNear,N.shadowCameraFar);else{if(!N||!N.isDirectionalLight){i("THREE.ShadowMapPlugin: Unsupported light type for shadow",N);continue}N.shadowCamera=new x(N.shadowCameraLeft,N.shadowCameraRight,N.shadowCameraTop,N.shadowCameraBottom,N.shadowCameraNear,N.shadowCameraFar)}n.add(N.shadowCamera),n.autoUpdate===!0&&n.updateMatrixWorld()}N.shadowCameraVisible&&!N.cameraHelper&&(N.cameraHelper=new We(N.shadowCamera),n.add(N.cameraHelper)),N.isVirtual&&V.originalCamera==h&&c(h,N),P=N.shadowMap,F=N.shadowMatrix,U=N.shadowCamera,U.position.setFromMatrixPosition(N.matrixWorld),E.setFromMatrixPosition(N.target.matrixWorld),U.lookAt(E),U.updateMatrixWorld(),U.matrixWorldInverse.getInverse(U.matrixWorld),N.cameraHelper&&(N.cameraHelper.visible=N.shadowCameraVisible),N.shadowCameraVisible&&N.cameraHelper.update(),F.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),F.multiply(U.projectionMatrix),F.multiply(U.matrixWorldInverse),M.multiplyMatrices(U.projectionMatrix,U.matrixWorldInverse),w.setFromMatrix(M),t.setRenderTarget(P),t.clear(),A.length=0,s(n,n,U);var X,q,Y;for(C=0,L=A.length;L>C;C++)z=A[C],k=z.object,D=z.buffer,X=d(k),q=void 0!==k.geometry.morphTargets&&k.geometry.morphTargets.length>0&&X.morphTargets,Y=k&&k.isSkinnedMesh&&X.skinning,B=k.customDepthMaterial?k.customDepthMaterial:Y?q?b:y:q?g:f,t.setMaterialFaces(X),D&&D.isBufferGeometry?t.renderBufferDirect(U,r,H,B,D,k):t.renderBuffer(U,r,H,B,D,k);for(C=0,L=a.length;L>C;C++)z=a[C],k=z.object,k.visible&&k.castShadow&&(k._modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,k.matrixWorld),t.renderImmediateObject(U,r,H,f,k))}var K=t.getClearColor(),Z=t.getClearAlpha();_.clearColor(K.r,K.g,K.b,Z),_.enable(_.BLEND),t.shadowMapCullFace===e.CullFaceFront&&_.cullFace(_.BACK),t.resetGLState()}}}function Kt(e){this.isWebGLExtensions=!0;var t={};this.get=function(i){if(void 0!==t[i])return t[i];var n;switch(i){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return null===n&&r("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n,n}}function Zt(t,r){this.isWebGLState=!0;var i=new Uint8Array(16),n=new Uint8Array(16),a=null,o=null,s=null,h=null,l=null,u=null,c=null,d=null,f=null,p=null,m=null,g=null,v=null,y=null,x=null,b=null;this.initAttributes=function(){for(var e=0,t=i.length;t>e;e++)i[e]=0},this.enableAttribute=function(e){i[e]=1,0===n[e]&&(t.enableVertexAttribArray(e),n[e]=1)},this.disableUnusedAttributes=function(){for(var e=0,r=n.length;r>e;e++)n[e]!==i[e]&&(t.disableVertexAttribArray(e),n[e]=0)},this.setBlending=function(i,n,d,f,p,m,g){i!==a&&(i===e.NoBlending?t.disable(t.BLEND):i===e.AdditiveBlending?(t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):i===e.SubtractiveBlending?(t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):i===e.MultiplyBlending?(t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):i===e.CustomBlending?t.enable(t.BLEND):(t.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),a=i),i===e.CustomBlending?(p=p||n,m=m||d,g=g||f,(n!==o||p!==l)&&(t.blendEquationSeparate(r(n),r(p)),o=n,l=p),(d!==s||f!==h||m!==u||g!==c)&&(t.blendFuncSeparate(r(d),r(f),r(m),r(g)),s=d,h=f,u=m,c=g)):(o=null,s=null,h=null,l=null,u=null,c=null)},this.setDepthTest=function(e){d!==e&&(e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),d=e)},this.setDepthWrite=function(e){f!==e&&(t.depthMask(e),f=e)},this.setColorWrite=function(e){p!==e&&(t.colorMask(e,e,e,e),p=e)},this.setDoubleSided=function(e){m!==e&&(e?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),m=e)},this.setFlipSided=function(e){g!==e&&(t.frontFace(e?t.CW:t.CCW),g=e)},this.setLineWidth=function(e){e!==v&&(t.lineWidth(e),v=e)},this.setPolygonOffset=function(e,r,i){y!==e&&(e?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),y=e),!e||x===r&&b===i||(t.polygonOffset(r,i),x=r,b=i)},this.reset=function(){for(var e=0;e<n.length;e++)n[e]=0;a=null,d=null,f=null,p=null,m=null,g=null}}function Qt(t){function n(e){e.__webglVertexBuffer=ke.createBuffer(),e.__webglColorBuffer=ke.createBuffer(),Ne.info.memory.geometries++}function a(e){e.__webglVertexBuffer=ke.createBuffer(),e.__webglColorBuffer=ke.createBuffer(),e.__webglLineDistanceBuffer=ke.createBuffer(),Ne.info.memory.geometries++}function s(e){e.__webglVertexBuffer=ke.createBuffer(),e.__webglNormalBuffer=ke.createBuffer(),e.__webglTangentBuffer=ke.createBuffer(),e.__webglColorBuffer=ke.createBuffer(),e.__webglUVBuffer=ke.createBuffer(),e.__webglUV2Buffer=ke.createBuffer(),e.__webglSkinIndicesBuffer=ke.createBuffer(),e.__webglSkinWeightsBuffer=ke.createBuffer(),e.__webglFaceBuffer=ke.createBuffer(),e.__webglLineBuffer=ke.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var r=0,i=t;i>r;r++)e.__webglMorphTargetsBuffers.push(ke.createBuffer())}var n=e.numMorphNormals;if(n){e.__webglMorphNormalsBuffers=[];for(var r=0,i=n;i>r;r++)e.__webglMorphNormalsBuffers.push(ke.createBuffer())}Ne.info.memory.geometries++}function l(e){var t=e.geometry,r=e.material,i=t.vertices.length;if(r.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var n in r.attributes){var a=r.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=!0;var o=1;"v2"===a.type?o=2:"v3"===a.type?o=3:"v4"===a.type?o=4:"c"===a.type&&(o=3),a.size=o,a.array=new Float32Array(i*o),a.buffer=ke.createBuffer(),a.buffer.belongsToAttribute=n,a.needsUpdate=!0}t.__webglCustomAttributesList.push(a)}}}function u(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__webglParticleCount=r,l(t)}function c(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,l(t)}function d(e,t){var r=t.geometry,i=e.faces3,n=3*i.length,a=1*i.length,o=3*i.length,s=f(t,e);e.__vertexArray=new Float32Array(3*n),e.__normalArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__uvArray=new Float32Array(2*n),r.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*n)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n));var h=null!==st.get("OES_element_index_uint")&&a>21845?Uint32Array:Uint16Array;e.__typeArray=h,e.__faceArray=new h(3*a),e.__lineArray=new h(2*o);var l=e.numMorphTargets;if(l){e.__morphTargetsArrays=[];for(var u=0,c=l;c>u;u++)e.__morphTargetsArrays.push(new Float32Array(3*n))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(var u=0,c=d;c>u;u++)e.__morphNormalsArrays.push(new Float32Array(3*n))}if(e.__webglFaceCount=3*a,e.__webglLineCount=2*o,s.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in s.attributes){var m=s.attributes[p],g={};for(var v in m)g[v]=m[v];if(!g.__webglInitialized||g.createUniqueBuffers){g.__webglInitialized=!0;var y=1;"v2"===g.type?y=2:"v3"===g.type?y=3:"v4"===g.type?y=4:"c"===g.type&&(y=3),g.size=y,g.array=new Float32Array(n*y),g.buffer=ke.createBuffer(),g.buffer.belongsToAttribute=p,m.needsUpdate=!0,g.__original=m}e.__webglCustomAttributesList.push(g)}}e.__inittedArrays=!0}function f(e,t){return e.material&&e.material.isMeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function p(t){return(t&&t.isMeshPhongMaterial)===!1&&t.shading===e.FlatShading}function m(e,t){var r,i,n,a,o,s,h,l,u,c,d,f=e.vertices,p=f.length,m=e.colors,g=m.length,v=e.__vertexArray,y=e.__colorArray,x=e.verticesNeedUpdate,b=e.colorsNeedUpdate,_=e.__webglCustomAttributesList;if(x){for(r=0;p>r;r++)n=f[r],a=3*r,v[a]=n.x,v[a+1]=n.y,v[a+2]=n.z;ke.bindBuffer(ke.ARRAY_BUFFER,e.__webglVertexBuffer),ke.bufferData(ke.ARRAY_BUFFER,v,t)}if(b){for(i=0;g>i;i++)o=m[i],a=3*i,y[a]=o.r,y[a+1]=o.g,y[a+2]=o.b;ke.bindBuffer(ke.ARRAY_BUFFER,e.__webglColorBuffer),ke.bufferData(ke.ARRAY_BUFFER,y,t)}if(_)for(s=0,h=_.length;h>s;s++){if(d=_[s],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(u=d.value.length,a=0,1===d.size)for(l=0;u>l;l++)d.array[l]=d.value[l];else if(2===d.size)for(l=0;u>l;l++)c=d.value[l],d.array[a]=c.x,d.array[a+1]=c.y,a+=2;else if(3===d.size)if("c"===d.type)for(l=0;u>l;l++)c=d.value[l],d.array[a]=c.r,d.array[a+1]=c.g,d.array[a+2]=c.b,a+=3;else for(l=0;u>l;l++)c=d.value[l],d.array[a]=c.x,d.array[a+1]=c.y,d.array[a+2]=c.z,a+=3;else if(4===d.size)for(l=0;u>l;l++)c=d.value[l],d.array[a]=c.x,d.array[a+1]=c.y,d.array[a+2]=c.z,d.array[a+3]=c.w,a+=4;ke.bindBuffer(ke.ARRAY_BUFFER,d.buffer),ke.bufferData(ke.ARRAY_BUFFER,d.array,t),d.needsUpdate=!1}}function g(e,t){var r,i,n,a,o,s,h,l,u,c,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,x=g.length,b=e.__vertexArray,_=e.__colorArray,w=e.__lineDistanceArray,M=e.verticesNeedUpdate,S=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,E=e.__webglCustomAttributesList;if(M){for(r=0;v>r;r++)a=p[r],o=3*r,b[o]=a.x,b[o+1]=a.y,b[o+2]=a.z;ke.bindBuffer(ke.ARRAY_BUFFER,e.__webglVertexBuffer),ke.bufferData(ke.ARRAY_BUFFER,b,t)}if(S){for(i=0;y>i;i++)s=m[i],o=3*i,_[o]=s.r,_[o+1]=s.g,_[o+2]=s.b;ke.bindBuffer(ke.ARRAY_BUFFER,e.__webglColorBuffer),ke.bufferData(ke.ARRAY_BUFFER,_,t)}if(T){for(n=0;x>n;n++)w[n]=g[n];ke.bindBuffer(ke.ARRAY_BUFFER,e.__webglLineDistanceBuffer),ke.bufferData(ke.ARRAY_BUFFER,w,t)}if(E)for(h=0,l=E.length;l>h;h++)if(f=E[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(o=0,c=f.value.length,1===f.size)for(u=0;c>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;c>u;u++)d=f.value[u],f.array[o]=d.x,f.array[o+1]=d.y,o+=2;else if(3===f.size)if("c"===f.type)for(u=0;c>u;u++)d=f.value[u],f.array[o]=d.r,f.array[o+1]=d.g,f.array[o+2]=d.b,o+=3;else for(u=0;c>u;u++)d=f.value[u],f.array[o]=d.x,f.array[o+1]=d.y,f.array[o+2]=d.z,o+=3;else if(4===f.size)for(u=0;c>u;u++)d=f.value[u],f.array[o]=d.x,f.array[o+1]=d.y,f.array[o+2]=d.z,f.array[o+3]=d.w,o+=4;ke.bindBuffer(ke.ARRAY_BUFFER,f.buffer),ke.bufferData(ke.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}function v(t,r,i,n,a){if(t.__inittedArrays){var o,s,h,l,u,c,d,f,m,g,v,y,x,b,_,w,M,S,T,E,A,C,L,R,P,F,U,D,B,z,k,N,O,I,H,V,W,G,j,X,q,Y,K=p(a),Z=0,Q=0,J=0,$=0,ee=0,te=0,re=0,ie=0,ne=0,ae=0,oe=0,se=0,he=t.__vertexArray,le=t.__uvArray,ue=t.__uv2Array,ce=t.__normalArray,de=t.__tangentArray,fe=t.__colorArray,pe=t.__skinIndexArray,me=t.__skinWeightArray,ge=t.__morphTargetsArrays,ve=t.__morphNormalsArrays,ye=t.__webglCustomAttributesList,xe=t.__faceArray,be=t.__lineArray,_e=r.geometry,we=_e.verticesNeedUpdate,Me=_e.elementsNeedUpdate,Se=_e.uvsNeedUpdate,Te=_e.normalsNeedUpdate,Ee=_e.tangentsNeedUpdate,Ae=_e.colorsNeedUpdate,Ce=_e.morphTargetsNeedUpdate,Le=_e.vertices,Re=t.faces3,Pe=_e.faces,Fe=_e.faceVertexUvs[0],Ue=_e.faceVertexUvs[1],De=_e.skinIndices,Be=_e.skinWeights,ze=_e.morphTargets,Ne=_e.morphNormals;if(we){for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],y=Le[l.a],x=Le[l.b],b=Le[l.c],he[Q]=y.x,he[Q+1]=y.y,he[Q+2]=y.z,he[Q+3]=x.x,he[Q+4]=x.y,he[Q+5]=x.z,he[Q+6]=b.x,he[Q+7]=b.y,he[Q+8]=b.z,Q+=9;ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglVertexBuffer),ke.bufferData(ke.ARRAY_BUFFER,he,i)}if(Ce)for(H=0,V=ze.length;V>H;H++){for(oe=0,o=0,s=Re.length;s>o;o++)j=Re[o],l=Pe[j],y=ze[H].vertices[l.a],x=ze[H].vertices[l.b],b=ze[H].vertices[l.c],W=ge[H],W[oe]=y.x,W[oe+1]=y.y,W[oe+2]=y.z,W[oe+3]=x.x,W[oe+4]=x.y,W[oe+5]=x.z,W[oe+6]=b.x,W[oe+7]=b.y,W[oe+8]=b.z,a.morphNormals&&(K?(S=Ne[H].faceNormals[j],T=S,E=S):(X=Ne[H].vertexNormals[j],S=X.a,T=X.b,E=X.c),G=ve[H],G[oe]=S.x,G[oe+1]=S.y,G[oe+2]=S.z,G[oe+3]=T.x,G[oe+4]=T.y,G[oe+5]=T.z,G[oe+6]=E.x,G[oe+7]=E.y,G[oe+8]=E.z),oe+=9;ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[H]),ke.bufferData(ke.ARRAY_BUFFER,ge[H],i),a.morphNormals&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[H]),ke.bufferData(ke.ARRAY_BUFFER,ve[H],i))}if(Be.length){for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],R=Be[l.a],P=Be[l.b],F=Be[l.c],me[ae]=R.x,me[ae+1]=R.y,me[ae+2]=R.z,me[ae+3]=R.w,me[ae+4]=P.x,me[ae+5]=P.y,me[ae+6]=P.z,me[ae+7]=P.w,me[ae+8]=F.x,me[ae+9]=F.y,me[ae+10]=F.z,me[ae+11]=F.w,U=De[l.a],D=De[l.b],B=De[l.c],pe[ae]=U.x,pe[ae+1]=U.y,pe[ae+2]=U.z,pe[ae+3]=U.w,pe[ae+4]=D.x,pe[ae+5]=D.y,pe[ae+6]=D.z,pe[ae+7]=D.w,pe[ae+8]=B.x,pe[ae+9]=B.y,pe[ae+10]=B.z,pe[ae+11]=B.w,ae+=12;ae>0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglSkinIndicesBuffer),ke.bufferData(ke.ARRAY_BUFFER,pe,i),ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglSkinWeightsBuffer),ke.bufferData(ke.ARRAY_BUFFER,me,i))}if(Ae){for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],d=l.vertexColors,f=l.color,3===d.length&&a.vertexColors===e.VertexColors?(A=d[0],C=d[1],L=d[2]):(A=f,C=f,L=f),fe[ne]=A.r,fe[ne+1]=A.g,fe[ne+2]=A.b,fe[ne+3]=C.r,fe[ne+4]=C.g,fe[ne+5]=C.b,fe[ne+6]=L.r,fe[ne+7]=L.g,fe[ne+8]=L.b,ne+=9;ne>0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglColorBuffer),ke.bufferData(ke.ARRAY_BUFFER,fe,i))}if(Ee&&_e.hasTangents){for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],m=l.vertexTangents,_=m[0],w=m[1],M=m[2],de[re]=_.x,de[re+1]=_.y,de[re+2]=_.z,de[re+3]=_.w,de[re+4]=w.x,de[re+5]=w.y,de[re+6]=w.z,de[re+7]=w.w,de[re+8]=M.x,de[re+9]=M.y,de[re+10]=M.z,de[re+11]=M.w,re+=12;ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglTangentBuffer),ke.bufferData(ke.ARRAY_BUFFER,de,i)}if(Te){for(o=0,s=Re.length;s>o;o++)if(l=Pe[Re[o]],u=l.vertexNormals,c=l.normal,3===u.length&&K===!1)for(z=0;3>z;z++)N=u[z],ce[te]=N.x,ce[te+1]=N.y,ce[te+2]=N.z,te+=3;else for(z=0;3>z;z++)ce[te]=c.x,ce[te+1]=c.y,ce[te+2]=c.z,te+=3;ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglNormalBuffer),ke.bufferData(ke.ARRAY_BUFFER,ce,i)}if(Se&&Fe){for(o=0,s=Re.length;s>o;o++)if(h=Re[o],g=Fe[h],void 0!==g)for(z=0;3>z;z++)O=g[z],le[J]=O.x,le[J+1]=O.y,J+=2;J>0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglUVBuffer),ke.bufferData(ke.ARRAY_BUFFER,le,i))}if(Se&&Ue){for(o=0,s=Re.length;s>o;o++)if(h=Re[o],v=Ue[h],void 0!==v)for(z=0;3>z;z++)I=v[z],ue[$]=I.x,ue[$+1]=I.y,$+=2;$>0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglUV2Buffer),ke.bufferData(ke.ARRAY_BUFFER,ue,i))}if(Me){for(o=0,s=Re.length;s>o;o++)xe[ee]=Z,xe[ee+1]=Z+1,xe[ee+2]=Z+2,ee+=3,be[ie]=Z,be[ie+1]=Z+1,be[ie+2]=Z,be[ie+3]=Z+2,be[ie+4]=Z+1,be[ie+5]=Z+2,ie+=6,Z+=3;ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),ke.bufferData(ke.ELEMENT_ARRAY_BUFFER,xe,i),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),ke.bufferData(ke.ELEMENT_ARRAY_BUFFER,be,i)}if(ye)for(z=0,k=ye.length;k>z;z++)if(Y=ye[z],Y.__original.needsUpdate){if(se=0,1===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],Y.array[se]=Y.value[l.a],Y.array[se+1]=Y.value[l.b],Y.array[se+2]=Y.value[l.c],se+=3;else if("faces"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],Y.array[se]=q,Y.array[se+1]=q,Y.array[se+2]=q,se+=3}else if(2===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],y=Y.value[l.a],x=Y.value[l.b],b=Y.value[l.c],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=x.x,Y.array[se+3]=x.y,Y.array[se+4]=b.x,Y.array[se+5]=b.y,se+=6;else if("faces"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],y=q,x=q,b=q,Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=x.x,Y.array[se+3]=x.y,Y.array[se+4]=b.x,Y.array[se+5]=b.y,se+=6}else if(3===Y.size){var Oe;if(Oe="c"===Y.type?["r","g","b"]:["x","y","z"],void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],y=Y.value[l.a],x=Y.value[l.b],b=Y.value[l.c],Y.array[se]=y[Oe[0]],Y.array[se+1]=y[Oe[1]],Y.array[se+2]=y[Oe[2]],Y.array[se+3]=x[Oe[0]],Y.array[se+4]=x[Oe[1]],Y.array[se+5]=x[Oe[2]],Y.array[se+6]=b[Oe[0]],Y.array[se+7]=b[Oe[1]],Y.array[se+8]=b[Oe[2]],se+=9;else if("faces"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],y=q,x=q,b=q,Y.array[se]=y[Oe[0]],Y.array[se+1]=y[Oe[1]],Y.array[se+2]=y[Oe[2]],Y.array[se+3]=x[Oe[0]],Y.array[se+4]=x[Oe[1]],Y.array[se+5]=x[Oe[2]],Y.array[se+6]=b[Oe[0]],Y.array[se+7]=b[Oe[1]],Y.array[se+8]=b[Oe[2]],se+=9;else if("faceVertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],y=q[0],x=q[1],b=q[2],Y.array[se]=y[Oe[0]],Y.array[se+1]=y[Oe[1]],Y.array[se+2]=y[Oe[2]],Y.array[se+3]=x[Oe[0]],Y.array[se+4]=x[Oe[1]],Y.array[se+5]=x[Oe[2]],Y.array[se+6]=b[Oe[0]],Y.array[se+7]=b[Oe[1]],Y.array[se+8]=b[Oe[2]],se+=9}else if(4===Y.size)if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)l=Pe[Re[o]],y=Y.value[l.a],x=Y.value[l.b],b=Y.value[l.c],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=b.x,Y.array[se+9]=b.y,Y.array[se+10]=b.z,Y.array[se+11]=b.w,se+=12;else if("faces"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],y=q,x=q,b=q,Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=b.x,Y.array[se+9]=b.y,Y.array[se+10]=b.z,Y.array[se+11]=b.w,se+=12;else if("faceVertices"===Y.boundTo)for(o=0,s=Re.length;s>o;o++)q=Y.value[Re[o]],y=q[0],x=q[1],b=q[2],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=b.x,Y.array[se+9]=b.y,Y.array[se+10]=b.z,Y.array[se+11]=b.w,se+=12;ke.bindBuffer(ke.ARRAY_BUFFER,Y.buffer),ke.bufferData(ke.ARRAY_BUFFER,Y.array,i)}n&&(delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray)}}function y(e,t,r,i){for(var n=r.attributes,a=t.attributes,o=t.attributesKeys,s=0,h=o.length;h>s;s++){var l=o[s],u=a[l];if(u>=0){var c=n[l];if(void 0!==c){var d=c.itemSize;ke.bindBuffer(ke.ARRAY_BUFFER,c.buffer),ot.enableAttribute(u),ke.vertexAttribPointer(u,d,ke.FLOAT,!1,0,i*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[l].length?ke.vertexAttrib2fv(u,e.defaultAttributeValues[l]):3===e.defaultAttributeValues[l].length&&ke.vertexAttrib3fv(u,e.defaultAttributeValues[l]))}}ot.disableUnusedAttributes()}function x(e,t,r){var i=e.program.attributes;if(-1!==r.morphTargetBase&&i.position>=0?(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),ot.enableAttribute(i.position),ke.vertexAttribPointer(i.position,3,ke.FLOAT,!1,0,0)):i.position>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglVertexBuffer),ot.enableAttribute(i.position),ke.vertexAttribPointer(i.position,3,ke.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var n,a=0,o=r.morphTargetForcedOrder,s=r.morphTargetInfluences;a<e.numSupportedMorphTargets&&a<o.length;)n=i["morphTarget"+a],n>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[a]]),ot.enableAttribute(n),ke.vertexAttribPointer(n,3,ke.FLOAT,!1,0,0)),n=i["morphNormal"+a],n>=0&&e.morphNormals&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[a]]),ot.enableAttribute(n),ke.vertexAttribPointer(n,3,ke.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[a]=s[o[a]],a++;else{var h=[],s=r.morphTargetInfluences,l=r.geometry.morphTargets;s.length>l.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),s.length=l.length);for(var u=0,c=s.length;c>u;u++){var d=s[u];h.push([d,u])}h.length>e.numSupportedMorphTargets?(h.sort(w),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(w):0===h.length&&h.push([0,0]);for(var n,a=0,f=e.numSupportedMorphTargets;f>a;a++)if(h[a]){var p=h[a][1];n=i["morphTarget"+a],n>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]),ot.enableAttribute(n),ke.vertexAttribPointer(n,3,ke.FLOAT,!1,0,0)),n=i["morphNormal"+a],n>=0&&e.morphNormals&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]),ot.enableAttribute(n),ke.vertexAttribPointer(n,3,ke.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[a]=s[p]}else r.__webglMorphTargetInfluences[a]=0}null!==e.program.uniforms.morphTargetInfluences&&ke.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function b(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function _(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function w(e,t){return t[0]-e[0]}function M(e){if(e.visible!==!1){if(e&&e.isScene||e&&e.isGroup);else if(C(e),e&&e.isLight)Re.push(e);else if(e&&e.isSprite)Be.push(e);else if(e&&e.isLensFlare)ze.push(e);else{var t=Pe[e.id];if(t&&(e.frustumCulled===!1||Je.intersectsObject(e)===!0))for(var r=0,i=t.length;i>r;r++){var n=t[r];A(n),n.render=!0,Ne.sortObjects===!0&&(et.setFromMatrixPosition(e.matrixWorld),et.applyProjection($e),n.z=et.z)}}for(var r=0,i=e.children.length;i>r;r++)M(e.children[r])}}function S(e,t,r,i,n){for(var a,o=0,s=e.length;s>o;o++){var h=e[o],l=h.object,u=h.buffer;if(re(l,t),n)a=n;else{if(a=h.material,!a)continue;H(a)}Ne.setMaterialFaces(a),u&&u.isBufferGeometry?Ne.renderBufferDirect(t,r,i,a,u,l):Ne.renderBuffer(t,r,i,a,u,l)}}function T(e,t,r,i,n,a){for(var o,s=0,h=e.length;h>s;s++){var l=e[s],u=l.object;if(u.visible){if(a)o=a;else{if(o=l[t],!o)continue;H(o)}Ne.renderImmediateObject(r,i,n,o,u)}}}function E(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function A(e){var t=e.object,r=e.buffer,i=t.geometry,n=t.material;if(n&&n.isMeshFaceMaterial){var a=i&&i.isBufferGeometry?0:r.materialIndex;n=n.materials[a],e.material=n,n.transparent?De.push(e):Ue.push(e)}else n&&(e.material=n,n.transparent?De.push(e):Ue.push(e))}function C(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new o,e._normalMatrix=new F,e.addEventListener("removed",At));var t=e.geometry;if(void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Ct),t&&t.isBufferGeometry?Ne.info.memory.geometries++:e&&e.isMesh?P(e,t):e&&e.isLine?void 0===t.__webglVertexBuffer&&(a(t),c(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e&&e.isPointCloud&&void 0===t.__webglVertexBuffer&&(n(t),u(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)),void 0===e.__webglActive)if(e.__webglActive=!0,e&&e.isMesh){if(t&&t.isBufferGeometry)U(Pe,t,e);else if(t&&t.isGeometry)for(var r=Nt[t.id],i=0,s=r.length;s>i;i++)U(Pe,r[i],e)}else e&&e.isLine||e&&e.isPointCloud?U(Pe,t,e):(e&&e.isImmediateRenderObject||e.immediateRenderCallback)&&D(Fe,e)}function L(e,t){for(var r,i,n=st.get("OES_element_index_uint")?4294967296:65535,a={},o=e.morphTargets.length,s=e.morphNormals.length,h={},l=[],u=0,c=e.faces.length;c>u;u++){var d=e.faces[u],f=t?d.materialIndex:0;f in a||(a[f]={hash:f,counter:0}),r=a[f].hash+"_"+a[f].counter,r in h||(i={id:Ot++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:o,numMorphNormals:s},h[r]=i,l.push(i)),h[r].vertices+3>n&&(a[f].counter+=1,r=a[f].hash+"_"+a[f].counter,r in h||(i={id:Ot++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:o,numMorphNormals:s},h[r]=i,l.push(i))),h[r].faces3.push(u),h[r].vertices+=3}return l}function P(e,t){var r=e.material,i=!1;(void 0===Nt[t.id]||t.groupsNeedUpdate===!0)&&(delete Pe[e.id],Nt[t.id]=L(t,r&&r.isMeshFaceMaterial),t.groupsNeedUpdate=!1);for(var n=Nt[t.id],a=0,o=n.length;o>a;a++){var h=n[a];void 0===h.__webglVertexBuffer?(s(h),d(h,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,i=!0):i=!1,(i||void 0===e.__webglActive)&&U(Pe,h,e)}e.__webglActive=!0}function U(e,t,r){var i=r.id;e[i]=e[i]||[],e[i].push({id:i,buffer:t,object:r,material:null,z:0})}function D(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function B(e){var t=e.geometry;if(t&&t.isBufferGeometry)for(var r=t.attributes,i=t.attributesKeys,n=0,a=i.length;a>n;n++){var o=i[n],s=r[o],h="index"===o?ke.ELEMENT_ARRAY_BUFFER:ke.ARRAY_BUFFER;void 0===s.buffer?(s.buffer=ke.createBuffer(),ke.bindBuffer(h,s.buffer),ke.bufferData(h,s.array,s&&s.isDynamicBufferAttribute?ke.DYNAMIC_DRAW:ke.STATIC_DRAW),s.needsUpdate=!1):s.needsUpdate===!0&&(ke.bindBuffer(h,s.buffer),void 0===s.updateRange||-1===s.updateRange.count?ke.bufferSubData(h,0,s.array):0===s.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(ke.bufferSubData(h,s.updateRange.offset*s.array.BYTES_PER_ELEMENT,s.array.subarray(s.updateRange.offset,s.updateRange.offset+s.updateRange.count)),s.updateRange.count=0),s.needsUpdate=!1)}else if(e&&e.isMesh){t.groupsNeedUpdate===!0&&P(e,t);for(var l=Nt[t.id],n=0,u=l.length;u>n;n++){var c=l[n],d=f(e,c),p=d.attributes&&z(d);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||p)&&v(c,e,ke.DYNAMIC_DRAW,!t.dynamic,d)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,d.attributes&&k(d)}else if(e&&e.isLine){var d=f(e,t),p=d.attributes&&z(d);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||p)&&g(t,ke.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,d.attributes&&k(d)}else if(e&&e.isPointCloud){var d=f(e,t),p=d.attributes&&z(d);(t.verticesNeedUpdate||t.colorsNeedUpdate||p)&&m(t,ke.DYNAMIC_DRAW,e),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,d.attributes&&k(d)}}function z(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function k(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function N(e){e&&e.isMesh||e&&e.isPointCloud||e&&e.isLine?delete Pe[e.id]:(e&&e.isImmediateRenderObject||e.immediateRenderCallback)&&O(Fe,e),delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}function O(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function I(t,r,i,n){t.addEventListener("dispose",Pt);var a=It[t.type];if(a){var o=e.ShaderLib[a];t.__webglShader={uniforms:e.UniformsUtils.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}}else t.__webglShader={uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};var s=me(r),h=ge(r),l=pe(n),u={precision:be,supportsVertexTextures:mt,map:!!t.map,envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,combine:t.combine,vertexColors:t.vertexColors,fog:i,useFog:t.fog,fogExp:i&&i.isFogExp2,flatShading:t.shading===e.FlatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:Ae,skinning:t.skinning,maxBones:l,useVertexTexture:gt&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:Ne.maxMorphTargets,maxMorphNormals:Ne.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:Ne.shadowMapEnabled&&n.receiveShadow&&h>0,shadowMapType:Ne.shadowMapType,shadowMapDebug:Ne.shadowMapDebug,shadowMapCascade:Ne.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},c=[];if(a?c.push(a):(c.push(t.fragmentShader),c.push(t.vertexShader)),void 0!==t.defines)for(var d in t.defines)c.push(d),c.push(t.defines[d]);for(var d in u)c.push(d),c.push(u[d]);for(var f,p=c.join(),m=0,g=Oe.length;g>m;m++){var v=Oe[m];if(v.code===p){f=v,f.usedTimes++;break}}void 0===f&&(f=new e.WebGLProgram(Ne,p,t,u),Oe.push(f),Ne.info.memory.programs=Oe.length),t.program=f;var y=f.attributes;if(t.morphTargets){t.numSupportedMorphTargets=0;for(var x,b="morphTarget",_=0;_<Ne.maxMorphTargets;_++)x=b+_,y[x]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;var x,b="morphNormal";for(_=0;_<Ne.maxMorphNormals;_++)x=b+_,y[x]>=0&&t.numSupportedMorphNormals++}t.uniformsList=[];for(var w in t.__webglShader.uniforms){var M=t.program.uniforms[w];M&&t.uniformsList.push([t.__webglShader.uniforms[w],M])}}function H(t){t.transparent===!0?ot.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha):ot.setBlending(e.NoBlending),ot.setDepthTest(t.depthTest),ot.setDepthWrite(t.depthWrite),ot.setColorWrite(t.colorWrite),ot.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function V(e,t,r,i,n){je=0,i.needsUpdate&&(i.program&&zt(i),I(i,t,r,n),i.needsUpdate=!1),i.morphTargets&&(n.__webglMorphTargetInfluences||(n.__webglMorphTargetInfluences=new Float32Array(Ne.maxMorphTargets)));var a=!1,o=!1,s=!1,h=i.program,l=h.uniforms,u=i.__webglShader.uniforms;if(h.id!==Ie&&(ke.useProgram(h.program),Ie=h.id,a=!0,o=!0,s=!0),i.id!==Ve&&(-1===Ve&&(s=!0),Ve=i.id,o=!0),(a||e!==Ge)&&(ke.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),Ae&&ke.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Ge&&(Ge=e),(i&&i.isShaderMaterial||i&&i.isMeshPhongMaterial||i.envMap)&&null!==l.cameraPosition&&(et.setFromMatrixPosition(e.matrixWorld),ke.uniform3f(l.cameraPosition,et.x,et.y,et.z)),(i&&i.isMeshPhongMaterial||i&&i.isMeshLambertMaterial||i&&i.isMeshBasicMaterial||i&&i.isShaderMaterial||i.skinning)&&null!==l.viewMatrix&&ke.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),
i.skinning)if(n.bindMatrix&&null!==l.bindMatrix&&ke.uniformMatrix4fv(l.bindMatrix,!1,n.bindMatrix.elements),n.bindMatrixInverse&&null!==l.bindMatrixInverse&&ke.uniformMatrix4fv(l.bindMatrixInverse,!1,n.bindMatrixInverse.elements),gt&&n.skeleton&&n.skeleton.useVertexTexture){if(null!==l.boneTexture){var c=ee();ke.uniform1i(l.boneTexture,c),Ne.setTexture(n.skeleton.boneTexture,c)}null!==l.boneTextureWidth&&ke.uniform1i(l.boneTextureWidth,n.skeleton.boneTextureWidth),null!==l.boneTextureHeight&&ke.uniform1i(l.boneTextureHeight,n.skeleton.boneTextureHeight)}else n.skeleton&&n.skeleton.boneMatrices&&null!==l.boneGlobalMatrices&&ke.uniformMatrix4fv(l.boneGlobalMatrices,!1,n.skeleton.boneMatrices);return o&&(r&&i.fog&&q(u,r),(i&&i.isMeshPhongMaterial||i&&i.isMeshLambertMaterial||i.lights)&&(rt&&(s=!0,ne(t),rt=!1),s?(Z(u,it),Q(u,!0)):Q(u,!1)),(i&&i.isMeshBasicMaterial||i&&i.isMeshLambertMaterial||i&&i.isMeshPhongMaterial)&&W(u,i),i&&i.isLineBasicMaterial?G(u,i):i&&i.isLineDashedMaterial?(G(u,i),j(u,i)):i&&i.isPointCloudMaterial?X(u,i):i&&i.isMeshPhongMaterial?Y(u,i):i&&i.isMeshLambertMaterial?K(u,i):i&&i.isMeshDepthMaterial?(u.mNear.value=e.near,u.mFar.value=e.far,u.opacity.value=i.opacity):i&&i.isMeshNormalMaterial&&(u.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&J(u,t),te(i.uniformsList)),$(l,n),null!==l.modelMatrix&&ke.uniformMatrix4fv(l.modelMatrix,!1,n.matrixWorld.elements),h}function W(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap&&(r=t.alphaMap),void 0!==r){var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isWebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function G(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function j(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function X(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=ve.height/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}function q(e,t){e.fogColor.value=t.color,t&&t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t&&t.isFogExp2&&(e.fogDensity.value=t.density)}function Y(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function K(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function Q(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function J(e,t){if(e.shadowMatrix)for(var r=0,i=0,n=t.length;n>i;i++){var a=t[i];a.castShadow&&(a&&a.isSpotLight||a&&a.isDirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[r]=a.shadowMap,e.shadowMapSize.value[r]=a.shadowMapSize,e.shadowMatrix.value[r]=a.shadowMatrix,e.shadowDarkness.value[r]=a.shadowDarkness,e.shadowBias.value[r]=a.shadowBias,r++)}}function $(e,t){ke.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&ke.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function ee(){var e=je;return e>=ct&&r("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ct),je+=1,e}function te(e){for(var t,i,n,a=0,o=e.length;o>a;a++){var s=e[a][0];if(s.needsUpdate!==!1){var h=s.type,l=s.value,u=e[a][1];switch(h){case"1i":ke.uniform1i(u,l);break;case"1f":ke.uniform1f(u,l);break;case"2f":ke.uniform2f(u,l[0],l[1]);break;case"3f":ke.uniform3f(u,l[0],l[1],l[2]);break;case"4f":ke.uniform4f(u,l[0],l[1],l[2],l[3]);break;case"1iv":ke.uniform1iv(u,l);break;case"3iv":ke.uniform3iv(u,l);break;case"1fv":ke.uniform1fv(u,l);break;case"2fv":ke.uniform2fv(u,l);break;case"3fv":ke.uniform3fv(u,l);break;case"4fv":ke.uniform4fv(u,l);break;case"Matrix3fv":ke.uniformMatrix3fv(u,!1,l);break;case"Matrix4fv":ke.uniformMatrix4fv(u,!1,l);break;case"i":ke.uniform1i(u,l);break;case"f":ke.uniform1f(u,l);break;case"v2":ke.uniform2f(u,l.x,l.y);break;case"v3":ke.uniform3f(u,l.x,l.y,l.z);break;case"v4":ke.uniform4f(u,l.x,l.y,l.z,l.w);break;case"c":ke.uniform3f(u,l.r,l.g,l.b);break;case"iv1":ke.uniform1iv(u,l);break;case"iv":ke.uniform3iv(u,l);break;case"fv1":ke.uniform1fv(u,l);break;case"fv":ke.uniform3fv(u,l);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var c=0,d=l.length;d>c;c++)n=2*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y;ke.uniform2fv(u,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(var c=0,d=l.length;d>c;c++)n=3*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y,s._array[n+2]=l[c].z;ke.uniform3fv(u,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(var c=0,d=l.length;d>c;c++)n=4*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y,s._array[n+2]=l[c].z,s._array[n+3]=l[c].w;ke.uniform4fv(u,s._array);break;case"m3":ke.uniformMatrix3fv(u,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(var c=0,d=l.length;d>c;c++)l[c].flattenToArrayOffset(s._array,9*c);ke.uniformMatrix3fv(u,!1,s._array);break;case"m4":ke.uniformMatrix4fv(u,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(var c=0,d=l.length;d>c;c++)l[c].flattenToArrayOffset(s._array,16*c);ke.uniformMatrix4fv(u,!1,s._array);break;case"t":if(t=l,i=ee(),ke.uniform1i(u,i),!t)continue;t&&t.isCubeTexture||t.image instanceof Array&&6===t.image.length?se(t,i):t&&t.isWebGLRenderTargetCube?he(t,i):Ne.setTexture(t,i);break;case"tv":void 0===s._array&&(s._array=[]);for(var c=0,d=s.value.length;d>c;c++)s._array[c]=ee();ke.uniform1iv(u,s._array);for(var c=0,d=s.value.length;d>c;c++)t=s.value[c],i=s._array[c],t&&Ne.setTexture(t,i);break;default:r("THREE.WebGLRenderer: Unknown uniform type: "+h)}}}}function re(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function ie(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function ne(e){var t,r,i,n,a,o,s,h,l=0,u=0,c=0,d=it,f=d.directional.colors,p=d.directional.positions,m=d.point.colors,g=d.point.positions,v=d.point.distances,y=d.point.decays,x=d.spot.colors,b=d.spot.positions,_=d.spot.distances,w=d.spot.directions,M=d.spot.anglesCos,S=d.spot.exponents,T=d.spot.decays,E=d.hemi.skyColors,A=d.hemi.groundColors,C=d.hemi.positions,L=0,R=0,P=0,F=0,U=0,D=0,B=0,z=0,k=0,N=0,O=0,I=0;for(t=0,r=e.length;r>t;t++)if(i=e[t],!i.onlyShadow)if(n=i.color,s=i.intensity,h=i.distance,i&&i.isAmbientLight){if(!i.visible)continue;l+=n.r,u+=n.g,c+=n.b}else if(i&&i.isDirectionalLight){if(U+=1,!i.visible)continue;tt.setFromMatrixPosition(i.matrixWorld),et.setFromMatrixPosition(i.target.matrixWorld),tt.sub(et),tt.normalize(),k=3*L,p[k]=tt.x,p[k+1]=tt.y,p[k+2]=tt.z,ie(f,k,n,s),L+=1}else if(i&&i.isPointLight){if(D+=1,!i.visible)continue;N=3*R,ie(m,N,n,s),et.setFromMatrixPosition(i.matrixWorld),g[N]=et.x,g[N+1]=et.y,g[N+2]=et.z,v[R]=h,y[R]=0===i.distance?0:i.decay,R+=1}else if(i&&i.isSpotLight){if(B+=1,!i.visible)continue;O=3*P,ie(x,O,n,s),tt.setFromMatrixPosition(i.matrixWorld),b[O]=tt.x,b[O+1]=tt.y,b[O+2]=tt.z,_[P]=h,et.setFromMatrixPosition(i.target.matrixWorld),tt.sub(et),tt.normalize(),w[O]=tt.x,w[O+1]=tt.y,w[O+2]=tt.z,M[P]=Math.cos(i.angle),S[P]=i.exponent,T[P]=0===i.distance?0:i.decay,P+=1}else if(i&&i.isHemisphereLight){if(z+=1,!i.visible)continue;tt.setFromMatrixPosition(i.matrixWorld),tt.normalize(),I=3*F,C[I]=tt.x,C[I+1]=tt.y,C[I+2]=tt.z,a=i.color,o=i.groundColor,ie(E,I,a,s),ie(A,I,o,s),F+=1}for(t=3*L,r=Math.max(f.length,3*U);r>t;t++)f[t]=0;for(t=3*R,r=Math.max(m.length,3*D);r>t;t++)m[t]=0;for(t=3*P,r=Math.max(x.length,3*B);r>t;t++)x[t]=0;for(t=3*F,r=Math.max(E.length,3*z);r>t;t++)E[t]=0;for(t=3*F,r=Math.max(A.length,3*z);r>t;t++)A[t]=0;d.directional.length=L,d.point.length=R,d.spot.length=P,d.hemi.length=F,d.ambient[0]=l,d.ambient[1]=u,d.ambient[2]=c}function ae(t,i,n){var a;n?(ke.texParameteri(t,ke.TEXTURE_WRAP_S,fe(i.wrapS)),ke.texParameteri(t,ke.TEXTURE_WRAP_T,fe(i.wrapT)),ke.texParameteri(t,ke.TEXTURE_MAG_FILTER,fe(i.magFilter)),ke.texParameteri(t,ke.TEXTURE_MIN_FILTER,fe(i.minFilter))):(ke.texParameteri(t,ke.TEXTURE_WRAP_S,ke.CLAMP_TO_EDGE),ke.texParameteri(t,ke.TEXTURE_WRAP_T,ke.CLAMP_TO_EDGE),(i.wrapS!==e.ClampToEdgeWrapping||i.wrapT!==e.ClampToEdgeWrapping)&&r("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+i.sourceFile+" )"),ke.texParameteri(t,ke.TEXTURE_MAG_FILTER,de(i.magFilter)),ke.texParameteri(t,ke.TEXTURE_MIN_FILTER,de(i.minFilter)),i.minFilter!==e.NearestFilter&&i.minFilter!==e.LinearFilter&&r("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+i.sourceFile+" )")),a=st.get("EXT_texture_filter_anisotropic"),a&&i.type!==e.FloatType&&i.type!==e.HalfFloatType&&(i.anisotropy>1||i.__currentAnisotropy)&&(ke.texParameterf(t,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,Ne.getMaxAnisotropy())),i.__currentAnisotropy=i.anisotropy)}function oe(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i);var a=n.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),r("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function se(t,i){if(6===t.image.length)if(t.needsUpdate){t.image.__webglTextureCube||(t.addEventListener("dispose",Lt),t.image.__webglTextureCube=ke.createTexture(),Ne.info.memory.textures++),ke.activeTexture(ke.TEXTURE0+i),ke.bindTexture(ke.TEXTURE_CUBE_MAP,t.image.__webglTextureCube),ke.pixelStorei(ke.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var n=t&&t.isCompressedTexture,a=t.image[0]&&t.image[0].isDataTexture,o=[],s=0;6>s;s++)o[s]=!Ne.autoScaleCubemaps||n||a?a?t.image[s].image:t.image[s]:oe(t.image[s],pt);var h=o[0],l=e.Math.isPowerOfTwo(h.width)&&e.Math.isPowerOfTwo(h.height),u=fe(t.format),c=fe(t.type);ae(ke.TEXTURE_CUBE_MAP,t,l);for(var s=0;6>s;s++)if(n)for(var d,f=o[s].mipmaps,p=0,m=f.length;m>p;p++)d=f[p],t.format!==e.RGBAFormat&&t.format!==e.RGBFormat?_t().indexOf(u)>-1?ke.compressedTexImage2D(ke.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,u,d.width,d.height,0,d.data):r("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):ke.texImage2D(ke.TEXTURE_CUBE_MAP_POSITIVE_X+s,p,u,d.width,d.height,0,u,c,d.data);else a?ke.texImage2D(ke.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,u,o[s].width,o[s].height,0,u,c,o[s].data):ke.texImage2D(ke.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,u,u,c,o[s]);t.generateMipmaps&&l&&ke.generateMipmap(ke.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else ke.activeTexture(ke.TEXTURE0+i),ke.bindTexture(ke.TEXTURE_CUBE_MAP,t.image.__webglTextureCube)}function he(e,t){ke.activeTexture(ke.TEXTURE0+t),ke.bindTexture(ke.TEXTURE_CUBE_MAP,e.__webglTexture)}function le(e,t,r){ke.bindFramebuffer(ke.FRAMEBUFFER,e),ke.framebufferTexture2D(ke.FRAMEBUFFER,ke.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function ue(e,t){ke.bindRenderbuffer(ke.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(ke.renderbufferStorage(ke.RENDERBUFFER,ke.DEPTH_COMPONENT16,t.width,t.height),ke.framebufferRenderbuffer(ke.FRAMEBUFFER,ke.DEPTH_ATTACHMENT,ke.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(ke.renderbufferStorage(ke.RENDERBUFFER,ke.DEPTH_STENCIL,t.width,t.height),ke.framebufferRenderbuffer(ke.FRAMEBUFFER,ke.DEPTH_STENCIL_ATTACHMENT,ke.RENDERBUFFER,e)):ke.renderbufferStorage(ke.RENDERBUFFER,ke.RGBA4,t.width,t.height)}function ce(e){e&&e.isWebGLRenderTargetCube?(ke.bindTexture(ke.TEXTURE_CUBE_MAP,e.__webglTexture),ke.generateMipmap(ke.TEXTURE_CUBE_MAP),ke.bindTexture(ke.TEXTURE_CUBE_MAP,null)):(ke.bindTexture(ke.TEXTURE_2D,e.__webglTexture),ke.generateMipmap(ke.TEXTURE_2D),ke.bindTexture(ke.TEXTURE_2D,null))}function de(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?ke.NEAREST:ke.LINEAR}function fe(t){var r;if(t===e.RepeatWrapping)return ke.REPEAT;if(t===e.ClampToEdgeWrapping)return ke.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return ke.MIRRORED_REPEAT;if(t===e.NearestFilter)return ke.NEAREST;if(t===e.NearestMipMapNearestFilter)return ke.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return ke.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return ke.LINEAR;if(t===e.LinearMipMapNearestFilter)return ke.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return ke.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return ke.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return ke.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return ke.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return ke.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return ke.BYTE;if(t===e.ShortType)return ke.SHORT;if(t===e.UnsignedShortType)return ke.UNSIGNED_SHORT;if(t===e.IntType)return ke.INT;if(t===e.UnsignedIntType)return ke.UNSIGNED_INT;if(t===e.FloatType)return ke.FLOAT;if(r=st.get("OES_texture_half_float"),null!==r&&t===e.HalfFloatType)return r.HALF_FLOAT_OES;if(t===e.AlphaFormat)return ke.ALPHA;if(t===e.RGBFormat)return ke.RGB;if(t===e.RGBAFormat)return ke.RGBA;if(t===e.LuminanceFormat)return ke.LUMINANCE;if(t===e.LuminanceAlphaFormat)return ke.LUMINANCE_ALPHA;if(t===e.AddEquation)return ke.FUNC_ADD;if(t===e.SubtractEquation)return ke.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return ke.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return ke.ZERO;if(t===e.OneFactor)return ke.ONE;if(t===e.SrcColorFactor)return ke.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return ke.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return ke.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return ke.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return ke.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return ke.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return ke.DST_COLOR;if(t===e.OneMinusDstColorFactor)return ke.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return ke.SRC_ALPHA_SATURATE;if(r=st.get("WEBGL_compressed_texture_s3tc"),null!==r){if(t===e.RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r=st.get("WEBGL_compressed_texture_pvrtc"),null!==r){if(t===e.RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===e.RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===e.RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===e.RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r=st.get("EXT_blend_minmax"),null!==r){if(t===e.MinEquation)return r.MIN_EXT;if(t===e.MaxEquation)return r.MAX_EXT}return 0}function pe(e){if(gt&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=ke.getParameter(ke.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),n=i;return void 0!==e&&e&&e.isSkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n),n<e.skeleton.bones.length&&r("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function me(e){for(var t=0,r=0,i=0,n=0,a=0,o=e.length;o>a;a++){var s=e[a];s.onlyShadow||s.visible===!1||(s&&s.isDirectionalLight&&t++,s&&s.isPointLight&&r++,s&&s.isSpotLight&&i++,s&&s.isHemisphereLight&&n++)}return{directional:t,point:r,spot:i,hemi:n}}function ge(e){for(var t=0,r=0,i=e.length;i>r;r++){var n=e[r];n.castShadow&&(n&&n.isSpotLight&&t++,n&&n.isDirectionalLight&&!n.shadowCascade&&t++)}return t}this.isWebGLRenderer=!0,console.log("THREE.WebGLRenderer","jsnext"),t=t||{};var ve=void 0!==t.canvas?t.canvas:document.createElement("canvas"),ye=void 0!==t.context?t.context:null,xe=1,be=void 0!==t.precision?t.precision:"highp",_e=void 0!==t.alpha?t.alpha:!1,we=void 0!==t.depth?t.depth:!0,Me=void 0!==t.stencil?t.stencil:!0,Se=void 0!==t.antialias?t.antialias:!1,Te=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,Ee=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,Ae=void 0!==t.logarithmicDepthBuffer?t.logarithmicDepthBuffer:!1,Ce=new R(0),Le=0,Re=[],Pe={},Fe=[],Ue=[],De=[],Be=[],ze=[];this.domElement=ve,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var ke,Ne=this,Oe=[],Ie=null,He=null,Ve=-1,We="",Ge=null,je=0,Xe=0,qe=0,Ye=ve.width,Ke=ve.height,Ze=0,Qe=0,Je=new kt,$e=new o,et=new h,tt=new h,rt=!0,it={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var nt={alpha:_e,depth:we,stencil:Me,antialias:Se,premultipliedAlpha:Te,preserveDrawingBuffer:Ee};if(ke=ye||ve.getContext("webgl",nt)||ve.getContext("experimental-webgl",nt),null===ke)throw null!==ve.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";ve.addEventListener("webglcontextlost",function(e){e.preventDefault(),ut(),lt(),Pe={}},!1)}catch(at){i("THREE.WebGLRenderer: "+at)}var ot=new Zt(ke,fe);void 0===ke.getShaderPrecisionFormat&&(ke.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var st=new Kt(ke);st.get("OES_texture_float"),st.get("OES_texture_float_linear"),st.get("OES_texture_half_float"),st.get("OES_texture_half_float_linear"),st.get("OES_standard_derivatives"),Ae&&st.get("EXT_frag_depth");var ht=function(e,t,r,i){Te===!0&&(e*=i,t*=i,r*=i),ke.clearColor(e,t,r,i)},lt=function(){ke.clearColor(0,0,0,1),ke.clearDepth(1),ke.clearStencil(0),ke.enable(ke.DEPTH_TEST),ke.depthFunc(ke.LEQUAL),ke.frontFace(ke.CCW),ke.cullFace(ke.BACK),ke.enable(ke.CULL_FACE),ke.enable(ke.BLEND),ke.blendEquation(ke.FUNC_ADD),ke.blendFunc(ke.SRC_ALPHA,ke.ONE_MINUS_SRC_ALPHA),ke.viewport(Xe,qe,Ye,Ke),ht(Ce.r,Ce.g,Ce.b,Le)},ut=function(){Ie=null,Ge=null,We="",Ve=-1,rt=!0,ot.reset()};lt(),this.context=ke,this.state=ot;var ct=ke.getParameter(ke.MAX_TEXTURE_IMAGE_UNITS),dt=ke.getParameter(ke.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ft=ke.getParameter(ke.MAX_TEXTURE_SIZE),pt=ke.getParameter(ke.MAX_CUBE_MAP_TEXTURE_SIZE),mt=dt>0,gt=mt&&st.get("OES_texture_float"),vt=ke.getShaderPrecisionFormat(ke.VERTEX_SHADER,ke.HIGH_FLOAT),yt=ke.getShaderPrecisionFormat(ke.VERTEX_SHADER,ke.MEDIUM_FLOAT),xt=ke.getShaderPrecisionFormat(ke.FRAGMENT_SHADER,ke.HIGH_FLOAT),bt=ke.getShaderPrecisionFormat(ke.FRAGMENT_SHADER,ke.MEDIUM_FLOAT),_t=function(){var e;return function(){if(void 0!==e)return e;if(e=[],st.get("WEBGL_compressed_texture_pvrtc")||st.get("WEBGL_compressed_texture_s3tc"))for(var t=ke.getParameter(ke.COMPRESSED_TEXTURE_FORMATS),r=0;r<t.length;r++)e.push(t[r]);return e}}(),wt=vt.precision>0&&xt.precision>0,Mt=yt.precision>0&&bt.precision>0;"highp"!==be||wt||(Mt?(be="mediump",r("THREE.WebGLRenderer: highp not supported, using mediump.")):(be="lowp",r("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==be||Mt||(be="lowp",r("THREE.WebGLRenderer: mediump not supported, using lowp."));var St=new Yt(this,Re,Pe,Fe),Tt=new qt(this,Be),Et=new Xt(this,ze);this.getContext=function(){return ke},this.forceContextLoss=function(){st.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return mt},this.supportsFloatTextures=function(){return st.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return st.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return st.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return st.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return st.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return st.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=st.get("EXT_texture_filter_anisotropic");return e=null!==t?ke.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return be},this.getPixelRatio=function(){return xe},this.setPixelRatio=function(e){xe=e},this.setSize=function(e,t,r){ve.width=e*xe,ve.height=t*xe,r!==!1&&(ve.style.width=e+"px",ve.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){Xe=e*xe,qe=t*xe,Ye=r*xe,Ke=i*xe,ke.viewport(Xe,qe,Ye,Ke)},this.setScissor=function(e,t,r,i){ke.scissor(e*xe,t*xe,r*xe,i*xe)},this.enableScissorTest=function(e){e?ke.enable(ke.SCISSOR_TEST):ke.disable(ke.SCISSOR_TEST)},this.getClearColor=function(){return Ce},this.setClearColor=function(e,t){Ce.set(e),Le=void 0!==t?t:1,ht(Ce.r,Ce.g,Ce.b,Le)},this.getClearAlpha=function(){return Le},this.setClearAlpha=function(e){Le=e,ht(Ce.r,Ce.g,Ce.b,Le)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=ke.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=ke.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=ke.STENCIL_BUFFER_BIT),ke.clear(i)},this.clearColor=function(){ke.clear(ke.COLOR_BUFFER_BIT)},this.clearDepth=function(){ke.clear(ke.DEPTH_BUFFER_BIT)},this.clearStencil=function(){ke.clear(ke.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.resetGLState=ut;var At=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",At),N(e)})},Ct=function(e){var t=e.target;t.removeEventListener("dispose",Ct),Ut(t)},Lt=function(e){var t=e.target;t.removeEventListener("dispose",Lt),Dt(t),Ne.info.memory.textures--},Rt=function(e){var t=e.target;t.removeEventListener("dispose",Rt),Bt(t),Ne.info.memory.textures--},Pt=function(e){var t=e.target;t.removeEventListener("dispose",Pt),zt(t)},Ft=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],r=0,i=t.length;i>r;r++){var n=t[r];void 0!==e[n]&&(ke.deleteBuffer(e[n]),delete e[n])}if(void 0!==e.__webglCustomAttributesList){for(var n in e.__webglCustomAttributesList)ke.deleteBuffer(e.__webglCustomAttributesList[n].buffer);delete e.__webglCustomAttributesList}Ne.info.memory.geometries--},Ut=function(e){if(delete e.__webglInit,e&&e.isBufferGeometry){for(var t in e.attributes){var r=e.attributes[t];void 0!==r.buffer&&(ke.deleteBuffer(r.buffer),delete r.buffer)}Ne.info.memory.geometries--}else{var i=Nt[e.id];if(void 0!==i){for(var n=0,a=i.length;a>n;n++){var o=i[n];if(void 0!==o.numMorphTargets){for(var s=0,h=o.numMorphTargets;h>s;s++)ke.deleteBuffer(o.__webglMorphTargetsBuffers[s]);delete o.__webglMorphTargetsBuffers}if(void 0!==o.numMorphNormals){for(var s=0,h=o.numMorphNormals;h>s;s++)ke.deleteBuffer(o.__webglMorphNormalsBuffers[s]);delete o.__webglMorphNormalsBuffers}Ft(o)}delete Nt[e.id]}else Ft(e)}We=""},Dt=function(e){if(e.image&&e.image.__webglTextureCube)ke.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;ke.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Bt=function(e){if(e&&void 0!==e.__webglTexture){if(ke.deleteTexture(e.__webglTexture),delete e.__webglTexture,e&&e.isWebGLRenderTargetCube)for(var t=0;6>t;t++)ke.deleteFramebuffer(e.__webglFramebuffer[t]),ke.deleteRenderbuffer(e.__webglRenderbuffer[t]);else ke.deleteFramebuffer(e.__webglFramebuffer),ke.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},zt=function(e){var t=e.program.program;if(void 0!==t){e.program=void 0;var r,i,n,a=!1;for(r=0,i=Oe.length;i>r;r++)if(n=Oe[r],n.program===t){n.usedTimes--,0===n.usedTimes&&(a=!0);break}if(a===!0){var o=[];for(r=0,i=Oe.length;i>r;r++)n=Oe[r],n.program!==t&&o.push(n);Oe=o,ke.deleteProgram(t),Ne.info.memory.programs--}}};this.renderBufferImmediate=function(t,r,i){if(ot.initAttributes(),t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=ke.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=ke.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=ke.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=ke.createBuffer()),t.hasPositions&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglVertexBuffer),ke.bufferData(ke.ARRAY_BUFFER,t.positionArray,ke.DYNAMIC_DRAW),ot.enableAttribute(r.attributes.position),ke.vertexAttribPointer(r.attributes.position,3,ke.FLOAT,!1,0,0)),t.hasNormals){if(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglNormalBuffer),(i&&i.isMeshPhongMaterial)===!1&&i.shading===e.FlatShading){var n,a,o,s,h,l,u,c,d,f,p,m,g,v,y=3*t.count;for(v=0;y>v;v+=9)g=t.normalArray,s=g[v],u=g[v+1],f=g[v+2],h=g[v+3],c=g[v+4],p=g[v+5],l=g[v+6],d=g[v+7],m=g[v+8],n=(s+h+l)/3,a=(u+c+d)/3,o=(f+p+m)/3,g[v]=n,g[v+1]=a,g[v+2]=o,g[v+3]=n,g[v+4]=a,g[v+5]=o,g[v+6]=n,g[v+7]=a,g[v+8]=o}ke.bufferData(ke.ARRAY_BUFFER,t.normalArray,ke.DYNAMIC_DRAW),ot.enableAttribute(r.attributes.normal),ke.vertexAttribPointer(r.attributes.normal,3,ke.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglUvBuffer),ke.bufferData(ke.ARRAY_BUFFER,t.uvArray,ke.DYNAMIC_DRAW),ot.enableAttribute(r.attributes.uv),ke.vertexAttribPointer(r.attributes.uv,2,ke.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==e.NoColors&&(ke.bindBuffer(ke.ARRAY_BUFFER,t.__webglColorBuffer),ke.bufferData(ke.ARRAY_BUFFER,t.colorArray,ke.DYNAMIC_DRAW),ot.enableAttribute(r.attributes.color),ke.vertexAttribPointer(r.attributes.color,3,ke.FLOAT,!1,0,0)),ot.disableUnusedAttributes(),ke.drawArrays(ke.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,r,i,n,a,o){if(n.visible!==!1){B(o);var s=V(t,r,i,n,o),h=!1,l=n.wireframe?1:0,u="direct_"+a.id+"_"+s.id+"_"+l;if(u!==We&&(We=u,h=!0),h&&ot.initAttributes(),o&&o.isMesh){var c=n.wireframe===!0?ke.LINES:ke.TRIANGLES,d=a.attributes.index;if(d){var f,p;d.array instanceof Uint32Array&&st.get("OES_element_index_uint")?(f=ke.UNSIGNED_INT,p=4):(f=ke.UNSIGNED_SHORT,p=2);var m=a.offsets;if(0===m.length)h&&(y(n,s,a,0),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,d.array.length,f,0),Ne.info.render.calls++,Ne.info.render.vertices+=d.array.length,Ne.info.render.faces+=d.array.length/3;else{h=!0;for(var g=0,v=m.length;v>g;g++){var x=m[g].index;h&&(y(n,s,a,x),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,m[g].count,f,m[g].start*p),Ne.info.render.calls++,Ne.info.render.vertices+=m[g].count,Ne.info.render.faces+=m[g].count/3}}}else{h&&y(n,s,a,0);var b=a.attributes.position;ke.drawArrays(c,0,b.array.length/b.itemSize),Ne.info.render.calls++,Ne.info.render.vertices+=b.array.length/b.itemSize,Ne.info.render.faces+=b.array.length/(3*b.itemSize)}}else if(o&&o.isPointCloud){var c=ke.POINTS,d=a.attributes.index;if(d){var f,p;d.array instanceof Uint32Array&&st.get("OES_element_index_uint")?(f=ke.UNSIGNED_INT,p=4):(f=ke.UNSIGNED_SHORT,p=2);var m=a.offsets;if(0===m.length)h&&(y(n,s,a,0),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,d.array.length,f,0),Ne.info.render.calls++,Ne.info.render.points+=d.array.length;else{m.length>1&&(h=!0);for(var g=0,v=m.length;v>g;g++){var x=m[g].index;h&&(y(n,s,a,x),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,m[g].count,f,m[g].start*p),Ne.info.render.calls++,Ne.info.render.points+=m[g].count}}}else{h&&y(n,s,a,0);var b=a.attributes.position,m=a.offsets;if(0===m.length)ke.drawArrays(c,0,b.array.length/3),Ne.info.render.calls++,Ne.info.render.points+=b.array.length/3;else for(var g=0,v=m.length;v>g;g++)ke.drawArrays(c,m[g].index,m[g].count),Ne.info.render.calls++,Ne.info.render.points+=m[g].count}}else if(o&&o.isLine){var c=o.mode===e.LineStrip?ke.LINE_STRIP:ke.LINES;ot.setLineWidth(n.linewidth*xe);var d=a.attributes.index;if(d){var f,p;d.array instanceof Uint32Array?(f=ke.UNSIGNED_INT,p=4):(f=ke.UNSIGNED_SHORT,p=2);var m=a.offsets;if(0===m.length)h&&(y(n,s,a,0),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,d.array.length,f,0),Ne.info.render.calls++,Ne.info.render.vertices+=d.array.length;else{m.length>1&&(h=!0);for(var g=0,v=m.length;v>g;g++){var x=m[g].index;h&&(y(n,s,a,x),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,d.buffer)),ke.drawElements(c,m[g].count,f,m[g].start*p),Ne.info.render.calls++,Ne.info.render.vertices+=m[g].count}}}else{h&&y(n,s,a,0);var b=a.attributes.position,m=a.offsets;if(0===m.length)ke.drawArrays(c,0,b.array.length/3),Ne.info.render.calls++,Ne.info.render.vertices+=b.array.length/3;else for(var g=0,v=m.length;v>g;g++)ke.drawArrays(c,m[g].index,m[g].count),Ne.info.render.calls++,Ne.info.render.vertices+=m[g].count}}}},this.renderBuffer=function(t,r,i,n,a,o){if(n.visible!==!1){B(o);var s=V(t,r,i,n,o),h=s.attributes,l=!1,u=n.wireframe?1:0,c=a.id+"_"+s.id+"_"+u;if(c!==We&&(We=c,l=!0),l&&ot.initAttributes(),!n.morphTargets&&h.position>=0?l&&(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglVertexBuffer),ot.enableAttribute(h.position),ke.vertexAttribPointer(h.position,3,ke.FLOAT,!1,0,0)):o.morphTargetBase&&x(n,a,o),l){if(a.__webglCustomAttributesList)for(var d=0,f=a.__webglCustomAttributesList.length;f>d;d++){var p=a.__webglCustomAttributesList[d];h[p.buffer.belongsToAttribute]>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,p.buffer),ot.enableAttribute(h[p.buffer.belongsToAttribute]),ke.vertexAttribPointer(h[p.buffer.belongsToAttribute],p.size,ke.FLOAT,!1,0,0))}h.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglColorBuffer),ot.enableAttribute(h.color),ke.vertexAttribPointer(h.color,3,ke.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&ke.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)),h.normal>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglNormalBuffer),ot.enableAttribute(h.normal),ke.vertexAttribPointer(h.normal,3,ke.FLOAT,!1,0,0)),
h.tangent>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglTangentBuffer),ot.enableAttribute(h.tangent),ke.vertexAttribPointer(h.tangent,4,ke.FLOAT,!1,0,0)),h.uv>=0&&(o.geometry.faceVertexUvs[0]?(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglUVBuffer),ot.enableAttribute(h.uv),ke.vertexAttribPointer(h.uv,2,ke.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&ke.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)),h.uv2>=0&&(o.geometry.faceVertexUvs[1]?(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglUV2Buffer),ot.enableAttribute(h.uv2),ke.vertexAttribPointer(h.uv2,2,ke.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&ke.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)),n.skinning&&h.skinIndex>=0&&h.skinWeight>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglSkinIndicesBuffer),ot.enableAttribute(h.skinIndex),ke.vertexAttribPointer(h.skinIndex,4,ke.FLOAT,!1,0,0),ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglSkinWeightsBuffer),ot.enableAttribute(h.skinWeight),ke.vertexAttribPointer(h.skinWeight,4,ke.FLOAT,!1,0,0)),h.lineDistance>=0&&(ke.bindBuffer(ke.ARRAY_BUFFER,a.__webglLineDistanceBuffer),ot.enableAttribute(h.lineDistance),ke.vertexAttribPointer(h.lineDistance,1,ke.FLOAT,!1,0,0))}if(ot.disableUnusedAttributes(),o&&o.isMesh){var m=a.__typeArray===Uint32Array?ke.UNSIGNED_INT:ke.UNSIGNED_SHORT;n.wireframe?(ot.setLineWidth(n.wireframeLinewidth*xe),l&&ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),ke.drawElements(ke.LINES,a.__webglLineCount,m,0)):(l&&ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),ke.drawElements(ke.TRIANGLES,a.__webglFaceCount,m,0)),Ne.info.render.calls++,Ne.info.render.vertices+=a.__webglFaceCount,Ne.info.render.faces+=a.__webglFaceCount/3}else if(o&&o.isLine){var g=o.mode===e.LineStrip?ke.LINE_STRIP:ke.LINES;ot.setLineWidth(n.linewidth*xe),ke.drawArrays(g,0,a.__webglLineCount),Ne.info.render.calls++}else o&&o.isPointCloud&&(ke.drawArrays(ke.POINTS,0,a.__webglParticleCount),Ne.info.render.calls++,Ne.info.render.points+=a.__webglParticleCount)}},this.render=function(t,r,n,a){if((r&&r.isCamera)===!1)return void i("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o=t.fog;We="",Ve=-1,Ge=null,rt=!0,t.autoUpdate===!0&&t.updateMatrixWorld(),void 0===r.parent&&r.updateMatrixWorld(),t.traverse(function(e){e&&e.isSkinnedMesh&&e.skeleton.update()}),r.matrixWorldInverse.getInverse(r.matrixWorld),$e.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Je.setFromMatrix($e),Re.length=0,Ue.length=0,De.length=0,Be.length=0,ze.length=0,M(t),Ne.sortObjects===!0&&(Ue.sort(b),De.sort(_)),St.render(t,r),Ne.info.render.calls=0,Ne.info.render.vertices=0,Ne.info.render.faces=0,Ne.info.render.points=0,this.setRenderTarget(n),(this.autoClear||a)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var s=0,h=Fe.length;h>s;s++){var l=Fe[s],u=l.object;u.visible&&(re(u,r),E(l))}if(t.overrideMaterial){var c=t.overrideMaterial;H(c),S(Ue,r,Re,o,c),S(De,r,Re,o,c),T(Fe,"",r,Re,o,c)}else ot.setBlending(e.NoBlending),S(Ue,r,Re,o,null),T(Fe,"opaque",r,Re,o,null),S(De,r,Re,o,null),T(Fe,"transparent",r,Re,o,null);Tt.render(t,r),Et.render(t,r,Ze,Qe),n&&n.generateMipmaps&&n.minFilter!==e.NearestFilter&&n.minFilter!==e.LinearFilter&&ce(n),ot.setDepthTest(!0),ot.setDepthWrite(!0),ot.setColorWrite(!0)},this.renderImmediateObject=function(e,t,r,i,n){var a=V(e,t,r,i,n);We="",Ne.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(a,ke,Je):n.render(function(e){Ne.renderBufferImmediate(e,a,i)})};var Nt={},Ot=0,It={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(t,r){t===e.CullFaceNone?ke.disable(ke.CULL_FACE):(ke.frontFace(r===e.FrontFaceDirectionCW?ke.CW:ke.CCW),ke.cullFace(t===e.CullFaceBack?ke.BACK:t===e.CullFaceFront?ke.FRONT:ke.FRONT_AND_BACK),ke.enable(ke.CULL_FACE))},this.setMaterialFaces=function(t){ot.setDoubleSided(t.side===e.DoubleSide),ot.setFlipSided(t.side===e.BackSide)},this.uploadTexture=function(t){void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Lt),t.__webglTexture=ke.createTexture(),Ne.info.memory.textures++),ke.bindTexture(ke.TEXTURE_2D,t.__webglTexture),ke.pixelStorei(ke.UNPACK_FLIP_Y_WEBGL,t.flipY),ke.pixelStorei(ke.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ke.pixelStorei(ke.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=oe(t.image,ft);var i=t.image,n=e.Math.isPowerOfTwo(i.width)&&e.Math.isPowerOfTwo(i.height),a=fe(t.format),o=fe(t.type);ae(ke.TEXTURE_2D,t,n);var s,h=t.mipmaps;if(t&&t.isDataTexture)if(h.length>0&&n){for(var l=0,u=h.length;u>l;l++)s=h[l],ke.texImage2D(ke.TEXTURE_2D,l,a,s.width,s.height,0,a,o,s.data);t.generateMipmaps=!1}else ke.texImage2D(ke.TEXTURE_2D,0,a,i.width,i.height,0,a,o,i.data);else if(t&&t.isCompressedTexture)for(var l=0,u=h.length;u>l;l++)s=h[l],t.format!==e.RGBAFormat&&t.format!==e.RGBFormat?_t().indexOf(a)>-1?ke.compressedTexImage2D(ke.TEXTURE_2D,l,a,s.width,s.height,0,s.data):r("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ke.texImage2D(ke.TEXTURE_2D,l,a,s.width,s.height,0,a,o,s.data);else if(h.length>0&&n){for(var l=0,u=h.length;u>l;l++)s=h[l],ke.texImage2D(ke.TEXTURE_2D,l,a,a,o,s);t.generateMipmaps=!1}else ke.texImage2D(ke.TEXTURE_2D,0,a,a,o,t.image);t.generateMipmaps&&n&&ke.generateMipmap(ke.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()},this.setTexture=function(e,t){ke.activeTexture(ke.TEXTURE0+t),e.needsUpdate?Ne.uploadTexture(e):ke.bindTexture(ke.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(t){var r=t&&t.isWebGLRenderTargetCube;if(t&&void 0===t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",Rt),t.__webglTexture=ke.createTexture(),Ne.info.memory.textures++;var i=e.Math.isPowerOfTwo(t.width)&&e.Math.isPowerOfTwo(t.height),n=fe(t.format),a=fe(t.type);if(r){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],ke.bindTexture(ke.TEXTURE_CUBE_MAP,t.__webglTexture),ae(ke.TEXTURE_CUBE_MAP,t,i);for(var o=0;6>o;o++)t.__webglFramebuffer[o]=ke.createFramebuffer(),t.__webglRenderbuffer[o]=ke.createRenderbuffer(),ke.texImage2D(ke.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,t.width,t.height,0,n,a,null),le(t.__webglFramebuffer[o],t,ke.TEXTURE_CUBE_MAP_POSITIVE_X+o),ue(t.__webglRenderbuffer[o],t);i&&ke.generateMipmap(ke.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=ke.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:ke.createRenderbuffer(),ke.bindTexture(ke.TEXTURE_2D,t.__webglTexture),ae(ke.TEXTURE_2D,t,i),ke.texImage2D(ke.TEXTURE_2D,0,n,t.width,t.height,0,n,a,null),le(t.__webglFramebuffer,t,ke.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?ke.framebufferRenderbuffer(ke.FRAMEBUFFER,ke.DEPTH_ATTACHMENT,ke.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&ke.framebufferRenderbuffer(ke.FRAMEBUFFER,ke.DEPTH_STENCIL_ATTACHMENT,ke.RENDERBUFFER,t.__webglRenderbuffer):ue(t.__webglRenderbuffer,t),i&&ke.generateMipmap(ke.TEXTURE_2D);r?ke.bindTexture(ke.TEXTURE_CUBE_MAP,null):ke.bindTexture(ke.TEXTURE_2D,null),ke.bindRenderbuffer(ke.RENDERBUFFER,null),ke.bindFramebuffer(ke.FRAMEBUFFER,null)}var s,h,l,u,c;t?(s=r?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,h=t.width,l=t.height,u=0,c=0):(s=null,h=Ye,l=Ke,u=Xe,c=qe),s!==He&&(ke.bindFramebuffer(ke.FRAMEBUFFER,s),ke.viewport(u,c,h,l),He=s),Ze=h,Qe=l},this.readRenderTargetPixels=function(t,r,i,n,a,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(t.__webglFramebuffer){if(t.format!==e.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;t.__webglFramebuffer!==He&&(ke.bindFramebuffer(ke.FRAMEBUFFER,t.__webglFramebuffer),s=!0),ke.checkFramebufferStatus(ke.FRAMEBUFFER)===ke.FRAMEBUFFER_COMPLETE?ke.readPixels(r,i,n,a,ke.RGBA,ke.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&ke.bindFramebuffer(ke.FRAMEBUFFER,He)}},this.initMaterial=function(){r("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){r("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){r("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){r("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}function Jt(e){this.isWebGLTextures=!0;var t={};this.get=function(e){return void 0!==t[e.id]?t[e.id]:this.create(e)},this.create=function(r){return r.addEventListener("dispose",this["delete"]),t[r.id]=e.createTexture(),t[r.id]},this["delete"]=function(r){r.removeEventListener("dispose",this["delete"]),e.deleteTexture(t[r.id]),delete t[r.id]}}function $t(e,t,r){this.isFog=!0,this.name="",this.color=new R(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function er(e,t){this.isFogExp2=!0,this.name="",this.color=new R(e),this.density=void 0!==t?t:25e-5}function tr(e,t,r,i,n,a,o,s,h){this.isVideoTexture=!0,ee.call(this,e,t,r,i,n,a,o,s,h),this.generateMipmaps=!1;var l=this,u=function(){requestAnimationFrame(u),e.readyState===e.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)};u()}e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.MinEquation=103,e.MaxEquation=104,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=300,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.SphericalReflectionMapping=305,e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.HalfFloatType=1025,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGBEFormat=e.RGBAFormat,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e.RGB_PVRTC_4BPPV1_Format=2100,e.RGB_PVRTC_2BPPV1_Format=2101,e.RGBA_PVRTC_4BPPV1_Format=2102,e.RGBA_PVRTC_2BPPV1_Format=2103,e.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;return function(){for(var n=0;36>n;n++)8==n||13==n||18==n||23==n?r[n]="-":14==n?r[n]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[n]=t[19==n?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return t>e?t:e>r?r:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},o.prototype={constructor:o,set:function(e,t,r,i,n,a,o,s,h,l,u,c,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=h,g[6]=l,g[10]=u,g[14]=c,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return r("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new h;return function(t){var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),a=1/e.set(i[4],i[5],i[6]).length(),o=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,this}}(),makeRotationFromEuler:function(e){(e&&e.isEuler)===!1&&i("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,a=e.z,o=Math.cos(r),s=Math.sin(r),h=Math.cos(n),l=Math.sin(n),u=Math.cos(a),c=Math.sin(a);if("XYZ"===e.order){var d=o*u,f=o*c,p=s*u,m=s*c;t[0]=h*u,t[4]=-h*c,t[8]=l,t[1]=f+p*l,t[5]=d-m*l,t[9]=-s*h,t[2]=m-d*l,t[6]=p+f*l,t[10]=o*h}else if("YXZ"===e.order){var g=h*u,v=h*c,y=l*u,x=l*c;t[0]=g+x*s,t[4]=y*s-v,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=v*s-y,t[6]=x+g*s,t[10]=o*h}else if("ZXY"===e.order){var g=h*u,v=h*c,y=l*u,x=l*c;t[0]=g-x*s,t[4]=-o*c,t[8]=y+v*s,t[1]=v+y*s,t[5]=o*u,t[9]=x-g*s,t[2]=-o*l,t[6]=s,t[10]=o*h}else if("ZYX"===e.order){var d=o*u,f=o*c,p=s*u,m=s*c;t[0]=h*u,t[4]=p*l-f,t[8]=d*l+m,t[1]=h*c,t[5]=m*l+d,t[9]=f*l-p,t[2]=-l,t[6]=s*h,t[10]=o*h}else if("YZX"===e.order){var b=o*h,_=o*l,w=s*h,M=s*l;t[0]=h*u,t[4]=M-b*c,t[8]=w*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+w,t[10]=b-M*c}else if("XZY"===e.order){var b=o*h,_=o*l,w=s*h,M=s*l;t[0]=h*u,t[4]=-c,t[8]=l*u,t[1]=b*c+M,t[5]=o*u,t[9]=_*c-w,t[2]=w*c-_,t[6]=s*u,t[10]=M*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return r("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=e.w,o=r+r,s=i+i,h=n+n,l=r*o,u=r*s,c=r*h,d=i*s,f=i*h,p=n*h,m=a*o,g=a*s,v=a*h;return t[0]=1-(d+p),t[4]=u-v,t[8]=c+g,t[1]=u+v,t[5]=1-(l+p),t[9]=f-m,t[2]=c-g,t[6]=f+m,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new h,t=new h,r=new h;return function(i,n,a){var o=this.elements;return r.subVectors(i,n).normalize(),0===r.length()&&(r.z=1),e.crossVectors(a,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(a,r).normalize()),t.crossVectors(r,e),o[0]=e.x,o[4]=t.x,o[8]=r.x,o[1]=e.y,o[5]=t.y,o[9]=r.y,o[2]=e.z,o[6]=t.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(r("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[4],s=r[8],h=r[12],l=r[1],u=r[5],c=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],b=r[15],_=i[0],w=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],C=i[13],L=i[2],R=i[6],P=i[10],F=i[14],U=i[3],D=i[7],B=i[11],z=i[15];return n[0]=a*_+o*T+s*L+h*U,n[4]=a*w+o*E+s*R+h*D,n[8]=a*M+o*A+s*P+h*B,n[12]=a*S+o*C+s*F+h*z,n[1]=l*_+u*T+c*L+d*U,n[5]=l*w+u*E+c*R+d*D,n[9]=l*M+u*A+c*P+d*B,n[13]=l*S+u*C+c*F+d*z,n[2]=f*_+p*T+m*L+g*U,n[6]=f*w+p*E+m*R+g*D,n[10]=f*M+p*A+m*P+g*B,n[14]=f*S+p*C+m*F+g*z,n[3]=v*_+y*T+x*L+b*U,n[7]=v*w+y*E+x*R+b*D,n[11]=v*M+y*A+x*P+b*B,n[15]=v*S+y*C+x*F+b*z,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return r("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return r("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return r("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new h;return function(t,r,i){void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,a=r;i>n;n+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}(),rotateAxis:function(e){r("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return r("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],h=e[13],l=e[2],u=e[6],c=e[10],d=e[14],f=e[3],p=e[7],m=e[11],g=e[15];return f*(+n*s*u-i*h*u-n*o*c+r*h*c+i*o*d-r*s*d)+p*(+t*s*d-t*h*c+n*a*c-i*a*d+i*h*l-n*s*l)+m*(+t*h*u-t*o*d-n*a*u+r*a*d+n*o*l-r*h*l)+g*(-i*o*l-t*s*u+t*o*c+i*a*u-r*a*c+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new h;return function(){r("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,a=n[0],o=n[4],s=n[8],h=n[12],l=n[1],u=n[5],c=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15];i[0]=c*g*y-d*m*y+d*p*x-u*g*x-c*p*b+u*m*b,i[4]=h*m*y-s*g*y-h*p*x+o*g*x+s*p*b-o*m*b,i[8]=s*d*y-h*c*y+h*u*x-o*d*x-s*u*b+o*c*b,i[12]=h*c*p-s*d*p-h*u*m+o*d*m+s*u*g-o*c*g,i[1]=d*m*v-c*g*v-d*f*x+l*g*x+c*f*b-l*m*b,i[5]=s*g*v-h*m*v+h*f*x-a*g*x-s*f*b+a*m*b,i[9]=h*c*v-s*d*v-h*l*x+a*d*x+s*l*b-a*c*b,i[13]=s*d*f-h*c*f+h*l*m-a*d*m-s*l*g+a*c*g,i[2]=u*g*v-d*p*v+d*f*y-l*g*y-u*f*b+l*p*b,i[6]=h*p*v-o*g*v-h*f*y+a*g*y+o*f*b-a*p*b,i[10]=o*d*v-h*u*v+h*l*y-a*d*y-o*l*b+a*u*b,i[14]=h*u*f-o*d*f-h*l*p+a*d*p+o*l*g-a*u*g,i[3]=c*p*v-u*m*v-c*f*y+l*m*y+u*f*x-l*p*x,i[7]=o*m*v-s*p*v+s*f*y-a*m*y-o*f*x+a*p*x,i[11]=s*u*v-o*c*v-s*l*y+a*c*y+o*l*x-a*u*x,i[15]=o*c*f-s*u*f+s*l*p-a*c*p-o*l*m+a*u*m;var _=a*i[0]+l*i[4]+f*i[8]+v*i[12];if(0==_){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return r(w),this.identity(),this}return this.multiplyScalar(1/_),this},translate:function(){i("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){i("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){i("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){i("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){i("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,o=e.y,s=e.z,h=n*a,l=n*o;return this.set(h*a+r,h*o-i*s,h*s+i*o,0,h*o+i*s,l*o+r,l*s-i*a,0,h*s-i*o,l*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new h,t=new o;return function(r,i,n){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),h=e.set(a[8],a[9],a[10]).length(),l=this.determinant();0>l&&(o=-o),r.x=a[12],r.y=a[13],r.z=a[14],t.elements.set(this.elements);var u=1/o,c=1/s,d=1/h;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,i.setFromRotationMatrix(t),n.x=o,n.y=s,n.z=h,this}}(),makeFrustum:function(e,t,r,i,n,a){var o=this.elements,s=2*n/(t-e),h=2*n/(i-r),l=(t+e)/(t-e),u=(i+r)/(i-r),c=-(a+n)/(a-n),d=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,r,i,n){var a=i*Math.tan(e.Math.degToRad(.5*t)),o=-a,s=o*r,h=a*r;return this.makeFrustum(s,h,o,a,i,n)},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements,s=t-e,h=r-i,l=a-n,u=(t+e)/s,c=(r+i)/h,d=(a+n)/l;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2/h,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2/l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new o).fromArray(this.elements)}},s.prototype={constructor:s,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if((e&&e.isEuler)===!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),n=Math.cos(e._z/2),a=Math.sin(e._x/2),o=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=a*i*n+r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n-a*o*s):"YXZ"===e.order?(this._x=a*i*n+r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n+a*o*s):"ZXY"===e.order?(this._x=a*i*n-r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n-a*o*s):"ZYX"===e.order?(this._x=a*i*n-r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n+a*o*s):"YZX"===e.order?(this._x=a*i*n+r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n-a*o*s):"XZY"===e.order&&(this._x=a*i*n-r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n+a*o*s),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],a=r[8],o=r[1],s=r[5],h=r[9],l=r[2],u=r[6],c=r[10],d=i+s+c;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-h)*t,this._y=(a-l)*t,this._z=(o-n)*t):i>s&&i>c?(t=2*Math.sqrt(1+i-s-c),this._w=(u-h)/t,this._x=.25*t,this._y=(n+o)/t,this._z=(a+l)/t):s>c?(t=2*Math.sqrt(1+s-i-c),this._w=(a-l)/t,this._x=(n+o)/t,this._y=.25*t,this._z=(h+u)/t):(t=2*Math.sqrt(1+c-i-s),this._w=(o-n)/t,this._x=(a+l)/t,this._y=(h+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(i,n){return void 0===e&&(e=new h),t=i.dot(n)+1,r>t?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(r("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w,o=t._x,s=t._y,h=t._z,l=t._w;return this._x=r*l+a*o+i*h-n*s,this._y=i*l+a*s+n*o-r*h,this._z=n*l+a*h+r*s-i*o,this._w=a*l-r*o-i*s-n*h,this.onChangeCallback(),this},multiplyVector3:function(e){return r("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*e._w+r*e._x+i*e._y+n*e._z;if(0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(o),h=Math.sqrt(1-o*o);if(Math.abs(h)<.001)return this._w=.5*(a+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var l=Math.sin((1-t)*s)/h,u=Math.sin(t*s)/h;return this._w=a*l+this._w*u,this._x=r*l+this._x*u,this._y=i*l+this._y*u,this._z=n*l+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new s(this._x,this._y,this._z,this._w)}},s.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},h.prototype={constructor:h,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(r("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(r("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(r("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return(t&&t.isEuler)===!1&&i("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new s),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new s),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,o=e.z,s=e.w,h=s*t+a*i-o*r,l=s*r+o*t-n*i,u=s*i+n*r-a*t,c=-n*t-a*r-o*i;return this.x=h*s+c*-n+l*-o-u*-a,this.y=l*s+c*-a+u*-n-h*-o,this.z=u*s+c*-o+h*-a-l*-n,this},project:function(){var e;return function(t){return void 0===e&&(e=new o),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new o),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),
this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new h,t=new h),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return r("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,a=this.z;return this.x=n*e.z-a*e.y,this.y=a*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new h),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new h),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new h),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(t){var r=this.dot(t)/(this.length()*t.length());return Math.acos(e.Math.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(){i("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){i("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return r("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return r("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return r("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new h(this.x,this.y,this.z)}},l.prototype={constructor:l,apply:function(e){e.addEventListener=l.prototype.addEventListener,e.hasEventListener=l.prototype.hasEventListener,e.removeEventListener=l.prototype.removeEventListener,e.dispatchEvent=l.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var i=[],n=r.length,a=0;n>a;a++)i[a]=r[a];for(var a=0;n>a;a++)i[a].call(this,e)}}}},u.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],u.DefaultOrder="XYZ",u.prototype={constructor:u,_x:0,_y:0,_z:0,_order:u.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,n){var a=e.Math.clamp,o=t.elements,s=o[0],h=o[4],l=o[8],u=o[1],c=o[5],d=o[9],f=o[2],p=o[6],m=o[10];return i=i||this._order,"XYZ"===i?(this._y=Math.asin(a(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-h,s)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===i?(this._x=Math.asin(-a(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(l,m),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-f,s),this._z=0)):"ZXY"===i?(this._x=Math.asin(a(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-h,c)):(this._y=0,this._z=Math.atan2(u,s))):"ZYX"===i?(this._y=Math.asin(-a(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(p,m),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-h,c))):"YZX"===i?(this._z=Math.asin(a(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(l,m))):"XZY"===i?(this._z=Math.asin(-a(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,c),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-d,m),this._y=0)):r("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,i){return void 0===e&&(e=new o),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new s;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new h(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new u(this._x,this._y,this._z,this._order)}},c.DefaultUp=new h(0,1,0),c.prototype={constructor:c,get eulerOrder(){return r("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){r("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){r("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){r("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new s;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new h(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new h(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new h(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new h;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return r("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new h(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new h(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new h(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new o;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new o;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(i("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):i("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(e){return r("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;i>r;r++){var n=this.children[r],a=n.getObjectByProperty(e,t);if(void 0!==a)return a}return void 0},getWorldPosition:function(e){var t=e||new h;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new h,t=new h;return function(r){var i=r||new s;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new s;return function(t){var r=t||new u;return this.getWorldQuaternion(e),r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new h,t=new s;return function(r){var i=r||new h;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new s;return function(t){var r=t||new h;return this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},r=function(r){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[r.uuid]){var i=r.toJSON();delete i.metadata,t[r.uuid]=i,e.geometries.push(i)}return r.uuid},i={},n=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===i[t.uuid]){var r=t.toJSON();delete r.metadata,i[t.uuid]=r,e.materials.push(r)}return t.uuid},a=function(e){var t={};if(t.uuid=e.uuid,t.type=e.type,""!==e.name&&(t.name=e.name),"{}"!==JSON.stringify(e.userData)&&(t.userData=e.userData),e.visible!==!0&&(t.visible=e.visible),e&&e.isPerspectiveCamera?(t.fov=e.fov,t.aspect=e.aspect,t.near=e.near,t.far=e.far):e&&e.isOrthographicCamera?(t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom,t.near=e.near,t.far=e.far):e&&e.isAmbientLight?t.color=e.color.getHex():e&&e.isDirectionalLight?(t.color=e.color.getHex(),t.intensity=e.intensity):e&&e.isPointLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance,t.decay=e.decay):e&&e.isSpotLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance,t.angle=e.angle,t.exponent=e.exponent,t.decay=e.decay):e&&e.isHemisphereLight?(t.color=e.color.getHex(),t.groundColor=e.groundColor.getHex()):e&&e.isMesh||e&&e.isLine||e&&e.isPointCloud?(t.geometry=r(e.geometry),t.material=n(e.material),e&&e.isLine&&(t.mode=e.mode)):e&&e.isSprite&&(t.material=n(e.material)),t.matrix=e.matrix.toArray(),e.children.length>0){t.children=[];for(var i=0;i<e.children.length;i++)t.children.push(a(e.children[i]))}return t};return e.object=a(this),e},clone:function(e,t){if(void 0===e&&(e=new c),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var r=0;r<this.children.length;r++){var i=this.children[r];e.add(i.clone())}return e}},l.prototype.apply(c.prototype);var rr=0;f.prototype=Object.create(c.prototype),f.prototype.constructor=f,f.prototype.getWorldDirection=function(){var e=new s;return function(t){var r=t||new h;return this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),f.prototype.lookAt=function(){var e=new o;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),f.prototype.clone=function(e){return void 0===e&&(e=new f),c.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},p.prototype={constructor:p,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(r("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(r("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new p,t=new p),e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new p(this.x,this.y)}},m.prototype={constructor:m,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new m(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},l.prototype.apply(m.prototype),g.prototype=Object.create(m.prototype),g.prototype.constructor=g,v.prototype=Object.create(f.prototype),v.prototype.constructor=v,v.prototype.setLens=function(t,r){void 0===r&&(r=24),this.fov=2*e.Math.radToDeg(Math.atan(r/(2*t))),this.updateProjectionMatrix()},v.prototype.setViewOffset=function(e,t,r,i,n,a){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=a,this.updateProjectionMatrix()},v.prototype.updateProjectionMatrix=function(){var t=e.Math.radToDeg(2*Math.atan(Math.tan(.5*e.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var r=this.fullWidth/this.fullHeight,i=Math.tan(e.Math.degToRad(.5*t))*this.near,n=-i,a=r*n,o=r*i,s=Math.abs(o-a),h=Math.abs(i-n);this.projectionMatrix.makeFrustum(a+this.x*s/this.fullWidth,a+(this.x+this.width)*s/this.fullWidth,i-(this.y+this.height)*h/this.fullHeight,i-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},v.prototype.clone=function(){var e=new v;return f.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},y.prototype=Object.create(c.prototype),y.prototype.constructor=y,x.prototype=Object.create(f.prototype),x.prototype.constructor=x,x.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)},x.prototype.clone=function(){var e=new x;return f.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},b.prototype={constructor:b,get length(){return this.array.length},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;n>i;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},clone:function(){return new b(new this.array.constructor(this.array),this.itemSize)}},R.prototype={constructor:R,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e},n=.5>=r?r*(1+t):r+t-r*t,a=2*r-n;this.r=i(a,n,e+1/3),this.g=i(a,n,e),this.b=i(a,n,e-1/3)}return this},setStyle:function(t){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var r=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){var r=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(t)){var r=/^\#([0-9a-f]{6})$/i.exec(t);return this.setHex(parseInt(r[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var r=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return this.setHex(parseInt(r[1]+r[1]+r[2]+r[2]+r[3]+r[3],16)),this}return/^(\w+)$/i.test(t)?(this.setHex(e.ColorKeywords[t]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,i=e||{h:0,s:0,l:0},n=this.r,a=this.g,o=this.b,s=Math.max(n,a,o),h=Math.min(n,a,o),l=(h+s)/2;if(h===s)t=0,r=0;else{var u=s-h;switch(r=.5>=l?u/(s+h):u/(2-s-h),s){case n:t=(a-o)/u+(o>a?6:0);break;case a:t=(o-n)/u+2;break;case o:t=(n-a)/u+4}t/=6}return i.h=t,i.s=r,i.l=l,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new R).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},P.prototype={constructor:P,clone:function(){var e=new P(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(var t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(var t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},F.prototype={constructor:F,set:function(e,t,r,i,n,a,o,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=i,l[4]=n,l[7]=a,l[2]=o,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return r("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return r("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new h;return function(t,r,i){void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,a=r;i>n;n+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix3(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],h=e[7],l=e[8];return t*a*l-t*o*h-r*n*l+r*o*s+i*n*h-i*a*s},getInverse:function(e,t){var i=e.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===a){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return r(o),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new F).fromArray(this.elements)}},U.prototype={constructor:U,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new h;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new h;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var i=t.geometry;if(void 0!==i)if(i&&i.isGeometry)for(var n=i.vertices,a=0,o=n.length;o>a;a++)e.copy(n[a]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e);else if(i&&i.isBufferGeometry&&void 0!==i.attributes.position)for(var s=i.attributes.position.array,a=0,o=s.length;o>a;a+=3)e.set(s[a],s[a+1],s[a+2]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e);

}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new h;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new h;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var r=t||new h;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var r=t||new h;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new h;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new h;return function(t){var r=t||new D;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new h,new h,new h,new h,new h,new h,new h,new h];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new U).copy(this)}},D.prototype={constructor:D,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new U;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).center(i);for(var n=0,a=0,o=t.length;o>a;a++)n=Math.max(n,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(n),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new h;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new U;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new D).copy(this)}},B.prototype={constructor:B,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(r("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(r("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,a=.01,o=.1,s=e.elements,h=s[0],l=s[4],u=s[8],c=s[1],d=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(l-c)<a&&Math.abs(u-p)<a&&Math.abs(f-m)<a){if(Math.abs(l+c)<o&&Math.abs(u+p)<o&&Math.abs(f+m)<o&&Math.abs(h+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var v=(h+1)/2,y=(d+1)/2,x=(g+1)/2,b=(l+c)/4,_=(u+p)/4,w=(f+m)/4;return v>y&&v>x?a>v?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(v),i=b/r,n=_/r):y>x?a>y?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(y),r=b/i,n=w/i):a>x?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(x),r=_/n,i=w/n),this.set(r,i,n,t),this}var M=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(c-l)*(c-l));return Math.abs(M)<.001&&(M=1),this.x=(m-f)/M,this.y=(u-p)/M,this.z=(c-l)/M,this.w=Math.acos((h+d+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new B,t=new B),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new B(this.x,this.y,this.z,this.w)}},z.prototype={constructor:z,applyMatrix:function(e){for(var t=(new F).getNormalMatrix(e),r=0,i=this.vertices.length;i>r;r++){var n=this.vertices[r];n.applyMatrix4(e)}for(var r=0,i=this.faces.length;i>r;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;s>o;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,r=e.attributes,i=r.position.array,n=void 0!==r.index?r.index.array:void 0,a=void 0!==r.normal?r.normal.array:void 0,o=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=[],u=[],c=0,d=0;c<i.length;c+=3,d+=2)t.vertices.push(new h(i[c],i[c+1],i[c+2])),void 0!==a&&l.push(new h(a[c],a[c+1],a[c+2])),void 0!==o&&t.colors.push(new R(o[c],o[c+1],o[c+2])),void 0!==s&&u.push(new p(s[d],s[d+1]));var f=function(e,r,i){var n=void 0!==a?[l[e].clone(),l[r].clone(),l[i].clone()]:[],h=void 0!==o?[t.colors[e].clone(),t.colors[r].clone(),t.colors[i].clone()]:[];t.faces.push(new P(e,r,i,n,h)),void 0!==s&&t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[i].clone()])};if(void 0!==n){var m=e.drawcalls;if(m.length>0)for(var c=0;c<m.length;c++)for(var g=m[c],v=g.start,y=g.count,x=g.index,d=v,b=v+y;b>d;d+=3)f(x+n[d],x+n[d+1],x+n[d+2]);else for(var c=0;c<n.length;c+=3)f(n[c],n[c+1],n[c+2])}else for(var c=0;c<i.length/3;c+=3)f(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new o).setPosition(e)),e},computeFaceNormals:function(){for(var e=new h,t=new h,r=0,i=this.faces.length;i>r;r++){var n=this.faces[r],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,a,o;for(o=new Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)o[t]=new h;if(e){var s,l,u,c=new h,d=new h;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),d.subVectors(s,l),c.cross(d),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;r>t;t++)o[t].normalize();for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],a.vertexNormals[0]=o[a.a].clone(),a.vertexNormals[1]=o[a.b].clone(),a.vertexNormals[2]=o[a.c].clone()},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;i>r;r++)for(n=this.faces[r],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;t>e;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var a=new z;for(a.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o,s,l=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)o=new h,s={a:new h,b:new h,c:new h},l.push(o),u.push(s)}var c=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var o,s;for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],o=c.faceNormals[r],s=c.vertexNormals[r],o.copy(n.normal),s.a.copy(n.vertexNormals[0]),s.b.copy(n.vertexNormals[1]),s.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){function e(e,t,r,i,n,a,o){u=e.vertices[t],c=e.vertices[r],d=e.vertices[i],f=l[n],p=l[a],m=l[o],g=c.x-u.x,v=d.x-u.x,y=c.y-u.y,x=d.y-u.y,b=c.z-u.z,_=d.z-u.z,w=p.x-f.x,M=m.x-f.x,S=p.y-f.y,T=m.y-f.y,E=1/(w*T-M*S),F.set((T*g-S*v)*E,(T*y-S*x)*E,(T*b-S*_)*E),U.set((w*v-M*g)*E,(w*x-M*y)*E,(w*_-M*b)*E),R[t].add(F),R[r].add(F),R[i].add(F),P[t].add(U),P[r].add(U),P[i].add(U)}var t,r,i,n,a,o,s,l,u,c,d,f,p,m,g,v,y,x,b,_,w,M,S,T,E,A,C,L,R=[],P=[],F=new h,U=new h,D=new h,z=new h,k=new h;for(i=0,n=this.vertices.length;n>i;i++)R[i]=new h,P[i]=new h;for(t=0,r=this.faces.length;r>t;t++)s=this.faces[t],l=this.faceVertexUvs[0][t],e(this,s.a,s.b,s.c,0,1,2);var N=["a","b","c","d"];for(t=0,r=this.faces.length;r>t;t++)for(s=this.faces[t],a=0;a<Math.min(s.vertexNormals.length,3);a++)k.copy(s.vertexNormals[a]),o=s[N[a]],A=R[o],D.copy(A),D.sub(k.multiplyScalar(k.dot(A))).normalize(),z.crossVectors(s.vertexNormals[a],A),C=z.dot(P[o]),L=0>C?-1:1,s.vertexTangents[a]=new B(D.x,D.y,D.z,L);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;i>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new U),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new D),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if((e&&e.isGeometry)===!1)return void i("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var n,a=this.vertices.length,o=this.vertices,s=e.vertices,h=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(n=(new F).getNormalMatrix(t));for(var d=0,f=s.length;f>d;d++){var p=s[d],m=p.clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(d=0,f=l.length;f>d;d++){var g,v,y,x=l[d],b=x.vertexNormals,_=x.vertexColors;g=new P(x.a+a,x.b+a,x.c+a),g.normal.copy(x.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var w=0,M=b.length;M>w;w++)v=b[w].clone(),void 0!==n&&v.applyMatrix3(n).normalize(),g.vertexNormals.push(v);g.color.copy(x.color);for(var w=0,M=_.length;M>w;w++)y=_[w],g.vertexColors.push(y.clone());g.materialIndex=x.materialIndex+r,h.push(g)}for(d=0,f=c.length;f>d;d++){var S=c[d],T=[];if(void 0!==S){for(var w=0,M=S.length;M>w;w++)T.push(S[w].clone());u.push(T)}}},mergeMesh:function(e){return(e&&e.isMesh)===!1?void i("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,r,i,n,a,o,s,h={},l=[],u=[],c=4,d=Math.pow(10,c);for(r=0,i=this.vertices.length;i>r;r++)e=this.vertices[r],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===h[t]?(h[t]=r,l.push(this.vertices[r]),u[r]=l.length-1):u[r]=u[h[t]];var f=[];for(r=0,i=this.faces.length;i>r;r++){n=this.faces[r],n.a=u[n.a],n.b=u[n.b],n.c=u[n.c],a=[n.a,n.b,n.c];for(var p=-1,m=0;3>m;m++)if(a[m]==a[(m+1)%3]){p=m,f.push(r);break}}for(r=f.length-1;r>=0;r--){var g=f[r];for(this.faces.splice(g,1),o=0,s=this.faceVertexUvs.length;s>o;o++)this.faceVertexUvs[o].splice(g,1)}var v=this.vertices.length-l.length;return this.vertices=l,v},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=c.length/3,c.push(e.x,e.y,e.z),d[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=f.length,f.push(e.getHex()),p[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var n={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(n.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(n[o]=a[o]);return n}for(var s=[],h=0;h<this.vertices.length;h++){var l=this.vertices[h];s.push(l.x,l.y,l.z)}for(var u=[],c=[],d={},f=[],p={},m=[],g={},h=0;h<this.faces.length;h++){var v=this.faces[h],y=!1,x=!1,b=void 0!==this.faceVertexUvs[0][h],_=v.normal.length()>0,w=v.vertexNormals.length>0,M=1!==v.color.r||1!==v.color.g||1!==v.color.b,S=v.vertexColors.length>0,T=0;if(T=e(T,0,0),T=e(T,1,y),T=e(T,2,x),T=e(T,3,b),T=e(T,4,_),T=e(T,5,w),T=e(T,6,M),T=e(T,7,S),u.push(T),u.push(v.a,v.b,v.c),b){var E=this.faceVertexUvs[0][h];u.push(i(E[0]),i(E[1]),i(E[2]))}if(_&&u.push(t(v.normal)),w){var A=v.vertexNormals;u.push(t(A[0]),t(A[1]),t(A[2]))}if(M&&u.push(r(v.color)),S){var C=v.vertexColors;u.push(r(C[0]),r(C[1]),r(C[2]))}}return n.data={},n.data.vertices=s,n.data.normals=c,f.length>0&&(n.data.colors=f),m.length>0&&(n.data.uvs=[m]),n.data.faces=u,n},clone:function(){for(var e=new z,t=this.vertices,r=0,i=t.length;i>r;r++)e.vertices.push(t[r].clone());for(var n=this.faces,r=0,i=n.length;i>r;r++)e.faces.push(n[r].clone());for(var r=0,i=this.faceVertexUvs.length;i>r;r++){var a=this.faceVertexUvs[r];void 0===e.faceVertexUvs[r]&&(e.faceVertexUvs[r]=[]);for(var o=0,s=a.length;s>o;o++){for(var h=a[o],l=[],u=0,c=h.length;c>u;u++){var d=h[u];l.push(d.clone())}e.faceVertexUvs[r].push(l)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},l.prototype.apply(z.prototype);var ir=0;N.prototype={constructor:N,addAttribute:function(e,t){return(t&&t.isBufferAttribute)===!1?(r("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]})):(this.attributes[e]=t,void(this.attributesKeys=Object.keys(this.attributes)))},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:void 0!==r?r:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var i=(new F).getNormalMatrix(e);i.applyToVector3Array(r.array),r.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new o).setPosition(e)),e},fromGeometry:function(t,r){r=r||{vertexColors:e.NoColors};var i=t.vertices,n=t.faces,a=t.faceVertexUvs,o=r.vertexColors,s=a[0].length>0,h=3==n[0].vertexNormals.length,l=new Float32Array(3*n.length*3);this.addAttribute("position",new b(l,3));var u=new Float32Array(3*n.length*3);if(this.addAttribute("normal",new b(u,3)),o!==e.NoColors){var c=new Float32Array(3*n.length*3);this.addAttribute("color",new b(c,3))}if(s===!0){var d=new Float32Array(3*n.length*2);this.addAttribute("uv",new b(d,2))}for(var f=0,p=0,m=0;f<n.length;f++,p+=6,m+=9){var g=n[f],v=i[g.a],y=i[g.b],x=i[g.c];if(l[m]=v.x,l[m+1]=v.y,l[m+2]=v.z,l[m+3]=y.x,l[m+4]=y.y,l[m+5]=y.z,l[m+6]=x.x,l[m+7]=x.y,l[m+8]=x.z,h===!0){var _=g.vertexNormals[0],w=g.vertexNormals[1],M=g.vertexNormals[2];u[m]=_.x,u[m+1]=_.y,u[m+2]=_.z,u[m+3]=w.x,u[m+4]=w.y,u[m+5]=w.z,u[m+6]=M.x,u[m+7]=M.y,u[m+8]=M.z}else{var S=g.normal;u[m]=S.x,u[m+1]=S.y,u[m+2]=S.z,u[m+3]=S.x,u[m+4]=S.y,u[m+5]=S.z,u[m+6]=S.x,u[m+7]=S.y,u[m+8]=S.z}if(o===e.FaceColors){var T=g.color;c[m]=T.r,c[m+1]=T.g,c[m+2]=T.b,c[m+3]=T.r,c[m+4]=T.g,c[m+5]=T.b,c[m+6]=T.r,c[m+7]=T.g,c[m+8]=T.b}else if(o===e.VertexColors){var E=g.vertexColors[0],A=g.vertexColors[1],C=g.vertexColors[2];c[m]=E.r,c[m+1]=E.g,c[m+2]=E.b,c[m+3]=A.r,c[m+4]=A.g,c[m+5]=A.b,c[m+6]=C.r,c[m+7]=C.g,c[m+8]=C.b}if(s===!0){var L=a[0][f][0],R=a[0][f][1],P=a[0][f][2];d[p]=L.x,d[p+1]=L.y,d[p+2]=R.x,d[p+3]=R.y,d[p+4]=P.x,d[p+5]=P.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new h;return function(){null===this.boundingBox&&(this.boundingBox=new U);var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,a=t.length;a>n;n+=3)e.set(t[n],t[n+1],t[n+2]),r.expandByPoint(e)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&i('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new U,t=new h;return function(){null===this.boundingSphere&&(this.boundingSphere=new D);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var n=this.boundingSphere.center,a=0,o=r.length;o>a;a+=3)t.set(r[a],r[a+1],r[a+2]),e.expandByPoint(t);e.center(n);for(var s=0,a=0,o=r.length;o>a;a+=3)t.set(r[a],r[a+1],r[a+2]),s=Math.max(s,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&i('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new b(new Float32Array(t.length),3));else for(var r=e.normal.array,i=0,n=r.length;n>i;i++)r[i]=0;var a,o,s,r=e.normal.array,l=new h,u=new h,c=new h,d=new h,f=new h;if(e.index)for(var p=e.index.array,m=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}],g=0,v=m.length;v>g;++g)for(var y=m[g].start,x=m[g].count,_=m[g].index,i=y,n=y+x;n>i;i+=3)a=3*(_+p[i]),o=3*(_+p[i+1]),s=3*(_+p[i+2]),l.fromArray(t,a),u.fromArray(t,o),c.fromArray(t,s),d.subVectors(c,u),f.subVectors(l,u),d.cross(f),r[a]+=d.x,r[a+1]+=d.y,r[a+2]+=d.z,r[o]+=d.x,r[o+1]+=d.y,r[o+2]+=d.z,r[s]+=d.x,r[s+1]+=d.y,r[s+2]+=d.z;else for(var i=0,n=t.length;n>i;i+=9)l.fromArray(t,i),u.fromArray(t,i+3),c.fromArray(t,i+6),d.subVectors(c,u),f.subVectors(l,u),d.cross(f),r[i]=d.x,r[i+1]=d.y,r[i+2]=d.z,r[i+3]=d.x,r[i+4]=d.y,r[i+5]=d.z,r[i+6]=d.x,r[i+7]=d.y,r[i+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){function e(e,t,r){U.fromArray(n,3*e),D.fromArray(n,3*t),B.fromArray(n,3*r),z.fromArray(o,2*e),k.fromArray(o,2*t),N.fromArray(o,2*r),f=D.x-U.x,m=B.x-U.x,g=D.y-U.y,v=B.y-U.y,y=D.z-U.z,x=B.z-U.z,_=k.x-z.x,w=N.x-z.x,M=k.y-z.y,S=N.y-z.y,T=1/(_*S-w*M),O.set((S*f-M*m)*T,(S*g-M*v)*T,(S*y-M*x)*T),I.set((_*m-w*f)*T,(_*v-w*g)*T,(_*x-w*y)*T),u[e].add(O),u[t].add(O),u[r].add(O),c[e].add(I),c[t].add(I),c[r].add(I)}function t(e){Z.fromArray(a,3*e),Q.copy(Z),X=u[e],Y.copy(X),Y.sub(Z.multiplyScalar(Z.dot(X))).normalize(),K.crossVectors(Q,X),q=K.dot(c[e]),j=0>q?-1:1,l[4*e]=Y.x,l[4*e+1]=Y.y,l[4*e+2]=Y.z,l[4*e+3]=j}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void r("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var i=this.attributes.index.array,n=this.attributes.position.array,a=this.attributes.normal.array,o=this.attributes.uv.array,s=n.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new b(new Float32Array(4*s),4));for(var l=this.attributes.tangent.array,u=[],c=[],d=0;s>d;d++)u[d]=new h,c[d]=new h;var f,m,g,v,y,x,_,w,M,S,T,E,A,C,L,R,P,F,U=new h,D=new h,B=new h,z=new p,k=new p,N=new p,O=new h,I=new h;0===this.drawcalls.length&&this.addDrawCall(0,i.length,0);var H=this.drawcalls;for(C=0,L=H.length;L>C;++C){var V=H[C].start,W=H[C].count,G=H[C].index;for(E=V,A=V+W;A>E;E+=3)R=G+i[E],P=G+i[E+1],F=G+i[E+2],e(R,P,F)}var j,X,q,Y=new h,K=new h,Z=new h,Q=new h;for(C=0,L=H.length;L>C;++C){var V=H[C].start,W=H[C].count,G=H[C].index;for(E=V,A=V+W;A>E;E+=3)R=G+i[E],P=G+i[E+1],F=G+i[E+2],t(R),t(P),t(F)}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,r=this.attributes.position.array,i=t.length/3,n=new Uint16Array(t.length),a=0,o=0,s=[{start:0,count:0,index:0}],h=s[0],l=0,u=0,c=new Int32Array(6),d=new Int32Array(r.length),f=new Int32Array(r.length),p=0;p<r.length;p++)d[p]=-1,f[p]=-1;for(var m=0;i>m;m++){u=0;for(var g=0;3>g;g++){var v=t[3*m+g];-1==d[v]?(c[2*g]=v,c[2*g+1]=-1,u++):d[v]<h.index?(c[2*g]=v,c[2*g+1]=-1,l++):(c[2*g]=v,c[2*g+1]=d[v])}var y=o+u;if(y>h.index+e){var x={start:a,count:0,index:o};s.push(x),h=x;for(var b=0;6>b;b+=2){var _=c[b+1];_>-1&&_<h.index&&(c[b+1]=-1)}}for(var b=0;6>b;b+=2){var v=c[b],_=c[b+1];-1===_&&(_=o++),d[v]=_,f[_]=v,n[a++]=_-h.index,h.count++}}return this.reorderBuffers(n,f,o),this.offsets=s,this.drawcalls=s,s},merge:function(e,t){if((e&&e.isBufferGeometry)===!1)return void i("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var a=r[n],o=a.array,s=e.attributes[n],h=s.array,l=s.itemSize,u=0,c=l*t;u<h.length;u++,c++)o[c]=h[u];return this},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,a=0,o=n.length;o>a;a+=3)e=n[a],t=n[a+1],r=n[a+2],i=1/Math.sqrt(e*e+t*t+r*r),n[a]*=i,n[a+1]*=i,n[a+2]*=i},reorderBuffers:function(e,t,r){var i={};for(var n in this.attributes)if("index"!=n){var a=this.attributes[n].array;i[n]=new a.constructor(this.attributes[n].itemSize*r)}for(var o=0;r>o;o++){var s=t[o];for(var n in this.attributes)if("index"!=n)for(var h=this.attributes[n].array,l=this.attributes[n].itemSize,u=i[n],c=0;l>c;c++)u[o*l+c]=h[s*l+c]}this.attributes.index.array=e;for(var n in this.attributes)"index"!=n&&(this.attributes[n].array=i[n],this.attributes[n].numItems=this.attributes[n].itemSize*r)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,r=this.offsets,i=this.boundingSphere;for(var n in t){var a=t[n],o=Array.prototype.slice.call(a.array);e.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:o}}return r.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(r))),null!==i&&(e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),e},clone:function(){var e=new N;for(var t in this.attributes){var r=this.attributes[t];e.addAttribute(t,r.clone())}for(var i=0,n=this.offsets.length;n>i;i++){var a=this.offsets[i];e.offsets.push({start:a.start,index:a.index,count:a.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},l.prototype.apply(N.prototype),O.prototype={constructor:O,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},I.prototype=Object.create(b.prototype),I.prototype.constructor=I,I.prototype.clone=function(){return new I(new this.array.constructor(this.array),this.itemSize)},V.prototype.getPoint=function(){return r("THREE.Curve: Warning, getPoint() not implemented!"),null},V.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},V.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},V.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},V.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},V.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),a+=t.distanceTo(n),i.push(a),n=t;return this.cacheArcLengths=i,i},V.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},V.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),n=0,a=i.length;r=t?t:e*i[a-1];for(var o,s=0,h=a-1;h>=s;)if(n=Math.floor(s+(h-s)/2),o=i[n]-r,0>o)s=n+1;else{if(!(o>0)){h=n;break}h=n-1}if(n=h,i[n]==r){var l=n/(a-1);return l}var u=i[n],c=i[n+1],d=c-u,f=(r-u)/d,l=(n+f)/(a-1);return l},V.prototype.getTangent=function(e){var t=1e-4,r=e-t,i=e+t;0>r&&(r=0),i>1&&(i=1);var n=this.getPoint(r),a=this.getPoint(i),o=a.clone().sub(n);return o.normalize()},V.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},V.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e){var t=6*e*e-6*e,r=3*e*e-4*e+1,i=-6*e*e+6*e,n=3*e*e-2*e;return t+r+i+n},interpolate:function(e,t,r,i,n){var a=.5*(r-e),o=.5*(i-t),s=n*n,h=n*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*n+t}},V.create=function(e,t){return e.prototype=Object.create(V.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},W.prototype=Object.create(V.prototype),W.prototype.constructor=W,W.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},W.prototype.getPointAt=function(e){return this.getPoint(e)},W.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},G.prototype=Object.create(V.prototype),G.prototype.constructor=G,G.prototype.add=function(e){this.curves.push(e)},G.prototype.checkConnection=function(){},G.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new W(t,e))},G.prototype.getPoint=function(e){for(var t,r,i=e*this.getLength(),n=this.getCurveLengths(),a=0;a<n.length;){if(n[a]>=i){t=n[a]-i,r=this.curves[a];var o=1-t/r.getLength();return r.getPointAt(o)}a++}return null},G.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},G.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;i>e;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},G.prototype.getBoundingBox=function(){var e,t,r,i,n,a,o=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var s,l,u,c,d=o[0]&&o[0].isVector3;for(c=d?new h:new p,l=0,u=o.length;u>l;l++)s=o[l],
s.x>e?e=s.x:s.x<i&&(i=s.x),s.y>t?t=s.y:s.y<n&&(n=s.y),d&&(s.z>r?r=s.z:s.z<a&&(a=s.z)),c.add(s);var f={minX:i,minY:n,maxX:e,maxY:t};return d&&(f.maxZ=r,f.minZ=a),f},G.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},G.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},G.prototype.createGeometry=function(e){for(var t=new z,r=0;r<e.length;r++)t.vertices.push(new h(e[r].x,e[r].y,e[r].z||0));return t},G.prototype.addWrapPath=function(e){this.bends.push(e)},G.prototype.getTransformedPoints=function(e,t){var r,i,n=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)n=this.getWrapPoints(n,t[r]);return n},G.prototype.getTransformedSpacedPoints=function(e,t){var r,i,n=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)n=this.getWrapPoints(n,t[r]);return n},G.prototype.getWrapPoints=function(e,t){var r,i,n,a,o,s,h=this.getBoundingBox();for(r=0,i=e.length;i>r;r++){n=e[r],a=n.x,o=n.y,s=a/h.maxX,s=t.getUtoTmapping(s,a);var l=t.getPoint(s),u=t.getTangent(s);u.set(-u.y,u.x).multiplyScalar(o),n.x=l.x+u.x,n.y=l.y+u.y}return e},j.prototype=Object.create(V.prototype),j.prototype.constructor=j,j.prototype.getPoint=function(e){var t=new p;return t.x=$.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=$.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},j.prototype.getTangent=function(e){var t=new p;return t.x=V.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=V.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},X.prototype=Object.create(V.prototype),X.prototype.constructor=X,X.prototype.getPoint=function(e){var t,r;return t=$.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=$.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new p(t,r)},X.prototype.getTangent=function(e){var t,r;t=V.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=V.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new p(t,r);return i.normalize(),i},q.prototype=Object.create(V.prototype),q.prototype.constructor=q,q.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,a=t[0==i?i:i-1],o=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],l=new p;return l.x=V.Utils.interpolate(a.x,o.x,s.x,h.x,n),l.y=V.Utils.interpolate(a.y,o.y,s.y,h.y,n),l},Y.prototype=Object.create(V.prototype),Y.prototype.constructor=Y,Y.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var r;r=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var i=new p;return i.x=this.aX+this.xRadius*Math.cos(r),i.y=this.aY+this.yRadius*Math.sin(r),i},K.prototype=Object.create(G.prototype),K.prototype.constructor=K,e.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},K.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},K.prototype.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:e.PathActions.MOVE_TO,args:t})},K.prototype.lineTo=function(t,r){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,a=n[n.length-2],o=n[n.length-1],s=new W(new p(a,o),new p(t,r));this.curves.push(s),this.actions.push({action:e.PathActions.LINE_TO,args:i})},K.prototype.quadraticCurveTo=function(t,r,i,n){var a=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,s=o[o.length-2],h=o[o.length-1],l=new j(new p(s,h),new p(t,r),new p(i,n));this.curves.push(l),this.actions.push({action:e.PathActions.QUADRATIC_CURVE_TO,args:a})},K.prototype.bezierCurveTo=function(t,r,i,n,a,o){var s=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,l=h[h.length-2],u=h[h.length-1],c=new X(new p(l,u),new p(t,r),new p(i,n),new p(a,o));this.curves.push(c),this.actions.push({action:e.PathActions.BEZIER_CURVE_TO,args:s})},K.prototype.splineThru=function(t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],a=i[i.length-1],o=[new p(n,a)];Array.prototype.push.apply(o,t);var s=new q(o);this.curves.push(s),this.actions.push({action:e.PathActions.CSPLINE_THRU,args:r})},K.prototype.arc=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args,s=o[o.length-2],h=o[o.length-1];this.absarc(e+s,t+h,r,i,n,a)},K.prototype.absarc=function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)},K.prototype.ellipse=function(e,t,r,i,n,a,o){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1];this.absellipse(e+h,t+l,r,i,n,a,o)},K.prototype.absellipse=function(t,r,i,n,a,o,s){var h=Array.prototype.slice.call(arguments),l=new Y(t,r,i,n,a,o,s);this.curves.push(l);var u=l.getPoint(1);h.push(u.x),h.push(u.y),this.actions.push({action:e.PathActions.ELLIPSE,args:h})},K.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],r=0;e>r;r++)t.push(this.getPoint(r/e));return t},K.prototype.getPoints=function(t,r){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,r);t=t||12;var i,n,a,o,s,h,l,u,c,d,f,m,g,v,y,x,b,_,w=[];for(i=0,n=this.actions.length;n>i;i++)switch(a=this.actions[i],o=a.action,s=a.args,o){case e.PathActions.MOVE_TO:w.push(new p(s[0],s[1]));break;case e.PathActions.LINE_TO:w.push(new p(s[0],s[1]));break;case e.PathActions.QUADRATIC_CURVE_TO:for(h=s[2],l=s[3],d=s[0],f=s[1],w.length>0?(v=w[w.length-1],m=v.x,g=v.y):(v=this.actions[i-1].args,m=v[v.length-2],g=v[v.length-1]),y=1;t>=y;y++)x=y/t,b=$.Utils.b2(x,m,d,h),_=$.Utils.b2(x,g,f,l),w.push(new p(b,_));break;case e.PathActions.BEZIER_CURVE_TO:for(h=s[4],l=s[5],d=s[0],f=s[1],u=s[2],c=s[3],w.length>0?(v=w[w.length-1],m=v.x,g=v.y):(v=this.actions[i-1].args,m=v[v.length-2],g=v[v.length-1]),y=1;t>=y;y++)x=y/t,b=$.Utils.b3(x,m,d,u,h),_=$.Utils.b3(x,g,f,c,l),w.push(new p(b,_));break;case e.PathActions.CSPLINE_THRU:v=this.actions[i-1].args;var M=new p(v[v.length-2],v[v.length-1]),S=[M],T=t*s[0].length;S=S.concat(s[0]);var E=new q(S);for(y=1;T>=y;y++)w.push(E.getPointAt(y/T));break;case e.PathActions.ARC:var A,C=s[0],L=s[1],R=s[2],P=s[3],F=s[4],U=!!s[5],D=F-P,B=2*t;for(y=1;B>=y;y++)x=y/B,U||(x=1-x),A=P+x*D,b=C+R*Math.cos(A),_=L+R*Math.sin(A),w.push(new p(b,_));break;case e.PathActions.ELLIPSE:var A,C=s[0],L=s[1],z=s[2],k=s[3],P=s[4],F=s[5],U=!!s[6],D=F-P,B=2*t;for(y=1;B>=y;y++)x=y/B,U||(x=1-x),A=P+x*D,b=C+z*Math.cos(A),_=L+k*Math.sin(A),w.push(new p(b,_))}var N=w[w.length-1],O=1e-10;return Math.abs(N.x-w[0].x)<O&&Math.abs(N.y-w[0].y)<O&&w.splice(w.length-1,1),r&&w.push(w[0]),w},K.prototype.toShapes=function(t,r){function i(t){var r,i,n,a,o,s=[],h=new K;for(r=0,i=t.length;i>r;r++)n=t[r],o=n.args,a=n.action,a==e.PathActions.MOVE_TO&&0!=h.actions.length&&(s.push(h),h=new K),h[a].apply(h,o);return 0!=h.actions.length&&s.push(h),s}function n(e){for(var t=[],r=0,i=e.length;i>r;r++){var n=e[r],a=new $;a.actions=n.actions,a.curves=n.curves,t.push(a)}return t}function a(e,t){for(var r=1e-10,i=t.length,n=!1,a=i-1,o=0;i>o;a=o++){var s=t[a],h=t[o],l=h.x-s.x,u=h.y-s.y;if(Math.abs(u)>r){if(0>u&&(s=t[o],l=-l,h=t[a],u=-u),e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(0==c)return!0;if(0>c)continue;n=!n}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return!0}}return n}var o=i(this.actions);if(0==o.length)return[];if(r===!0)return n(o);var s,h,l,u=[];if(1==o.length)return h=o[0],l=new $,l.actions=h.actions,l.curves=h.curves,u.push(l),u;var c=!$.Utils.isClockWise(o[0].getPoints());c=t?!c:c;var d,f=[],p=[],m=[],g=0;p[g]=void 0,m[g]=[];var v,y;for(v=0,y=o.length;y>v;v++)h=o[v],d=h.getPoints(),s=$.Utils.isClockWise(d),s=t?!s:s,s?(!c&&p[g]&&g++,p[g]={s:new $,p:d},p[g].s.actions=h.actions,p[g].s.curves=h.curves,c&&g++,m[g]=[]):m[g].push({h:h,p:d[0]});if(!p[0])return n(o);if(p.length>1){for(var x=!1,b=[],_=0,w=p.length;w>_;_++)f[_]=[];for(var _=0,w=p.length;w>_;_++)for(var M=m[_],S=0;S<M.length;S++){for(var T=M[S],E=!0,A=0;A<p.length;A++)a(T.p,p[A].p)&&(_!=A&&b.push({froms:_,tos:A,hole:S}),E?(E=!1,f[A].push(T)):x=!0);E&&f[_].push(T)}b.length>0&&(x||(m=f))}var C,L,R;for(v=0,y=p.length;y>v;v++)for(l=p[v].s,u.push(l),C=m[v],L=0,R=C.length;R>L;L++)l.holes.push(C[L].h);return u},Z.prototype=Object.create(z.prototype),Z.prototype.constructor=Z,Z.NoTaper=function(){return 1},Z.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},Z.FrenetFrames=function(t,r,i){function n(){g[0]=new h,v[0]=new h,s=Number.MAX_VALUE,l=Math.abs(m[0].x),u=Math.abs(m[0].y),c=Math.abs(m[0].z),s>=l&&(s=l,p.set(1,0,0)),s>=u&&(s=u,p.set(0,1,0)),s>=c&&p.set(0,0,1),y.crossVectors(m[0],p).normalize(),g[0].crossVectors(m[0],y),v[0].crossVectors(m[0],g[0])}var a,s,l,u,c,d,f,p=new h,m=[],g=[],v=[],y=new h,x=new o,b=r+1,_=1e-4;for(this.tangents=m,this.normals=g,this.binormals=v,d=0;b>d;d++)f=d/(b-1),m[d]=t.getTangentAt(f),m[d].normalize();for(n(),d=1;b>d;d++)g[d]=g[d-1].clone(),v[d]=v[d-1].clone(),y.crossVectors(m[d-1],m[d]),y.length()>_&&(y.normalize(),a=Math.acos(e.Math.clamp(m[d-1].dot(m[d]),-1,1)),g[d].applyMatrix4(x.makeRotationAxis(y,a))),v[d].crossVectors(m[d],g[d]);if(i)for(a=Math.acos(e.Math.clamp(g[0].dot(g[b-1]),-1,1)),a/=b-1,m[0].dot(y.crossVectors(g[0],g[b-1]))>0&&(a=-a),d=1;b>d;d++)g[d].applyMatrix4(x.makeRotationAxis(m[d],a*d)),v[d].crossVectors(m[d],g[d])},Q.prototype=Object.create(z.prototype),Q.prototype.constructor=Q,Q.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;r>i;i++){var n=e[i];this.addShape(n,t)}},Q.prototype.addShape=function(e,t){function r(e,t,r){return t||i("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function n(e,t,r){var i,n,a=1e-10,o=1,s=e.x-t.x,h=e.y-t.y,l=r.x-e.x,u=r.y-e.y,c=s*s+h*h,d=s*u-h*l;if(Math.abs(d)>a){var f=Math.sqrt(c),m=Math.sqrt(l*l+u*u),g=t.x-h/f,v=t.y+s/f,y=r.x-u/m,x=r.y+l/m,b=((y-g)*u-(x-v)*l)/(s*u-h*l);i=g+s*b-e.x,n=v+h*b-e.y;var _=i*i+n*n;if(2>=_)return new p(i,n);o=Math.sqrt(_/2)}else{var w=!1;s>a?l>a&&(w=!0):-a>s?-a>l&&(w=!0):Math.sign(h)==Math.sign(u)&&(w=!0),w?(i=-h,n=s,o=Math.sqrt(c)):(i=s,n=h,o=Math.sqrt(c/2))}return new p(i/o,n/o)}function a(){if(w){var e=0,t=Y*e;for(ee=0;K>ee;ee++)q=I[ee],u(q[2]+t,q[1]+t,q[0]+t);for(e=S+2*_,t=Y*e,ee=0;K>ee;ee++)q=I[ee],u(q[0]+t,q[1]+t,q[2]+t)}else{for(ee=0;K>ee;ee++)q=I[ee],u(q[2],q[1],q[0]);for(ee=0;K>ee;ee++)q=I[ee],u(q[0]+Y*S,q[1]+Y*S,q[2]+Y*S)}}function o(){var e=0;for(s(H,e),e+=H.length,F=0,U=N.length;U>F;F++)R=N[F],s(R,e),e+=R.length}function s(e,t){var r,i;for(ee=e.length;--ee>=0;){r=ee,i=ee-1,0>i&&(i=e.length-1);var n=0,a=S+2*_;for(n=0;a>n;n++){var o=Y*n,s=Y*(n+1),h=t+r+o,l=t+i+o,u=t+i+s,d=t+r+s;c(h,l,u,d,e,n,a,r,i)}}}function l(e,t,r){D.vertices.push(new h(e,t,r))}function u(e,t,r){e+=B,t+=B,r+=B,D.faces.push(new P(e,t,r,null,null,A));var i=L.generateTopUV(D,e,t,r);D.faceVertexUvs[0].push(i)}function c(e,t,r,i){e+=B,t+=B,r+=B,i+=B,D.faces.push(new P(e,t,i,null,null,C)),D.faces.push(new P(t,r,i,null,null,C));var n=L.generateSideWallUV(D,e,t,r,i);D.faceVertexUvs[0].push([n[0],n[1],n[3]]),D.faceVertexUvs[0].push([n[1],n[2],n[3]])}var d,f,m,g,v,y=void 0!==t.amount?t.amount:100,x=void 0!==t.bevelThickness?t.bevelThickness:6,b=void 0!==t.bevelSize?t.bevelSize:x-2,_=void 0!==t.bevelSegments?t.bevelSegments:3,w=void 0!==t.bevelEnabled?t.bevelEnabled:!0,M=void 0!==t.curveSegments?t.curveSegments:12,S=void 0!==t.steps?t.steps:1,T=t.extrudePath,E=!1,A=t.material,C=t.extrudeMaterial,L=void 0!==t.UVGenerator?t.UVGenerator:Q.WorldUVGenerator;T&&(d=T.getSpacedPoints(S),E=!0,w=!1,f=void 0!==t.frames?t.frames:new Z.FrenetFrames(T,S,!1),m=new h,g=new h,v=new h),w||(_=0,x=0,b=0);var R,F,U,D=this,B=this.vertices.length,z=e.extractPoints(M),k=z.shape,N=z.holes,O=!$.Utils.isClockWise(k);if(O){for(k=k.reverse(),F=0,U=N.length;U>F;F++)R=N[F],$.Utils.isClockWise(R)&&(N[F]=R.reverse());O=!1}var I=$.Utils.triangulateShape(k,N),H=k;for(F=0,U=N.length;U>F;F++)R=N[F],k=k.concat(R);for(var V,W,G,j,X,q,Y=k.length,K=I.length,J=[],ee=0,te=H.length,re=te-1,ie=ee+1;te>ee;ee++,re++,ie++)re===te&&(re=0),ie===te&&(ie=0),J[ee]=n(H[ee],H[re],H[ie]);var ne,ae=[],oe=J.concat();for(F=0,U=N.length;U>F;F++){for(R=N[F],ne=[],ee=0,te=R.length,re=te-1,ie=ee+1;te>ee;ee++,re++,ie++)re===te&&(re=0),ie===te&&(ie=0),ne[ee]=n(R[ee],R[re],R[ie]);ae.push(ne),oe=oe.concat(ne)}for(V=0;_>V;V++){for(G=V/_,j=x*(1-G),W=b*Math.sin(G*Math.PI/2),ee=0,te=H.length;te>ee;ee++)X=r(H[ee],J[ee],W),l(X.x,X.y,-j);for(F=0,U=N.length;U>F;F++)for(R=N[F],ne=ae[F],ee=0,te=R.length;te>ee;ee++)X=r(R[ee],ne[ee],W),l(X.x,X.y,-j)}for(W=b,ee=0;Y>ee;ee++)X=w?r(k[ee],oe[ee],W):k[ee],E?(g.copy(f.normals[0]).multiplyScalar(X.x),m.copy(f.binormals[0]).multiplyScalar(X.y),v.copy(d[0]).add(g).add(m),l(v.x,v.y,v.z)):l(X.x,X.y,0);var se;for(se=1;S>=se;se++)for(ee=0;Y>ee;ee++)X=w?r(k[ee],oe[ee],W):k[ee],E?(g.copy(f.normals[se]).multiplyScalar(X.x),m.copy(f.binormals[se]).multiplyScalar(X.y),v.copy(d[se]).add(g).add(m),l(v.x,v.y,v.z)):l(X.x,X.y,y/S*se);for(V=_-1;V>=0;V--){for(G=V/_,j=x*(1-G),W=b*Math.sin(G*Math.PI/2),ee=0,te=H.length;te>ee;ee++)X=r(H[ee],J[ee],W),l(X.x,X.y,y+j);for(F=0,U=N.length;U>F;F++)for(R=N[F],ne=ae[F],ee=0,te=R.length;te>ee;ee++)X=r(R[ee],ne[ee],W),E?l(X.x,X.y+d[S-1].y,d[S-1].x+j):l(X.x,X.y,y+j)}a(),o()},Q.WorldUVGenerator={generateTopUV:function(e,t,r,i){var n=e.vertices,a=n[t],o=n[r],s=n[i];return[new p(a.x,a.y),new p(o.x,o.y),new p(s.x,s.y)]},generateSideWallUV:function(e,t,r,i,n){var a=e.vertices,o=a[t],s=a[r],h=a[i],l=a[n];return Math.abs(o.y-s.y)<.01?[new p(o.x,1-o.z),new p(s.x,1-s.z),new p(h.x,1-h.z),new p(l.x,1-l.z)]:[new p(o.y,1-o.z),new p(s.y,1-s.z),new p(h.y,1-h.z),new p(l.y,1-l.z)]}},J.prototype=Object.create(z.prototype),J.prototype.constructor=J,J.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;i>r;r++)this.addShape(e[r],t);return this},J.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,a=void 0!==t.curveSegments?t.curveSegments:12,o=t.material,s=void 0===t.UVGenerator?Q.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,u=e.extractPoints(a),c=u.shape,d=u.holes,f=!$.Utils.isClockWise(c);if(f){for(c=c.reverse(),r=0,i=d.length;i>r;r++)n=d[r],$.Utils.isClockWise(n)&&(d[r]=n.reverse());f=!1}var p=$.Utils.triangulateShape(c,d);for(r=0,i=d.length;i>r;r++)n=d[r],c=c.concat(n);var m,g,v=c.length,y=p.length;for(r=0;v>r;r++)m=c[r],this.vertices.push(new h(m.x,m.y,0));for(r=0;y>r;r++){g=p[r];var x=g[0]+l,b=g[1]+l,_=g[2]+l;this.faces.push(new P(x,b,_,null,null,o)),this.faceVertexUvs[0].push(s.generateTopUV(this,x,b,_))}},$.prototype=Object.create(K.prototype),$.prototype.constructor=$,$.prototype.extrude=function(e){var t=new Q(this,e);return t},$.prototype.makeGeometry=function(e){var t=new J(this,e);return t},$.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},$.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},$.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},$.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},$.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},$.Utils={triangulateShape:function(t,i){function n(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function a(e,t,r,i,a){var o=1e-10,s=t.x-e.x,h=t.y-e.y,l=i.x-r.x,u=i.y-r.y,c=e.x-r.x,d=e.y-r.y,f=h*l-s*u,p=h*c-s*d;if(Math.abs(f)>o){var m;if(f>0){if(0>p||p>f)return[];if(m=u*c-l*d,0>m||m>f)return[]}else{if(p>0||f>p)return[];if(m=u*c-l*d,m>0||f>m)return[]}if(0==m)return!a||0!=p&&p!=f?[e]:[];if(m==f)return!a||0!=p&&p!=f?[t]:[];if(0==p)return[r];if(p==f)return[i];var g=m/f;return[{x:e.x+g*s,y:e.y+g*h}]}if(0!=p||u*c!=l*d)return[];var v=0==s&&0==h,y=0==l&&0==u;if(v&&y)return e.x!=r.x||e.y!=r.y?[]:[e];if(v)return n(r,i,e)?[e]:[];if(y)return n(e,t,r)?[r]:[];var x,b,_,w,M,S,T,E;return 0!=s?(e.x<t.x?(x=e,_=e.x,b=t,w=t.x):(x=t,_=t.x,b=e,w=e.x),r.x<i.x?(M=r,T=r.x,S=i,E=i.x):(M=i,T=i.x,S=r,E=r.x)):(e.y<t.y?(x=e,_=e.y,b=t,w=t.y):(x=t,_=t.y,b=e,w=e.y),r.y<i.y?(M=r,T=r.y,S=i,E=i.y):(M=i,T=i.y,S=r,E=r.y)),T>=_?T>w?[]:w==T?a?[]:[M]:E>=w?[M,b]:[M,S]:_>E?[]:_==E?a?[]:[x]:E>=w?[x,b]:[x,S]}function o(e,t,r,i){var n=1e-10,a=t.x-e.x,o=t.y-e.y,s=r.x-e.x,h=r.y-e.y,l=i.x-e.x,u=i.y-e.y,c=a*h-o*s,d=a*u-o*l;if(Math.abs(c)>n){var f=l*h-u*s;return c>0?d>=0&&f>=0:d>=0||f>=0}return d>0}function s(e,t){function r(e,t){var r=y.length-1,i=e-1;0>i&&(i=r);var n=e+1;n>r&&(n=0);var a=o(y[e],y[i],y[n],s[t]);if(!a)return!1;var h=s.length-1,l=t-1;0>l&&(l=h);var u=t+1;return u>h&&(u=0),a=o(s[t],s[l],s[u],y[e]),a?!0:!1}function i(e,t){var r,i,n;for(r=0;r<y.length;r++)if(i=r+1,i%=y.length,n=a(e,t,y[r],y[i],!0),n.length>0)return!0;return!1}function n(e,r){var i,n,o,s,h;for(i=0;i<x.length;i++)for(n=t[x[i]],o=0;o<n.length;o++)if(s=o+1,s%=n.length,h=a(e,r,n[o],n[s],!0),h.length>0)return!0;return!1}for(var s,h,l,u,c,d,f,p,m,g,v,y=e.concat(),x=[],b=[],_=0,w=t.length;w>_;_++)x.push(_);for(var M=0,S=2*x.length;x.length>0;){if(S--,0>S){console.log("Infinite Loop! Holes left:"+x.length+", Probably Hole outside Shape!");break}for(l=M;l<y.length;l++){u=y[l],h=-1;for(var _=0;_<x.length;_++)if(d=x[_],f=u.x+":"+u.y+":"+d,void 0===b[f]){s=t[d];for(var T=0;T<s.length;T++)if(c=s[T],r(l,T)&&!i(u,c)&&!n(u,c)){h=T,x.splice(_,1),p=y.slice(0,l+1),m=y.slice(l),g=s.slice(h),v=s.slice(0,h+1),y=p.concat(g).concat(v).concat(m),M=l;break}if(h>=0)break;b[f]=!0}if(h>=0)break}}return y}for(var h,l,u,c,d,f,p={},m=t.concat(),g=0,v=i.length;v>g;g++)Array.prototype.push.apply(m,i[g]);for(h=0,l=m.length;l>h;h++)d=m[h].x+":"+m[h].y,void 0!==p[d]&&r("THREE.Shape: Duplicate point",d),p[d]=h;var y=s(t,i),x=e.FontUtils.Triangulate(y,!1);for(h=0,l=x.length;l>h;h++)for(c=x[h],u=0;3>u;u++)d=c[u].x+":"+c[u].y,f=p[d],void 0!==f&&(c[u]=f);return x.concat()},isClockWise:function(t){return e.FontUtils.Triangulate.area(t)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},e.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;return r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e,r.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,n=0,a=String(e).split(""),o=a.length,s=[];for(t=0;o>t;t++){var h=new K,l=this.extractGlyphPoints(a[t],r,i,n,h);n+=l.offset,s.push(l.path)}var u=n/2;return{paths:s,offset:u}},extractGlyphPoints:function(e,t,r,i,n){var a,o,s,h,l,u,c,d,f,p,m,g,v,y,x,b,_,w,M,S=[],T=t.glyphs[e]||t.glyphs["?"];if(T){if(T.o)for(h=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),u=h.length,c=r,d=r,a=0;u>a;)switch(l=h[a++]){case"m":f=h[a++]*c+i,p=h[a++]*d,n.moveTo(f,p);break;case"l":f=h[a++]*c+i,p=h[a++]*d,n.lineTo(f,p);break;case"q":if(m=h[a++]*c+i,g=h[a++]*d,x=h[a++]*c+i,b=h[a++]*d,n.quadraticCurveTo(x,b,m,g),M=S[S.length-1])for(v=M.x,y=M.y,o=1,s=this.divisions;s>=o;o++){var E=o/s;$.Utils.b2(E,v,x,m),$.Utils.b2(E,y,b,g)}break;case"b":if(m=h[a++]*c+i,g=h[a++]*d,x=h[a++]*c+i,b=h[a++]*d,_=h[a++]*c+i,w=h[a++]*d,n.bezierCurveTo(x,b,_,w,m,g),M=S[S.length-1])for(v=M.x,y=M.y,o=1,s=this.divisions;s>=o;o++){var E=o/s;$.Utils.b3(E,v,x,_,m),$.Utils.b3(E,y,b,w,g)}}return{offset:T.ha*r,path:n}}}},e.FontUtils.generateShapes=function(t,r){r=r||{};var i=void 0!==r.size?r.size:100,n=void 0!==r.curveSegments?r.curveSegments:4,a=void 0!==r.font?r.font:"helvetiker",o=void 0!==r.weight?r.weight:"normal",s=void 0!==r.style?r.style:"normal";e.FontUtils.size=i,e.FontUtils.divisions=n,e.FontUtils.face=a,e.FontUtils.weight=o,e.FontUtils.style=s;for(var h=e.FontUtils.drawText(t),l=h.paths,u=[],c=0,d=l.length;d>c;c++)Array.prototype.push.apply(u,l[c].toShapes());return u},function(e){var t=1e-10,i=function(e,t){var i=e.length;if(3>i)return null;var o,s,h,l=[],u=[],c=[];if(n(e)>0)for(s=0;i>s;s++)u[s]=s;else for(s=0;i>s;s++)u[s]=i-1-s;var d=i,f=2*d;for(s=d-1;d>2;){if(f--<=0)return r("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?c:l;if(o=s,o>=d&&(o=0),s=o+1,s>=d&&(s=0),h=s+1,h>=d&&(h=0),a(e,o,s,h,d,u)){var p,m,g,v,y;for(p=u[o],m=u[s],g=u[h],l.push([e[p],e[m],e[g]]),c.push([u[o],u[s],u[h]]),v=s,y=s+1;d>y;v++,y++)u[v]=u[y];d--,f=2*d}}return t?c:l},n=function(e){for(var t=e.length,r=0,i=t-1,n=0;t>n;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},a=function(e,r,i,n,a,o){var s,h,l,u,c,d,f,p,m;if(h=e[o[r]].x,l=e[o[r]].y,u=e[o[i]].x,c=e[o[i]].y,d=e[o[n]].x,f=e[o[n]].y,t>(u-h)*(f-l)-(c-l)*(d-h))return!1;var g,v,y,x,b,_,w,M,S,T,E,A,C,L,R;for(g=d-u,v=f-c,y=h-d,x=l-f,b=u-h,_=c-l,s=0;a>s;s++)if(p=e[o[s]].x,m=e[o[s]].y,!(p===h&&m===l||p===u&&m===c||p===d&&m===f)&&(w=p-h,M=m-l,S=p-u,T=m-c,E=p-d,A=m-f,R=g*T-v*S,C=b*M-_*w,L=y*A-x*E,R>=-t&&L>=-t&&C>=-t))return!1;return!0};return e.Triangulate=i,e.Triangulate.area=n,e}(e.FontUtils),e.typeface_js=self._typeface_js,e.GeometryUtils={merge:function(e,t,i){r("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t&&t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return r("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},ee.DEFAULT_IMAGE=void 0,ee.DEFAULT_MAPPING=e.UVMapping,ee.prototype={constructor:ee,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new ee),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},l.prototype.apply(ee.prototype);var nr=0;re.prototype=Object.create(ee.prototype),re.prototype.constructor=re,re.prototype.clone=function(){var e=new re;return ee.prototype.clone.call(this,e),e},ie.prototype=Object.create(ee.prototype),ie.prototype.constructor=ie,ie.clone=function(e){return void 0===e&&(e=new ie),ee.prototype.clone.call(this,e),e.images=this.images,e},e.DefaultLoadingManager=new ne,e.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},ae.prototype={constructor:ae,load:function(t,r,i,n){var a=this,o=e.Cache.get(t);if(void 0!==o)return void r(o);var s=document.createElement("img");return s.addEventListener("load",function(){e.Cache.add(t,this),r&&r(this),a.manager.itemEnd(t)},!1),void 0!==i&&s.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&s.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=t,a.manager.itemStart(t),s},setCrossOrigin:function(e){this.crossOrigin=e}},e.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){var n=new ae;n.crossOrigin=this.crossOrigin;var a=new ee(void 0,t);return n.load(e,function(e){a.image=e,a.needsUpdate=!0,r&&r(a)},void 0,function(e){i&&i(e)}),a.sourceFile=e,a},loadTextureCube:function(e,t,r,i){var n=[],a=new ae;a.crossOrigin=this.crossOrigin;var o=new ie(n,t);o.flipY=!1;for(var s=0,h=function(t){a.load(e[t],function(e){o.images[t]=e,s+=1,6===s&&(o.needsUpdate=!0,r&&r(o))},void 0,i)},l=0,u=e.length;u>l;++l)h(l);return o},loadCompressedTexture:function(){i("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){i("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var a=e.width,o=e.height,s=document.createElement("canvas");s.width=a,s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0);for(var l=h.getImageData(0,0,a,o).data,u=h.createImageData(a,o),c=u.data,d=0;a>d;d++)for(var f=0;o>f;f++){var p=0>f-1?0:f-1,m=f+1>o-1?o-1:f+1,g=0>d-1?0:d-1,v=d+1>a-1?a-1:d+1,y=[],x=[0,0,l[4*(f*a+d)]/255*t];y.push([-1,0,l[4*(f*a+g)]/255*t]),y.push([-1,-1,l[4*(p*a+g)]/255*t]),y.push([0,-1,l[4*(p*a+d)]/255*t]),y.push([1,-1,l[4*(p*a+v)]/255*t]),y.push([1,0,l[4*(f*a+v)]/255*t]),y.push([1,1,l[4*(m*a+v)]/255*t]),y.push([0,1,l[4*(m*a+d)]/255*t]),y.push([-1,1,l[4*(m*a+g)]/255*t]);for(var b=[],_=y.length,w=0;_>w;w++){var M=y[w],S=y[(w+1)%_];M=i(M,x),S=i(S,x),b.push(n(r(M,S)))}for(var T=[0,0,0],w=0;w<b.length;w++)T[0]+=b[w][0],T[1]+=b[w][1],T[2]+=b[w][2];T[0]/=b.length,T[1]/=b.length,T[2]/=b.length;var E=4*(f*a+d);c[E]=(T[0]+1)/2*255|0,c[E+1]=(T[1]+1)/2*255|0,c[E+2]=255*T[2]|0,c[E+3]=255}return h.putImageData(u,0,0),s},generateDataTexture:function(t,r,i){for(var n=t*r,a=new Uint8Array(3*n),o=Math.floor(255*i.r),s=Math.floor(255*i.g),h=Math.floor(255*i.b),l=0;n>l;l++)a[3*l]=o,a[3*l+1]=s,a[3*l+2]=h;var u=new re(a,t,r,e.RGBFormat);return u.needsUpdate=!0,u}},oe.prototype={constructor:oe,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var n=this[t];n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]="overdraw"==t?Number(i):i}}else r("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(t.name=this.name),this&&this.isMeshBasicMaterial?(t.color=this.color.getHex(),this.vertexColors!==e.NoColors&&(t.vertexColors=this.vertexColors),this.blending!==e.NormalBlending&&(t.blending=this.blending),this.side!==e.FrontSide&&(t.side=this.side)):this&&this.isMeshLambertMaterial?(t.color=this.color.getHex(),t.emissive=this.emissive.getHex(),this.vertexColors!==e.NoColors&&(t.vertexColors=this.vertexColors),this.shading!==e.SmoothShading&&(t.shading=this.shading),this.blending!==e.NormalBlending&&(t.blending=this.blending),this.side!==e.FrontSide&&(t.side=this.side)):this&&this.isMeshPhongMaterial?(t.color=this.color.getHex(),t.emissive=this.emissive.getHex(),t.specular=this.specular.getHex(),t.shininess=this.shininess,this.vertexColors!==e.NoColors&&(t.vertexColors=this.vertexColors),this.shading!==e.SmoothShading&&(t.shading=this.shading),this.blending!==e.NormalBlending&&(t.blending=this.blending),this.side!==e.FrontSide&&(t.side=this.side)):this&&this.isMeshNormalMaterial?(this.blending!==e.NormalBlending&&(t.blending=this.blending),this.side!==e.FrontSide&&(t.side=this.side)):this&&this.isMeshDepthMaterial?(this.blending!==e.NormalBlending&&(t.blending=this.blending),this.side!==e.FrontSide&&(t.side=this.side)):this&&this.isPointCloudMaterial?(t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.color=this.color.getHex(),this.vertexColors!==e.NoColors&&(t.vertexColors=this.vertexColors),this.blending!==e.NormalBlending&&(t.blending=this.blending)):this&&this.isShaderMaterial?(t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader):this&&this.isSpriteMaterial&&(t.color=this.color.getHex()),this.opacity<1&&(t.opacity=this.opacity),this.transparent!==!1&&(t.transparent=this.transparent),this.wireframe!==!1&&(t.wireframe=this.wireframe),t},clone:function(e){return void 0===e&&(e=new oe),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},l.prototype.apply(oe.prototype);var ar=0;he.prototype=Object.create(oe.prototype),he.prototype.constructor=he,he.prototype.clone=function(){var e=new he;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},le.prototype={constructor:le,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new h,t=new h;return function(r,i,n){var a=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new h;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new h;return function(t,r){var i=r||new h,n=t.delta(e),a=this.normal.dot(n);if(0==a)return 0==this.distanceToPoint(t.start)?i.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/a;return 0>o||o>1?void 0:i.copy(n).multiplyScalar(o).add(t.start)}}(),coplanarPoint:function(e){var t=e||new h;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new h,t=new h,r=new F;return function(i,n){var a=n||r.getNormalMatrix(i),o=e.copy(this.normal).applyMatrix3(a),s=this.coplanarPoint(t);return s.applyMatrix4(i),
this.setFromNormalAndCoplanarPoint(o,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new le).copy(this)}},ue.normal=function(){var e=new h;return function(t,r,i,n){var a=n||new h;a.subVectors(i,r),e.subVectors(t,r),a.cross(e);var o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),ue.barycoordFromPoint=function(){var e=new h,t=new h,r=new h;return function(i,n,a,o,s){e.subVectors(o,n),t.subVectors(a,n),r.subVectors(i,n);var l=e.dot(e),u=e.dot(t),c=e.dot(r),d=t.dot(t),f=t.dot(r),p=l*d-u*u,m=s||new h;if(0==p)return m.set(-2,-1,-1);var g=1/p,v=(d*c-u*f)*g,y=(l*f-u*c)*g;return m.set(1-v-y,y,v)}}(),ue.containsPoint=function(){var e=new h;return function(t,r,i,n){var a=ue.barycoordFromPoint(t,r,i,n,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),ue.prototype={constructor:ue,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new h,t=new h;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new h;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return ue.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new le;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return ue.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return ue.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new ue).copy(this)}},ce.prototype={constructor:ce,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new h;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new h;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new h;r.subVectors(e,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new h;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(){var e=new h,t=new h,r=new h;return function(i,n,a,o){e.copy(i).add(n).multiplyScalar(.5),t.copy(n).sub(i).normalize(),r.copy(this.origin).sub(e);var s,h,l,u,c=.5*i.distanceTo(n),d=-this.direction.dot(t),f=r.dot(this.direction),p=-r.dot(t),m=r.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(s=d*p-f,h=d*f-p,u=c*g,s>=0)if(h>=-u)if(u>=h){var v=1/g;s*=v,h*=v,l=s*(s+d*h+2*f)+h*(d*s+h+2*p)+m}else h=c,s=Math.max(0,-(d*h+f)),l=-s*s+h*(h+2*p)+m;else h=-c,s=Math.max(0,-(d*h+f)),l=-s*s+h*(h+2*p)+m;else-u>=h?(s=Math.max(0,-(-d*c+f)),h=s>0?-c:Math.min(Math.max(-c,-p),c),l=-s*s+h*(h+2*p)+m):u>=h?(s=0,h=Math.min(Math.max(-c,-p),c),l=h*(h+2*p)+m):(s=Math.max(0,-(d*c+f)),h=s>0?c:Math.min(Math.max(-c,-p),c),l=-s*s+h*(h+2*p)+m);else h=d>0?-c:c,s=Math.max(0,-(d*h+f)),l=-s*s+h*(h+2*p)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(h).add(e),l}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new h;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,h=i+o;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new h;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,i,n,a,o,s,h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,c=this.origin;return h>=0?(r=(e.min.x-c.x)*h,i=(e.max.x-c.x)*h):(r=(e.max.x-c.x)*h,i=(e.min.x-c.x)*h),l>=0?(n=(e.min.y-c.y)*l,a=(e.max.y-c.y)*l):(n=(e.max.y-c.y)*l,a=(e.min.y-c.y)*l),r>a||n>i?null:((n>r||r!==r)&&(r=n),(i>a||i!==i)&&(i=a),u>=0?(o=(e.min.z-c.z)*u,s=(e.max.z-c.z)*u):(o=(e.max.z-c.z)*u,s=(e.min.z-c.z)*u),r>s||o>i?null:((o>r||r!==r)&&(r=o),(i>s||i!==i)&&(i=s),0>i?null:this.at(r>=0?r:i,t)))},intersectTriangle:function(){var e=new h,t=new h,r=new h,i=new h;return function(n,a,o,s,h){t.subVectors(a,n),r.subVectors(o,n),i.crossVectors(t,r);var l,u=this.direction.dot(i);if(u>0){if(s)return null;l=1}else{if(!(0>u))return null;l=-1,u=-u}e.subVectors(this.origin,n);var c=l*this.direction.dot(r.crossVectors(e,r));if(0>c)return null;var d=l*this.direction.dot(t.cross(e));if(0>d)return null;if(c+d>u)return null;var f=-l*e.dot(i);return 0>f?null:this.at(f/u,h)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new ce).copy(this)}},de.prototype=Object.create(c.prototype),de.prototype.constructor=de,de.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},de.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(r("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},de.prototype.raycast=function(){var t=new o,r=new ce,i=new D,n=new h,a=new h,s=new h;return function(o,h){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(this.matrixWorld),o.ray.isIntersectionSphere(i)!==!1&&(t.getInverse(this.matrixWorld),r.copy(o.ray).applyMatrix4(t),null===l.boundingBox||r.isIntersectionBox(l.boundingBox)!==!1))if(l&&l.isBufferGeometry){var u=this.material;if(void 0===u)return;var c,d,f,p=l.attributes,m=o.precision;if(void 0!==p.index){var g=p.index.array,v=p.position.array,y=l.offsets;0===y.length&&(y=[{start:0,count:g.length,index:0}]);for(var x=0,b=y.length;b>x;++x)for(var _=y[x].start,w=y[x].count,M=y[x].index,S=_,T=_+w;T>S;S+=3){if(c=M+g[S],d=M+g[S+1],f=M+g[S+2],n.fromArray(v,3*c),a.fromArray(v,3*d),s.fromArray(v,3*f),u.side===e.BackSide)var E=r.intersectTriangle(s,a,n,!0);else var E=r.intersectTriangle(n,a,s,u.side!==e.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var A=o.ray.origin.distanceTo(E);m>A||A<o.near||A>o.far||h.push({distance:A,point:E,face:new P(c,d,f,ue.normal(n,a,s)),faceIndex:null,object:this})}}}else for(var v=p.position.array,S=0,C=0,T=v.length;T>S;S+=3,C+=9){if(c=S,d=S+1,f=S+2,n.fromArray(v,C),a.fromArray(v,C+3),s.fromArray(v,C+6),u.side===e.BackSide)var E=r.intersectTriangle(s,a,n,!0);else var E=r.intersectTriangle(n,a,s,u.side!==e.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var A=o.ray.origin.distanceTo(E);m>A||A<o.near||A>o.far||h.push({distance:A,point:E,face:new P(c,d,f,ue.normal(n,a,s)),faceIndex:null,object:this})}}}else if(l&&l.isGeometry)for(var c,d,f,L=this.material&&this.material.isMeshFaceMaterial,R=L===!0?this.material.materials:null,m=o.precision,F=l.vertices,U=0,D=l.faces.length;D>U;U++){var B=l.faces[U],u=L===!0?R[B.materialIndex]:this.material;if(void 0!==u){if(c=F[B.a],d=F[B.b],f=F[B.c],u.morphTargets===!0){var z=l.morphTargets,k=this.morphTargetInfluences;n.set(0,0,0),a.set(0,0,0),s.set(0,0,0);for(var N=0,O=z.length;O>N;N++){var I=k[N];if(0!==I){var H=z[N].vertices;n.x+=(H[B.a].x-c.x)*I,n.y+=(H[B.a].y-c.y)*I,n.z+=(H[B.a].z-c.z)*I,a.x+=(H[B.b].x-d.x)*I,a.y+=(H[B.b].y-d.y)*I,a.z+=(H[B.b].z-d.z)*I,s.x+=(H[B.c].x-f.x)*I,s.y+=(H[B.c].y-f.y)*I,s.z+=(H[B.c].z-f.z)*I}}n.add(c),a.add(d),s.add(f),c=n,d=a,f=s}if(u.side===e.BackSide)var E=r.intersectTriangle(f,d,c,!0);else var E=r.intersectTriangle(c,d,f,u.side!==e.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var A=o.ray.origin.distanceTo(E);m>A||A<o.near||A>o.far||h.push({distance:A,point:E,face:B,faceIndex:U,object:this})}}}}}(),de.prototype.clone=function(e,t){return void 0===e&&(e=new de(this.geometry,this.material)),c.prototype.clone.call(this,e,t),e},e.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new c,i=0,n=t.length;n>i;i++)r.add(new de(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new o;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},e.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){r("THREE.AnimationHandler.add() has been deprecated.")},get:function(){r("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){r("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===!0)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),!(void 0===e.hierarchy[t].keys[r].rot||e.hierarchy[t].keys[r].rot&&e.hierarchy[t].keys[r].rot.isQuaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new s).fromArray(i)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var n={},r=0;r<e.hierarchy[t].keys.length;r++)for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++){var o=e.hierarchy[t].keys[r].morphTargets[a];n[o]=-1}e.hierarchy[t].usedMorphTargets=n;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var o in n){for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++)if(e.hierarchy[t].keys[r].morphTargets[a]===o){h[o]=e.hierarchy[t].keys[r].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[r].morphTargets.length&&(h[o]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}return e.initialized=!0,e},parse:function(e){var t=function(e,r){r.push(e);for(var i=0;i<e.children.length;i++)t(e.children[i],r)},r=[];if(e&&e.isSkinnedMesh)for(var i=0;i<e.skeleton.bones.length;i++)r.push(e.skeleton.bones[i]);else t(e,r);return r},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},fe.prototype={constructor:fe,keyTypes:["pos","rot","scl"],play:function(t,r){this.currentTime=void 0!==t?t:0,this.weight=void 0!==r?r:1,this.isPlaying=!0,this.reset(),e.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,e.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var r=this.hierarchy[e];void 0===r.animationCache&&(r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var i=this.data.name,n=r.animationCache.animations,a=n[i];void 0===a&&(a={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix},n[i]=a);for(var o=0;3>o;o++){for(var s=this.keyTypes[o],h=this.data.hierarchy[e].keys[0],l=this.getNextKeyWith(s,e,1);l.time<this.currentTime&&l.index>h.index;)h=l,l=this.getNextKeyWith(s,e,l.index+1);a.prevKey[s]=h,a.nextKey[s]=l}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var r=this.hierarchy[e],i=r.animationCache;if(void 0!==i){var n=i.blending;n.positionWeight=0,n.quaternionWeight=0,n.scaleWeight=0}}},update:function(){var t=[],r=new h,i=new h,n=new s,a=function(e,t){var r,i,n,a,s,h,l,u,c,d=[],f=[];return r=(e.length-1)*t,i=Math.floor(r),n=r-i,d[0]=0===i?i:i-1,d[1]=i,d[2]=i>e.length-2?i:i+1,d[3]=i>e.length-3?i:i+2,h=e[d[0]],l=e[d[1]],u=e[d[2]],c=e[d[3]],a=n*n,s=n*a,f[0]=o(h[0],l[0],u[0],c[0],n,a,s),f[1]=o(h[1],l[1],u[1],c[1],n,a,s),f[2]=o(h[2],l[2],u[2],c[2],n,a,s),f},o=function(e,t,r,i,n,a,o){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t};return function(o){if(this.isPlaying!==!1&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var h=this.data.length;(this.currentTime>h||this.currentTime<0)&&(this.loop?(this.currentTime%=h,this.currentTime<0&&(this.currentTime+=h),this.reset()):this.stop());for(var l=0,u=this.hierarchy.length;u>l;l++)for(var c=this.hierarchy[l],d=c.animationCache.animations[this.data.name],f=c.animationCache.blending,p=0;3>p;p++){var m=this.keyTypes[p],g=d.prevKey[m],v=d.nextKey[m];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&g.time>=this.currentTime){for(g=this.data.hierarchy[l].keys[0],v=this.getNextKeyWith(m,l,1);v.time<this.currentTime&&v.index>g.index;)g=v,v=this.getNextKeyWith(m,l,v.index+1);d.prevKey[m]=g,d.nextKey[m]=v}var y=(this.currentTime-g.time)/(v.time-g.time),x=g[m],b=v[m];if(0>y&&(y=0),y>1&&(y=1),"pos"===m){if(this.interpolationType===e.AnimationHandler.LINEAR){i.x=x[0]+(b[0]-x[0])*y,i.y=x[1]+(b[1]-x[1])*y,i.z=x[2]+(b[2]-x[2])*y;var _=this.weight/(this.weight+f.positionWeight);c.position.lerp(i,_),f.positionWeight+=this.weight}else if(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD){t[0]=this.getPrevKeyWith("pos",l,g.index-1).pos,t[1]=x,t[2]=b,t[3]=this.getNextKeyWith("pos",l,v.index+1).pos,y=.33*y+.33;var w=a(t,y),_=this.weight/(this.weight+f.positionWeight);f.positionWeight+=this.weight;var M=c.position;if(M.x=M.x+(w[0]-M.x)*_,M.y=M.y+(w[1]-M.y)*_,M.z=M.z+(w[2]-M.z)*_,this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD){var S=a(t,1.01*y);r.set(S[0],S[1],S[2]),r.sub(M),r.y=0,r.normalize();var T=Math.atan2(r.x,r.z);c.rotation.set(0,T,0)}}}else if("rot"===m)if(s.slerp(x,b,n,y),0===f.quaternionWeight)c.quaternion.copy(n),f.quaternionWeight=this.weight;else{var _=this.weight/(this.weight+f.quaternionWeight);s.slerp(c.quaternion,n,c.quaternion,_),f.quaternionWeight+=this.weight}else if("scl"===m){i.x=x[0]+(b[0]-x[0])*y,i.y=x[1]+(b[1]-x[1])*y,i.z=x[2]+(b[2]-x[2])*y;var _=this.weight/(this.weight+f.scaleWeight);c.scale.lerp(i,_),f.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(t,r,i){var n=this.data.hierarchy[r].keys;for(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][t])return n[i];return this.data.hierarchy[r].keys[0]},getPrevKeyWith:function(t,r,i){var n=this.data.hierarchy[r].keys;for(i=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][t])return n[i];return this.data.hierarchy[r].keys[n.length-1]}},pe.prototype={constructor:pe,play:function(t){if(this.currentTime=void 0!==t?t:0,this.isPlaying===!1){this.isPlaying=!0;var r,i,n,a=this.hierarchy.length;for(r=0;a>r;r++){i=this.hierarchy[r],n=this.data.hierarchy[r],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i.matrix);var o=this.data.hierarchy[r].keys;o.length&&(n.animationCache.prevKey=o[0],n.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,e.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,e.AnimationHandler.stop(this);for(var t=0;t<this.data.hierarchy.length;t++){var r=this.hierarchy[t],i=this.data.hierarchy[t];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;n.copy(r.matrix),r.matrix=n,delete i.animationCache}}},update:function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,i=this.hierarchy.length;i>r;r++){var n=this.hierarchy[r],a=this.data.hierarchy[r],o=a.keys,s=a.animationCache;if(o.length){var h=s.prevKey,l=s.nextKey;if(l.time<=this.currentTime){for(;l.time<this.currentTime&&l.index>h.index;)h=l,l=o[h.index+1];s.prevKey=h,s.nextKey=l}l.time>=this.currentTime?h.interpolate(l,this.currentTime):h.interpolate(l,l.time),this.data.hierarchy[r].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];return i[0]},getPrevKeyWith:function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]}},me.prototype={constructor:me,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(this.isPlaying!==!1){this.currentTime+=e,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,r=Math.floor(this.currentTime/t),i=this.mesh.morphTargetInfluences;r!=this.currentFrame&&(i[this.lastFrame]=0,i[this.currentFrame]=1,i[r]=0,this.lastFrame=this.currentFrame,this.currentFrame=r),i[r]=this.currentTime%t/t,i[this.lastFrame]=1-i[r]}}},ge.prototype=Object.create(c.prototype),ge.prototype.constructor=ge,ge.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},r.send(),this},ge.prototype.play=function(){if(this.isPlaying===!0)return void r("THREE.Audio: Audio is already playing.");var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e},ge.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},ge.prototype.stop=function(){this.source.stop(),this.startTime=0},ge.prototype.onEnded=function(){this.isPlaying=!1},ge.prototype.setLoop=function(e){this.source.loop=e},ge.prototype.setRefDistance=function(e){this.panner.refDistance=e},ge.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},ge.prototype.setVolume=function(e){this.gain.gain.value=e},ge.prototype.updateMatrixWorld=function(){var e=new h;return function(t){c.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),ve.prototype=Object.create(c.prototype),ve.prototype.constructor=ve,ve.prototype.updateMatrixWorld=function(){var e=new h,t=new s,r=new h,i=new h,n=new h,a=new h;return function(o){c.prototype.updateMatrixWorld.call(this,o);var s=this.context.listener,h=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),n.subVectors(e,a),s.setPosition(e.x,e.y,e.z),s.setOrientation(i.x,i.y,i.z,h.x,h.y,h.z),s.setVelocity(n.x,n.y,n.z),a.copy(e)}}(),ye.prototype=Object.create(c.prototype),ye.prototype.constructor=ye,ye.prototype.updateMatrixWorld=function(){var e=new h,t=new s,r=new h,i=new h,n=new s,a=new h;return function(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(i,n,a),this.matrix.decompose(e,t,r),this.matrixWorld.compose(i,t,a)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);for(var s=0,h=this.children.length;h>s;s++)this.children[s].updateMatrixWorld(o)}}(),xe.prototype=Object.create(Y.prototype),xe.prototype.constructor=xe,e.ClosedSplineCurve3=V.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-0)*e,i=Math.floor(r),n=r-i;i+=i>0?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length;var a=t[(i-1)%t.length],o=t[i%t.length],s=t[(i+1)%t.length],l=t[(i+2)%t.length],u=new h;return u.x=V.Utils.interpolate(a.x,o.x,s.x,l.x,n),u.y=V.Utils.interpolate(a.y,o.y,s.y,l.y,n),u.z=V.Utils.interpolate(a.z,o.z,s.z,l.z,n),u}),e.CubicBezierCurve3=V.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t=new h;return t.x=$.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=$.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=$.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),e.LineCurve3=V.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new h;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),e.QuadraticBezierCurve3=V.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=new h;return t.x=$.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=$.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=$.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),e.SplineCurve3=V.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,a=t[0==i?i:i-1],o=t[i],s=t[i>t.length-2?t.length-1:i+1],l=t[i>t.length-3?t.length-1:i+2],u=new h;return u.x=V.Utils.interpolate(a.x,o.x,s.x,l.x,n),u.y=V.Utils.interpolate(a.y,o.y,s.y,l.y,n),u.z=V.Utils.interpolate(a.z,o.z,s.z,l.z,n),u}),be.prototype=Object.create(z.prototype),be.prototype.constructor=be,_e.prototype=Object.create(z.prototype),_e.prototype.constructor=_e,Me.prototype=Object.create(z.prototype),Me.prototype.constructor=Me,Se.prototype=Object.create(z.prototype),Se.prototype.constructor=Se,Te.prototype=Object.create(z.prototype),Te.prototype.constructor=Te,Ee.prototype=Object.create(z.prototype),Ee.prototype.constructor=Ee,Ae.prototype=Object.create(z.prototype),Ae.prototype.constructor=Ae,Ce.prototype=Object.create(z.prototype),Ce.prototype.constructor=Ce,Le.prototype=Object.create(z.prototype),Le.prototype.constructor=Le,Re.prototype=Object.create(N.prototype),Re.prototype.constructor=Re,Pe.prototype=Object.create(z.prototype),Pe.prototype.constructor=Pe,Fe.prototype=Object.create(z.prototype),Fe.prototype.constructor=Fe,Ue.prototype=Object.create(z.prototype),Ue.prototype.constructor=Ue,De.prototype=Object.create(z.prototype),De.prototype.constructor=De,Be.prototype=Object.create(Q.prototype),Be.prototype.constructor=Be,ze.prototype=Object.create(z.prototype),ze.prototype.constructor=ze,ke.prototype=Object.create(z.prototype),ke.prototype.constructor=ke,Ne.prototype=Object.create(oe.prototype),Ne.prototype.constructor=Ne,Ne.prototype.clone=function(){var e=new Ne;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},e.LineStrip=0,e.LinePieces=1,Oe.prototype=Object.create(c.prototype),Oe.prototype.constructor=Oe,Oe.prototype.raycast=function(){var t=new o,r=new ce,i=new D;return function(n,a){var o=n.linePrecision,s=o*o,l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(this.matrixWorld),n.ray.isIntersectionSphere(i)!==!1){t.getInverse(this.matrixWorld),r.copy(n.ray).applyMatrix4(t);var u=new h,c=new h,d=new h,f=new h,p=this.mode===e.LineStrip?1:2;if(l&&l.isBufferGeometry){var m=l.attributes;if(void 0!==m.index){var g=m.index.array,v=m.position.array,y=l.offsets;0===y.length&&(y=[{start:0,count:g.length,index:0}]);for(var x=0;x<y.length;x++)for(var b=y[x].start,_=y[x].count,w=y[x].index,M=b;b+_-1>M;M+=p){var S=w+g[M],T=w+g[M+1];u.fromArray(v,3*S),c.fromArray(v,3*T);var E=r.distanceSqToSegment(u,c,f,d);if(!(E>s)){var A=r.origin.distanceTo(f);A<n.near||A>n.far||a.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:M,offsetIndex:x,face:null,faceIndex:null,object:this})}}}else for(var v=m.position.array,M=0;M<v.length/3-1;M+=p){u.fromArray(v,3*M),c.fromArray(v,3*M+3);var E=r.distanceSqToSegment(u,c,f,d);if(!(E>s)){var A=r.origin.distanceTo(f);A<n.near||A>n.far||a.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}else if(l&&l.isGeometry)for(var C=l.vertices,L=C.length,M=0;L-1>M;M+=p){var E=r.distanceSqToSegment(C[M],C[M+1],f,d);if(!(E>s)){var A=r.origin.distanceTo(f);A<n.near||A>n.far||a.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}}}(),Oe.prototype.clone=function(e){return void 0===e&&(e=new Oe(this.geometry,this.material,this.mode)),c.prototype.clone.call(this,e),e},e.ArrowHelper=function(){var e=new z;e.vertices.push(new h(0,0,0),new h(0,1,0));var t=new Me(0,.5,1,5,1);return t.applyMatrix((new o).makeTranslation(0,-.5,0)),function(r,i,n,a,o,s){c.call(this),void 0===a&&(a=16776960),void 0===n&&(n=1),void 0===o&&(o=.2*n),void 0===s&&(s=.2*o),this.position.copy(i),this.line=new Oe(e,new Ne({color:a})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new de(t,new he({color:a})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(n,o,s)}}(),e.ArrowHelper.prototype=Object.create(c.prototype),e.ArrowHelper.prototype.constructor=e.ArrowHelper,e.ArrowHelper.prototype.setDirection=function(){var e,t=new h;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),e.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},e.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Ie.prototype=Object.create(Oe.prototype),Ie.prototype.constructor=Ie,He.prototype=Object.create(de.prototype),He.prototype.constructor=He,He.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},Ve.prototype=Object.create(Oe.prototype),Ve.prototype.constructor=Ve,Ve.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,i=t.boundingBox.max,n=this.geometry.attributes.position.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=r.x,n[4]=i.y,n[5]=i.z,n[6]=r.x,n[7]=i.y,n[8]=i.z,n[9]=r.x,n[10]=r.y,n[11]=i.z,n[12]=r.x,n[13]=r.y,n[14]=i.z,n[15]=i.x,n[16]=r.y,n[17]=i.z,n[18]=i.x,n[19]=r.y,n[20]=i.z,n[21]=i.x,n[22]=i.y,n[23]=i.z,n[24]=i.x,n[25]=i.y,n[26]=r.z,n[27]=r.x,n[28]=i.y,n[29]=r.z,n[30]=r.x,n[31]=i.y,n[32]=r.z,n[33]=r.x,n[34]=r.y,n[35]=r.z,n[36]=r.x,n[37]=r.y,n[38]=r.z,n[39]=i.x,n[40]=r.y,n[41]=r.z,n[42]=i.x,n[43]=r.y,n[44]=r.z,n[45]=i.x,n[46]=i.y,n[47]=r.z,n[48]=i.x,n[49]=i.y,n[50]=i.z,n[51]=i.x,n[52]=i.y,n[53]=r.z,n[54]=r.x,n[55]=i.y,n[56]=i.z,n[57]=r.x,n[58]=i.y,n[59]=r.z,n[60]=r.x,n[61]=r.y,n[62]=i.z,n[63]=r.x,n[64]=r.y,n[65]=r.z,n[66]=i.x,n[67]=r.y,n[68]=i.z,n[69]=i.x,n[70]=r.y,n[71]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},We.prototype=Object.create(Oe.prototype),We.prototype.constructor=We,We.prototype.update=function(){var e,t,r=new h,i=new f,n=function(n,a,o,s){r.set(a,o,s).unproject(i);var h=t[n];if(void 0!==h)for(var l=0,u=h.length;u>l;l++)e.vertices[h[l]].copy(r)};return function(){e=this.geometry,t=this.pointMap;var r=1,a=1;i.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-r,-a,-1),n("n2",r,-a,-1),n("n3",-r,a,-1),n("n4",r,a,-1),n("f1",-r,-a,1),n("f2",r,-a,1),n("f3",-r,a,1),n("f4",r,a,1),n("u1",.7*r,1.1*a,-1),n("u2",.7*-r,1.1*a,-1),n("u3",0,2*a,-1),n("cf1",-r,0,1),n("cf2",r,0,1),n("cf3",0,-a,1),n("cf4",0,a,1),n("cn1",-r,0,-1),n("cn2",r,0,-1),n("cn3",0,-a,-1),n("cn4",0,a,-1),e.verticesNeedUpdate=!0}}(),Ge.prototype=Object.create(c.prototype),Ge.prototype.constructor=Ge,Ge.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ge.prototype.update=function(){var e=new h,t=new h,r=new h;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),je.prototype=Object.create(Oe.prototype),je.prototype.constructor=je,Xe.prototype=Object.create(Oe.prototype),Xe.prototype.constructor=Xe,Xe.prototype.update=function(){var e=this.geometry.vertices,t=this.object,r=t.geometry.vertices,i=t.geometry.faces,n=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(n);for(var a=0,o=0,s=i.length;s>a;a++,o+=2){var h=i[a];e[o].copy(r[h.a]).add(r[h.b]).add(r[h.c]).divideScalar(3).applyMatrix4(n),e[o+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}return this.geometry.verticesNeedUpdate=!0,this},qe.prototype=Object.create(Oe.prototype),qe.prototype.constructor=qe,qe.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},Ye.prototype=Object.create(c.prototype),Ye.prototype.constructor=Ye,Ye.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},Ye.prototype.update=function(){var e=new h;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),Ke.prototype=Object.create(de.prototype),Ke.prototype.constructor=Ke,Ke.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Ke.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},Ze.prototype=Object.create(Oe.prototype),Ze.prototype.constructor=Ze,Ze.prototype.getBoneList=function(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},Ze.prototype.update=function(){for(var e=this.geometry,t=(new o).getInverse(this.root.matrixWorld),r=new o,i=0,n=0;n<this.bones.length;n++){var a=this.bones[n];a.parent&&a.parent.isBone&&(r.multiplyMatrices(t,a.matrixWorld),e.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(t,a.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(r),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},Qe.prototype=Object.create(c.prototype),Qe.prototype.constructor=Qe,Qe.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Qe.prototype.update=function(){var e=new h,t=new h;return function(){var r=this.light.distance?this.light.distance:1e4,i=r*Math.tan(this.light.angle);

this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),Je.prototype=Object.create(Oe.prototype),Je.prototype.constructor=Je,Je.prototype.update=function(){var e=new h;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,n=this.object.geometry.faces,a=this.object.matrixWorld,o=0,s=0,h=n.length;h>s;s++)for(var l=n[s],u=0,c=l.vertexNormals.length;c>u;u++){var d=l[t[u]],f=i[d],p=l.vertexNormals[u];r[o].copy(f).applyMatrix4(a),e.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(r[o]),o+=1,r[o].copy(e),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),$e.prototype=Object.create(Oe.prototype),$e.prototype.constructor=$e,$e.prototype.update=function(){var e=new h;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,n=this.object.geometry.faces,a=this.object.matrixWorld,o=0,s=0,h=n.length;h>s;s++)for(var l=n[s],u=0,c=l.vertexTangents.length;c>u;u++){var d=l[t[u]],f=i[d],p=l.vertexTangents[u];r[o].copy(f).applyMatrix4(a),e.copy(p).transformDirection(a).multiplyScalar(this.size),e.add(r[o]),o+=1,r[o].copy(e),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),et.prototype=Object.create(Oe.prototype),et.prototype.constructor=et,tt.prototype=Object.create(c.prototype),tt.prototype.constructor=tt,rt.prototype=Object.create(de.prototype),rt.prototype.constructor=rt,rt.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},rt.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,i={},n=this.geometry,a=0,o=n.morphTargets.length;o>a;a++){var s=n.morphTargets[a],h=s.name.match(r);if(h&&h.length>1){var l=h[1];i[l]||(i[l]={start:1/0,end:-(1/0)});var u=i[l];a<u.start&&(u.start=a),a>u.end&&(u.end=a),t||(t=l)}}for(var l in i){var u=i[l];this.createAnimation(l,u.start,u.end,e)}this.firstAnimation=t},rt.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},rt.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},rt.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},rt.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},rt.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},rt.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},rt.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},rt.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},rt.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):r("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},rt.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},rt.prototype.update=function(t){for(var r=0,i=this.animationsList.length;i>r;r++){var n=this.animationsList[r];if(n.active){var a=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+e.Math.clamp(Math.floor(n.time/a),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var h=n.time%a/a;n.directionBackwards&&(h=1-h),this.morphTargetInfluences[n.currentFrame]=h*s,this.morphTargetInfluences[n.lastFrame]=(1-h)*s}}},it.prototype=Object.create(c.prototype),it.prototype.constructor=it,it.prototype.clone=function(e){return void 0===e&&(e=new it),c.prototype.clone.call(this,e),e.color.copy(this.color),e},nt.prototype=Object.create(it.prototype),nt.prototype.constructor=nt,nt.prototype.clone=function(){var e=new nt;return it.prototype.clone.call(this,e),e},at.prototype=Object.create(it.prototype),at.prototype.constructor=at,ot.prototype=Object.create(it.prototype),ot.prototype.constructor=ot,ot.prototype.clone=function(){var e=new ot;return it.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},st.prototype=Object.create(it.prototype),st.prototype.constructor=st,st.prototype.clone=function(){var e=new st;return it.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},ht.prototype=Object.create(it.prototype),ht.prototype.constructor=ht,ht.prototype.clone=function(){var e=new ht;return it.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},lt.prototype=Object.create(it.prototype),lt.prototype.constructor=lt,lt.prototype.clone=function(){var e=new lt;return it.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},e.DataTextureLoader=function(){this.isBinaryTextureLoader=!0,this._parser=null},ut.prototype={constructor:ut,load:function(t,r,i,n){var a=this,o=e.Cache.get(t);if(void 0!==o)return void(r&&r(o));var s=new XMLHttpRequest;s.open("GET",t,!0),s.addEventListener("load",function(){e.Cache.add(t,this.response),r&&r(this.response),a.manager.itemEnd(t)},!1),void 0!==i&&s.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&s.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),a.manager.itemStart(t)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},ct.prototype={constructor:ct,load:function(e,t,r,i){var n=this,a=new ut(n.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new N,r=e.data.attributes;for(var i in r){var n=r[i],a=new self[n.type](n.array);t.addAttribute(i,new b(a,n.itemSize))}var o=e.data.offsets;void 0!==o&&(t.offsets=JSON.parse(JSON.stringify(o)));var s=e.data.boundingSphere;if(void 0!==s){var l=new h;void 0!==s.center&&l.fromArray(s.center),t.boundingSphere=new D(l,s.radius)}return t}},dt.prototype=Object.create(ee.prototype),dt.prototype.constructor=dt,dt.prototype.clone=function(){var e=new dt;return ee.prototype.clone.call(this,e),e},ft.prototype={constructor:ft,load:function(t,r){var i=this,n=[],a=new dt;a.image=n;var o=new ut;if(o.setResponseType("arraybuffer"),t instanceof Array)for(var s=0,h=function(h){o.load(t[h],function(t){var o=i._parser(t,!0);n[h]={width:o.width,height:o.height,format:o.format,mipmaps:o.mipmaps},s+=1,6===s&&(1==o.mipmapCount&&(a.minFilter=e.LinearFilter),a.format=o.format,a.needsUpdate=!0,r&&r(a))})},l=0,u=t.length;u>l;++l)h(l);else o.load(t,function(t){var o=i._parser(t,!0);if(o.isCubemap)for(var s=o.mipmaps.length/o.mipmapCount,h=0;s>h;h++){n[h]={mipmaps:[]};for(var l=0;l<o.mipmapCount;l++)n[h].mipmaps.push(o.mipmaps[h*o.mipmapCount+l]),n[h].format=o.format,n[h].width=o.width,n[h].height=o.height}else a.image.width=o.width,a.image.height=o.height,a.mipmaps=o.mipmaps;1===o.mipmapCount&&(a.minFilter=e.LinearFilter),a.format=o.format,a.needsUpdate=!0,r&&r(a)});return a}},pt.prototype={constructor:pt,load:function(e,t,r,i){var n=this,a=new ut;a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new z;t.indices=e.indices,t.vertices=e.vertices,t.normals=e.normals,t.uvs=e.uvs;var r=e.boundingSphere;if(void 0!==r){var i=new h;void 0!==r.center&&i.fromArray(r.center),t.boundingSphere=new D(i,r.radius)}return t}},mt.prototype={constructor:mt,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=this.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;r>t;t++){var i=e[t];if(i&&i.isShaderMaterial)return!0}return!1},createMaterial:function(t,r){function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(t,n,a,s,h,l,u){var c,d=r+a,f=mt.Handlers.get(d);if(null!==f?c=f.load(d):(c=new ee,f=o.imageLoader,f.crossOrigin=o.crossOrigin,f.load(d,function(t){if(e.Math.isPowerOfTwo(t.width)===!1||e.Math.isPowerOfTwo(t.height)===!1){var r=i(t.width),n=i(t.height),a=document.createElement("canvas");a.width=r,a.height=n;var o=a.getContext("2d");o.drawImage(t,0,0,r,n),c.image=a}else c.image=t;c.needsUpdate=!0})),c.sourceFile=a,s&&(c.repeat.set(s[0],s[1]),1!==s[0]&&(c.wrapS=e.RepeatWrapping),1!==s[1]&&(c.wrapT=e.RepeatWrapping)),h&&c.offset.set(h[0],h[1]),l){var p={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping};void 0!==p[l[0]]&&(c.wrapS=p[l[0]]),void 0!==p[l[1]]&&(c.wrapT=p[l[1]])}u&&(c.anisotropy=u),t[n]=c}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var o=this,s="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var l=t.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==t.blending&&void 0!==THREE[t.blending]&&(h.blending=THREE[t.blending]),void 0!==t.transparent&&(h.transparent=t.transparent),void 0!==t.opacity&&t.opacity<1&&(h.transparent=!0),void 0!==t.depthTest&&(h.depthTest=t.depthTest),void 0!==t.depthWrite&&(h.depthWrite=t.depthWrite),void 0!==t.visible&&(h.visible=t.visible),void 0!==t.flipSided&&(h.side=e.BackSide),void 0!==t.doubleSided&&(h.side=e.DoubleSide),void 0!==t.wireframe&&(h.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?h.vertexColors=e.FaceColors:t.vertexColors&&(h.vertexColors=e.VertexColors)),t.colorDiffuse?h.color=a(t.colorDiffuse):t.DbgColor&&(h.color=t.DbgColor),t.colorSpecular&&(h.specular=a(t.colorSpecular)),t.colorEmissive&&(h.emissive=a(t.colorEmissive)),void 0!==t.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),t.opacity=t.transparency),void 0!==t.opacity&&(h.opacity=t.opacity),t.specularCoef&&(h.shininess=t.specularCoef),t.mapDiffuse&&r&&n(h,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&r&&n(h,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&r&&n(h,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&r&&n(h,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&r&&n(h,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapAlpha&&r&&n(h,"alphaMap",t.mapAlpha,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy),t.mapBumpScale&&(h.bumpScale=t.mapBumpScale),t.mapNormalFactor&&(h.normalScale=new p(t.mapNormalFactor,t.mapNormalFactor));var u=new THREE[s](h);return void 0!==t.DbgName&&(u.name=t.DbgName),u}},mt.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;r>t;t+=2){var i=this.handlers[t],n=this.handlers[t+1];if(i.test(e))return n}return null}},gt.prototype=Object.create(mt.prototype),gt.prototype.constructor=gt,gt.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},gt.prototype.loadAjaxJSON=function(e,t,r,n,a){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var h=JSON.parse(o.responseText),l=h.metadata;if(void 0!==l){if("object"===l.type)return void i("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void i("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var u=e.parse(h,n);r(u.geometry,u.materials)}else i("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else i("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?a&&(0===s&&(s=o.getResponseHeader("Content-Length")),a({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==a&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},gt.prototype.parse=function(e,t){function i(t){function r(e,t){return e&1<<t}var i,n,a,s,l,u,c,d,f,m,g,v,y,x,b,_,w,M,S,T,E,A,C,L,F,U,D,B=e.faces,z=e.vertices,k=e.normals,N=e.colors,O=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&O++;for(i=0;O>i;i++)o.faceVertexUvs[i]=[]}for(s=0,l=z.length;l>s;)M=new h,M.x=z[s++]*t,M.y=z[s++]*t,M.z=z[s++]*t,o.vertices.push(M);for(s=0,l=B.length;l>s;)if(m=B[s++],g=r(m,0),v=r(m,1),y=r(m,3),x=r(m,4),b=r(m,5),_=r(m,6),w=r(m,7),g){if(T=new P,T.a=B[s],T.b=B[s+1],T.c=B[s+3],E=new P,E.a=B[s+1],E.b=B[s+2],E.c=B[s+3],s+=4,v&&(f=B[s++],T.materialIndex=f,E.materialIndex=f),a=o.faces.length,y)for(i=0;O>i;i++)for(L=e.uvs[i],o.faceVertexUvs[i][a]=[],o.faceVertexUvs[i][a+1]=[],n=0;4>n;n++)d=B[s++],U=L[2*d],D=L[2*d+1],F=new p(U,D),2!==n&&o.faceVertexUvs[i][a].push(F),0!==n&&o.faceVertexUvs[i][a+1].push(F);if(x&&(c=3*B[s++],T.normal.set(k[c++],k[c++],k[c]),E.normal.copy(T.normal)),b)for(i=0;4>i;i++)c=3*B[s++],C=new h(k[c++],k[c++],k[c]),2!==i&&T.vertexNormals.push(C),0!==i&&E.vertexNormals.push(C);if(_&&(u=B[s++],A=N[u],T.color.setHex(A),E.color.setHex(A)),w)for(i=0;4>i;i++)u=B[s++],A=N[u],2!==i&&T.vertexColors.push(new R(A)),0!==i&&E.vertexColors.push(new R(A));o.faces.push(T),o.faces.push(E)}else{if(S=new P,S.a=B[s++],S.b=B[s++],S.c=B[s++],v&&(f=B[s++],S.materialIndex=f),a=o.faces.length,y)for(i=0;O>i;i++)for(L=e.uvs[i],o.faceVertexUvs[i][a]=[],n=0;3>n;n++)d=B[s++],U=L[2*d],D=L[2*d+1],F=new p(U,D),o.faceVertexUvs[i][a].push(F);if(x&&(c=3*B[s++],S.normal.set(k[c++],k[c++],k[c])),b)for(i=0;3>i;i++)c=3*B[s++],C=new h(k[c++],k[c++],k[c]),S.vertexNormals.push(C);if(_&&(u=B[s++],S.color.setHex(N[u])),w)for(i=0;3>i;i++)u=B[s++],S.vertexColors.push(new R(N[u]));o.faces.push(S)}}function n(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,n=e.skinWeights.length;n>i;i+=t){var a=e.skinWeights[i],s=t>1?e.skinWeights[i+1]:0,h=t>2?e.skinWeights[i+2]:0,l=t>3?e.skinWeights[i+3]:0;o.skinWeights.push(new B(a,s,h,l))}if(e.skinIndices)for(var i=0,n=e.skinIndices.length;n>i;i+=t){var u=e.skinIndices[i],c=t>1?e.skinIndices[i+1]:0,d=t>2?e.skinIndices[i+2]:0,f=t>3?e.skinIndices[i+3]:0;o.skinIndices.push(new B(u,c,d,f))}o.bones=e.bones,o.bones&&o.bones.length>0&&(o.skinWeights.length!==o.skinIndices.length||o.skinIndices.length!==o.vertices.length)&&r("THREE.JSONLoader: When skinning, number of vertices ("+o.vertices.length+"), skinIndices ("+o.skinIndices.length+"), and skinWeights ("+o.skinWeights.length+") should match."),o.animation=e.animation,o.animations=e.animations}function a(t){if(void 0!==e.morphTargets){var r,i,n,a,s,l;for(r=0,i=e.morphTargets.length;i>r;r++)for(o.morphTargets[r]={},o.morphTargets[r].name=e.morphTargets[r].name,o.morphTargets[r].vertices=[],s=o.morphTargets[r].vertices,l=e.morphTargets[r].vertices,n=0,a=l.length;a>n;n+=3){var u=new h;u.x=l[n]*t,u.y=l[n+1]*t,u.z=l[n+2]*t,s.push(u)}}if(void 0!==e.morphColors){var r,i,c,d,f,p,m;for(r=0,i=e.morphColors.length;i>r;r++)for(o.morphColors[r]={},o.morphColors[r].name=e.morphColors[r].name,o.morphColors[r].colors=[],f=o.morphColors[r].colors,p=e.morphColors[r].colors,c=0,d=p.length;d>c;c+=3)m=new R(16755200),m.setRGB(p[c],p[c+1],p[c+2]),f.push(m)}}var o=new z,s=void 0!==e.scale?1/e.scale:1;if(i(s),n(),a(s),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:o};var l=this.initMaterials(e.materials,t);return this.needsTangents(l)&&o.computeTangents(),{geometry:o,materials:l}},vt.prototype={constructor:vt,load:function(e,t,r,i){var n=this,a=new ut(n.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var r=0,i=e.materials.length;i>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},yt.prototype=Object.create(c.prototype),yt.prototype.constructor=yt,xt.prototype=Object.create(oe.prototype),xt.prototype.constructor=xt,xt.prototype.clone=function(){var e=new xt;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},e.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),i=new N;return i.addAttribute("index",new b(e,1)),i.addAttribute("position",new b(t,3)),i.addAttribute("uv",new b(r,2)),function(e){c.call(this),this.type="Sprite",this.geometry=i,this.material=void 0!==e?e:new xt}}(),e.Sprite.prototype=Object.create(c.prototype),e.Sprite.prototype.constructor=e.Sprite,e.Sprite.prototype.raycast=function(){var e=new h;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);i>this.scale.x||r.push({distance:i,point:this.position,face:null,object:this})}}(),e.Sprite.prototype.clone=function(t){return void 0===t&&(t=new e.Sprite(this.material)),c.prototype.clone.call(this,t),t},e.Particle=e.Sprite,bt.prototype=Object.create(oe.prototype),bt.prototype.constructor=bt,bt.prototype.clone=function(){var e=new bt;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Mt.prototype=Object.create(c.prototype),Mt.prototype.constructor=Mt,Mt.prototype.raycast=function(){var e=new o,t=new ce;return function(r,i){var n=this,a=n.geometry,o=r.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===a.boundingBox||t.isIntersectionBox(a.boundingBox)!==!1){var s=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=new h,u=function(e,a){var o=t.distanceToPoint(e);if(s>o){var h=t.closestPointToPoint(e);h.applyMatrix4(n.matrixWorld);var l=r.ray.origin.distanceTo(h);i.push({distance:l,distanceToRay:o,point:h.clone(),index:a,face:null,object:n})}};if(a&&a.isBufferGeometry){var c=a.attributes,d=c.position.array;if(void 0!==c.index){var f=c.index.array,p=a.offsets;if(0===p.length){var m={start:0,count:f.length,index:0};p=[m]}for(var g=0,v=p.length;v>g;++g)for(var y=p[g].start,x=p[g].count,b=p[g].index,_=y,w=y+x;w>_;_++){var M=b+f[_];l.fromArray(d,3*M),u(l,M)}}else for(var S=d.length/3,_=0;S>_;_++)l.set(d[3*_],d[3*_+1],d[3*_+2]),u(l,_)}else for(var T=this.geometry.vertices,_=0;_<T.length;_++)u(T[_],_)}}}(),Mt.prototype.clone=function(e){return void 0===e&&(e=new Mt(this.geometry,this.material)),c.prototype.clone.call(this,e),e},Tt.prototype=Object.create(c.prototype),Tt.prototype.constructor=Tt,Tt.prototype.clone=function(e){return void 0===e&&(e=new Tt),c.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},Et.prototype={constructor:Et,load:function(e,t,r,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,a=new ut(n.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){n.parse(JSON.parse(e),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(o)}),n=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,n),o=this.parseObject(e.object,r,a);return(void 0===e.images||0===e.images.length)&&void 0!==t&&t(o),o},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new gt,i=new ct,n=0,a=e.length;a>n;n++){var o,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new be(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":o=new _e(s.radius,s.segments);break;case"CylinderGeometry":o=new Me(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":o=new Ue(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":o=new Ee(s.radius,s.detail);break;case"TorusGeometry":o=new ze(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":o=new ke(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":o=i.parse(s);break;case"Geometry":o=r.parse(s.data).geometry}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),t[s.uuid]=o}return t},parseMaterials:function(e,t){var i={};if(void 0!==e)for(var n=function(e){return void 0===t[e]&&r("THREE.ObjectLoader: Undefined texture",e),t[e]},a=new vt,o=0,s=e.length;s>o;o++){var h=e[o],l=a.parse(h);l.uuid=h.uuid,void 0!==h.name&&(l.name=h.name),void 0!==h.map&&(l.map=n(h.map)),void 0!==h.bumpMap&&(l.bumpMap=n(h.bumpMap),h.bumpScale&&(l.bumpScale=new p(h.bumpScale,h.bumpScale))),void 0!==h.alphaMap&&(l.alphaMap=n(h.alphaMap)),void 0!==h.envMap&&(l.envMap=n(h.envMap)),void 0!==h.normalMap&&(l.normalMap=n(h.normalMap),h.normalScale&&(l.normalScale=new p(h.normalScale,h.normalScale))),void 0!==h.lightMap&&(l.lightMap=n(h.lightMap)),void 0!==h.specularMap&&(l.specularMap=n(h.specularMap)),i[h.uuid]=l}return i},parseImages:function(e,t){var r=this,i={};if(void 0!==e&&e.length>0){var n=new ne(t),a=new ae(n);a.setCrossOrigin(this.crossOrigin);for(var o=function(e){return r.manager.itemStart(e),a.load(e,function(){r.manager.itemEnd(e)})},s=0,h=e.length;h>s;s++){var l=e[s],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;i[l.uuid]=o(u)}}return i},parseTextures:function(e,t){var i={};if(void 0!==e)for(var n=0,a=e.length;a>n;n++){var o=e[n];void 0===o.image&&r('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&r("THREE.ObjectLoader: Undefined image",o.image);var s=new ee(t[o.image]);s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.repeat&&(s.repeat=new p(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(s.minFilter=THREE[o.minFilter]),void 0!==o.magFilter&&(s.magFilter=THREE[o.magFilter]),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),o.wrap instanceof Array&&(s.wrapS=THREE[o.wrap[0]],s.wrapT=THREE[o.wrap[1]]),i[o.uuid]=s}return i},parseObject:function(){var t=new o;return function(i,n,a){var o,s=function(e){return void 0===n[e]&&r("THREE.ObjectLoader: Undefined geometry",e),n[e]},h=function(e){return void 0===a[e]&&r("THREE.ObjectLoader: Undefined material",e),a[e]};switch(i.type){case"Scene":o=new Tt;break;case"PerspectiveCamera":o=new v(i.fov,i.aspect,i.near,i.far);break;case"OrthographicCamera":o=new x(i.left,i.right,i.top,i.bottom,i.near,i.far);break;case"AmbientLight":o=new nt(i.color);break;case"DirectionalLight":o=new ot(i.color,i.intensity);break;case"PointLight":o=new ht(i.color,i.intensity,i.distance,i.decay);break;case"SpotLight":o=new lt(i.color,i.intensity,i.distance,i.angle,i.exponent,i.decay);break;case"HemisphereLight":o=new st(i.color,i.groundColor,i.intensity);break;case"Mesh":o=new de(s(i.geometry),h(i.material));break;case"Line":o=new Oe(s(i.geometry),h(i.material),i.mode);break;case"PointCloud":o=new Mt(s(i.geometry),h(i.material));break;case"Sprite":o=new e.Sprite(h(i.material));break;case"Group":o=new yt;break;default:o=new c}if(o.uuid=i.uuid,void 0!==i.name&&(o.name=i.name),void 0!==i.matrix?(t.fromArray(i.matrix),t.decompose(o.position,o.quaternion,o.scale)):(void 0!==i.position&&o.position.fromArray(i.position),void 0!==i.rotation&&o.rotation.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale)),void 0!==i.visible&&(o.visible=i.visible),void 0!==i.userData&&(o.userData=i.userData),void 0!==i.children)for(var l in i.children)o.add(this.parseObject(i.children[l],n,a));return o}}()},At.prototype={constructor:At,load:function(e,t,r,i){var n=this,a=new ae(n.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){var r=new ee(e);r.needsUpdate=!0,void 0!==t&&t(r)},r,i)},setCrossOrigin:function(e){this.crossOrigin=e}},Ct.prototype=Object.create(oe.prototype),Ct.prototype.constructor=Ct,Ct.prototype.clone=function(){var e=new Ct;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Lt.prototype=Object.create(oe.prototype),Lt.prototype.constructor=Lt,Lt.prototype.clone=function(){var e=new Lt;return oe.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Rt.prototype={constructor:Rt,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;r>t;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new Rt,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},Pt.prototype=Object.create(oe.prototype),Pt.prototype.constructor=Pt,Pt.prototype.clone=function(){var e=new Pt;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Ft.prototype=Object.create(oe.prototype),Ft.prototype.constructor=Ft,Ft.prototype.clone=function(){var e=new Ft;return oe.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Ut.prototype=Object.create(oe.prototype),Ut.prototype.constructor=Ut,Ut.prototype.clone=function(){var e=new Ut;return oe.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},e.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i)t[n]=i[n]}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var n=e[r][i];t[r][i]=n&&n.isColor||n&&n.isVector2||n&&n.isVector3||n&&n.isVector4||n&&n.isMatrix4||n&&n.isTexture?n.clone():n instanceof Array?n.slice():n}}return t}},Dt.prototype=Object.create(oe.prototype),Dt.prototype.constructor=Dt,Dt.prototype.clone=function(){var t=new Dt;return oe.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},Bt.prototype=Object.create(Dt.prototype),Bt.prototype.constructor=Bt,Bt.prototype.clone=function(){var e=new Bt;return Dt.prototype.clone.call(this,e),e},zt.prototype={constructor:zt,set:function(e,t){return this.min.copy(e),
this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new p;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new p;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new p;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var r=t||new p;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new p;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new p;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new zt).copy(this)}},kt.prototype={constructor:kt,set:function(e,t,r,i,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],h=r[5],l=r[6],u=r[7],c=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(o-i,u-s,p-c,y-m).normalize(),t[1].setComponents(o+i,u+s,p+c,y+m).normalize(),t[2].setComponents(o+n,u+h,p+d,y+g).normalize(),t[3].setComponents(o-n,u-h,p-d,y-g).normalize(),t[4].setComponents(o-a,u-l,p-f,y-v).normalize(),t[5].setComponents(o+a,u+l,p+f,y+v).normalize(),this},intersectsObject:function(){var e=new D;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;6>n;n++){var a=t[n].distanceToPoint(r);if(i>a)return!1}return!0},intersectsBox:function(){var e=new h,t=new h;return function(r){for(var i=this.planes,n=0;6>n;n++){var a=i[n];e.x=a.normal.x>0?r.min.x:r.max.x,t.x=a.normal.x>0?r.max.x:r.min.x,e.y=a.normal.y>0?r.min.y:r.max.y,t.y=a.normal.y>0?r.max.y:r.min.y,e.z=a.normal.z>0?r.min.z:r.max.z,t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e),s=a.distanceToPoint(t);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new kt).copy(this)}},Nt.prototype={constructor:Nt,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new h;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new h;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new h;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var t=new h,r=new h;return function(i,n){t.subVectors(i,this.start),r.subVectors(this.end,this.start);var a=r.dot(r),o=r.dot(t),s=o/a;return n&&(s=e.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new h;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new Nt).copy(this)}},It.prototype=Object.create(c.prototype),It.prototype.constructor=It,Ht.prototype=Object.create(c.prototype),Ht.prototype.constructor=Ht,Ht.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},Ht.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;r>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},Ht.prototype.raycast=function(){var e=new h;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}(),Ht.prototype.update=function(){var e=new h,t=new h;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var n=1,a=this.objects.length;a>n&&i>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;a>n;n++)this.objects[n].object.visible=!1}}}(),Ht.prototype.clone=function(e){void 0===e&&(e=new Ht),c.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;r>t;t++){var i=this.objects[t].object.clone();i.visible=0===t,e.addLevel(i,this.objects[t].distance)}return e},Vt.prototype=Object.create(c.prototype),Vt.prototype.constructor=Vt,Vt.prototype.add=function(t,r,i,n,a,o){void 0===r&&(r=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===a&&(a=new R(16777215)),void 0===n&&(n=e.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:r,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:a,blending:n})},Vt.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},Wt.prototype=Object.create(de.prototype),Wt.prototype.constructor=Wt,Wt.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},Wt.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},Wt.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},Wt.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)_?(\d+)/,n=0,a=e.morphTargets.length;a>n;n++){var o=e.morphTargets[n],s=o.name.match(i);if(s&&s.length>1){var h=s[1];r[h]||(r[h]={start:1/0,end:-(1/0)});var l=r[h];n<l.start&&(l.start=n),n>l.end&&(l.end=n),t||(t=h)}}e.firstAnimation=t},Wt.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},Wt.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):r("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},Wt.prototype.updateAnimation=function(t){var r=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+e.Math.clamp(Math.floor(this.time/r),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var n=this.time%r/r;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},Wt.prototype.interpolateTargets=function(e,t,r){for(var i=this.morphTargetInfluences,n=0,a=i.length;a>n;n++)i[n]=0;e>-1&&(i[e]=1-r),t>-1&&(i[t]=r)},Wt.prototype.clone=function(e){return void 0===e&&(e=new Wt(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,de.prototype.clone.call(this,e),e},Gt.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new o;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},Gt.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},Gt.prototype.update=function(){var e=new o;return function(){for(var t=0,r=this.bones.length;r>t;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),jt.prototype=Object.create(de.prototype),jt.prototype.constructor=jt,jt.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},jt.prototype.pose=function(){this.skeleton.pose()},jt.prototype.normalizeSkinWeights=function(){if(this.geometry&&this.geometry.isGeometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},jt.prototype.updateMatrixWorld=function(){de.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):r("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},jt.prototype.clone=function(e){return void 0===e&&(e=new jt(this.geometry,this.material,this.useVertexTexture)),de.prototype.clone.call(this,e),e},e.WebGLShader=function(){var e=function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")};return function(t,n,a){var o=t.createShader(n);return t.shaderSource(o,a),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)===!1&&i("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(o)&&r("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(o),e(a)),o}}(),e.WebGLProgram=function(){var t=0,n=function(e){var t,r,i=[];for(var n in e)t=e[n],t!==!1&&(r="#define "+n+" "+t,i.push(r));return i.join("\n")},a=function(e,t,r){for(var i={},n=0,a=r.length;a>n;n++){var o=r[n];i[o]=e.getUniformLocation(t,o)}return i},o=function(e,t,r){for(var i={},n=0,a=r.length;a>n;n++){var o=r[n];i[o]=e.getAttribLocation(t,o)}return i};return function(s,h,l,u){var c=s,d=c.context,f=l.defines,p=l.__webglShader.uniforms,m=l.attributes,g=l.__webglShader.vertexShader,v=l.__webglShader.fragmentShader,y=l.index0AttributeName;void 0===y&&u.morphTargets===!0&&(y="position");var x="SHADOWMAP_TYPE_BASIC";u.shadowMapType===e.PCFShadowMap?x="SHADOWMAP_TYPE_PCF":u.shadowMapType===e.PCFSoftShadowMap&&(x="SHADOWMAP_TYPE_PCF_SOFT");var b="ENVMAP_TYPE_CUBE",_="ENVMAP_MODE_REFLECTION",w="ENVMAP_BLENDING_MULTIPLY";if(u.envMap){switch(l.envMap.mapping){case e.CubeReflectionMapping:case e.CubeRefractionMapping:b="ENVMAP_TYPE_CUBE";break;case e.EquirectangularReflectionMapping:case e.EquirectangularRefractionMapping:b="ENVMAP_TYPE_EQUIREC";break;case e.SphericalReflectionMapping:b="ENVMAP_TYPE_SPHERE"}switch(l.envMap.mapping){case e.CubeRefractionMapping:case e.EquirectangularRefractionMapping:_="ENVMAP_MODE_REFRACTION"}switch(l.combine){case e.MultiplyOperation:w="ENVMAP_BLENDING_MULTIPLY";break;case e.MixOperation:w="ENVMAP_BLENDING_MIX";break;case e.AddOperation:w="ENVMAP_BLENDING_ADD"}}var M,S,T=s.gammaFactor>0?s.gammaFactor:1,E=n(f),A=d.createProgram();l&&l.isRawShaderMaterial?(M="",S=""):(M=["precision "+u.precision+" float;","precision "+u.precision+" int;",E,u.supportsVertexTextures?"#define VERTEX_TEXTURES":"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+T,"#define MAX_DIR_LIGHTS "+u.maxDirLights,"#define MAX_POINT_LIGHTS "+u.maxPointLights,"#define MAX_SPOT_LIGHTS "+u.maxSpotLights,"#define MAX_HEMI_LIGHTS "+u.maxHemiLights,"#define MAX_SHADOWS "+u.maxShadows,"#define MAX_BONES "+u.maxBones,u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+_:"",u.lightMap?"#define USE_LIGHTMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.flatShading?"#define FLAT_SHADED":"",u.skinning?"#define USE_SKINNING":"",u.useVertexTexture?"#define BONE_TEXTURE":"",u.morphTargets?"#define USE_MORPHTARGETS":"",u.morphNormals?"#define USE_MORPHNORMALS":"",u.wrapAround?"#define WRAP_AROUND":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+x:"",u.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",u.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",u.sizeAttenuation?"#define USE_SIZEATTENUATION":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n"),S=["precision "+u.precision+" float;","precision "+u.precision+" int;",u.bumpMap||u.normalMap||u.flatShading?"#extension GL_OES_standard_derivatives : enable":"",E,"#define MAX_DIR_LIGHTS "+u.maxDirLights,"#define MAX_POINT_LIGHTS "+u.maxPointLights,"#define MAX_SPOT_LIGHTS "+u.maxSpotLights,"#define MAX_HEMI_LIGHTS "+u.maxHemiLights,"#define MAX_SHADOWS "+u.maxShadows,u.alphaTest?"#define ALPHATEST "+u.alphaTest:"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+T,u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+b:"",u.envMap?"#define "+_:"",u.envMap?"#define "+w:"",u.lightMap?"#define USE_LIGHTMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.flatShading?"#define FLAT_SHADED":"",u.metal?"#define METAL":"",u.wrapAround?"#define WRAP_AROUND":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+x:"",u.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",u.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var C=new e.WebGLShader(d,d.VERTEX_SHADER,M+g),L=new e.WebGLShader(d,d.FRAGMENT_SHADER,S+v);d.attachShader(A,C),d.attachShader(A,L),void 0!==y&&d.bindAttribLocation(A,0,y),d.linkProgram(A);var R=d.getProgramInfoLog(A);d.getProgramParameter(A,d.LINK_STATUS)===!1&&i("THREE.WebGLProgram: shader error: "+d.getError(),"gl.VALIDATE_STATUS",d.getProgramParameter(A,d.VALIDATE_STATUS),"gl.getPRogramInfoLog",R),""!==R&&r("THREE.WebGLProgram: gl.getProgramInfoLog()"+R),d.deleteShader(C),d.deleteShader(L);var P=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];u.useVertexTexture?(P.push("boneTexture"),P.push("boneTextureWidth"),P.push("boneTextureHeight")):P.push("boneGlobalMatrices"),u.logarithmicDepthBuffer&&P.push("logDepthBufFC");for(var F in p)P.push(F);this.uniforms=a(d,A,P),P=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var U=0;U<u.maxMorphTargets;U++)P.push("morphTarget"+U);for(var U=0;U<u.maxMorphNormals;U++)P.push("morphNormal"+U);for(var D in m)P.push(D);return this.attributes=o(d,A,P),this.attributesKeys=Object.keys(this.attributes),this.id=t++,this.code=h,this.usedTimes=1,this.program=A,this.vertexShader=C,this.fragmentShader=L,this}}(),e.ShaderChunk={},e.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",e.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",e.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",e.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",e.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",e.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",e.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",e.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = inputToLinear( color.xyz );\n\n#endif",e.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n	float distance = dot( planeNormal, point-pointOnPlane );\n	return point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n	if ( decayExponent > 0.0 ) {\n	  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n	}\n	return 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n	return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n	return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\n",e.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",e.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n	vec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n	vec3 objectNormal = morphedNormal;\n\n#else\n\n	vec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",e.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",e.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",e.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",e.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",e.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n		fogFactor = whiteCompliment( fogFactor );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",e.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",e.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	outgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",e.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",e.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",e.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",e.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",e.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n",
e.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			totalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n			// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			totalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalDiffuseLight += hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		totalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",e.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",e.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",e.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",e.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",e.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",e.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",e.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",e.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",e.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif",e.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",e.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",e.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",e.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",e.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",e.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",e.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",e.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",e.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",e.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n	shadowColor = inputToLinear( shadowColor );\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n",e.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",e.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",e.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",e.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",e.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",e.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",e.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",e.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",e.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",e.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#elif defined( USE_MORPHTARGETS )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif\n",e.UniformsLib={common:{diffuse:{type:"c",value:new R(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new B(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new p(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new R(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new R(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new B(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new R(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.common,e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"	#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",e.ShaderChunk.common,e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.alphamap_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.alphamap_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"	outgoingLight = diffuseColor.rgb;",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{emissive:{type:"c",value:new R(0)},wrapRGB:{type:"v3",value:new h(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",e.ShaderChunk.common,e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",e.ShaderChunk.common,e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.alphamap_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.alphamap_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{emissive:{type:"c",value:new R(0)},specular:{type:"c",value:new R(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new h(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",e.ShaderChunk.common,e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",e.ShaderChunk.common,e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.alphamap_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.alphamap_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",e.ShaderChunk.common,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",e.ShaderChunk.common,e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_particle_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.alphatest_fragment,"	outgoingLight = diffuseColor.rgb;",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",e.ShaderChunk.common,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",e.ShaderChunk.common,e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",e.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[e.ShaderChunk.common,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",e.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.common,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",e.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",e.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",e.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.common,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[e.ShaderChunk.common,e.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",e.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},$t.prototype.clone=function(){return new $t(this.color.getHex(),this.near,this.far)},er.prototype.clone=function(){return new er(this.color.getHex(),this.density)},tr.prototype=Object.create(ee.prototype),tr.prototype.constructor=tr,e.CanvasRenderer=a,e.Projector=n,e.error=i,e.warn=r,e.log=t,e.Camera=f,e.CubeCamera=y,e.OrthographicCamera=x,e.PerspectiveCamera=v,e.Float64Attribute=L,e.Float32Attribute=C,e.Uint32Attribute=A,e.Int32Attribute=E,e.Uint16Attribute=T,e.Int16Attribute=S,e.Uint8ClampedAttribute=M,e.Uint8Attribute=w,e.Int8Attribute=_,e.BufferAttribute=b,e.BufferGeometry=N,e.Clock=O,e.DynamicBufferAttribute=I,e.EventDispatcher=l,e.Face3=P,e.Face4=H,e.GeometryIdCount=k,e.Geometry=z,e.Object3DIdCount=d,e.Object3D=c,e.Raycaster=THREE$Raycaster,e.Animation=fe,e.KeyFrameAnimation=pe,e.MorphAnimation=me,e.Audio=ge,e.AudioListener=ve,e.Curve=V,e.CurvePath=G,e.Gyroscope=ye,e.Path=K,e.Shape=$,e.ArcCurve=xe,e.CubicBezierCurve=X,e.EllipseCurve=Y,e.LineCurve=W,e.QuadraticBezierCurve=j,e.SplineCurve=q,e.BoxGeometry=be,e.CircleGeometry=_e,e.CubeGeometry=we,e.CylinderGeometry=Me,e.DodecahedronGeometry=Te,e.ExtrudeGeometry=Q,e.IcosahedronGeometry=Ee,e.LatheGeometry=Ae,e.OctahedronGeometry=Ce,e.ParametricGeometry=Le,e.PlaneBufferGeometry=Re,e.PlaneGeometry=Pe,e.PolyhedronGeometry=Se,e.RingGeometry=Fe,e.ShapeGeometry=J,e.SphereGeometry=Ue,e.TetrahedronGeometry=De,e.TextGeometry=Be,e.TorusGeometry=ze,e.TorusKnotGeometry=ke,e.TubeGeometry=Z,e.AxisHelper=Ie,e.BoundingBoxHelper=He,e.BoxHelper=Ve,e.CameraHelper=We,e.DirectionalLightHelper=Ge,e.EdgesHelper=je,e.FaceNormalsHelper=Xe,e.GridHelper=qe,e.HemisphereLightHelper=Ye,e.PointLightHelper=Ke,e.SkeletonHelper=Ze,e.SpotLightHelper=Qe,e.VertexNormalsHelper=Je,e.VertexTangentsHelper=$e,e.WireframeHelper=et,e.ImmediateRenderObject=tt,e.MorphBlendMesh=rt,e.AmbientLight=nt,e.AreaLight=at,e.DirectionalLight=ot,e.HemisphereLight=st,e.Light=it,e.PointLight=ht,e.SpotLight=lt,e.BinaryTextureLoader=THREE$BinaryTextureLoader,e.BufferGeometryLoader=ct,e.CompressedTextureLoader=ft,e.GeometryLoader=pt,e.ImageLoader=ae,e.JSONLoader=gt,e.Loader=mt,e.LoadingManager=ne,e.MaterialLoader=vt,e.ObjectLoader=Et,e.TextureLoader=At,e.XHRLoader=ut,e.LineBasicMaterial=Ne,e.LineDashedMaterial=Ct,e.MaterialIdCount=se,e.Material=oe,e.MeshBasicMaterial=he,e.MeshDepthMaterial=Lt,e.MeshFaceMaterial=Rt,e.MeshLambertMaterial=Pt,e.MeshNormalMaterial=Ft,e.MeshPhongMaterial=Ut,e.ParticleSystemMaterial=wt,e.ParticleBasicMaterial=_t,e.PointCloudMaterial=bt,e.RawShaderMaterial=Bt,e.ShaderMaterial=Dt,e.SpriteMaterial=xt,e.Box2=zt,e.Box3=U,e.Color=R,e.Euler=u,e.Frustum=kt,e.Line3=Nt,e.Matrix3=F,e.Matrix4=o,e.Plane=le,e.Quaternion=s,e.Ray=ce,e.Sphere=D,e.Spline=Ot,e.Triangle=ue,e.Vector2=p,e.Vector3=h,e.Vector4=B,e.Bone=It,e.Group=yt,e.LOD=Ht,e.LensFlare=Vt,e.Line=Oe,e.Mesh=de,e.MorphAnimMesh=Wt,e.ParticleSystem=St,e.PointCloud=Mt,e.Skeleton=Gt,e.SkinnedMesh=jt,e.WebGLRenderTarget=m,e.WebGLRenderTargetCube=g,e.WebGLRenderer=Qt,e.WebGLExtensions=Kt,e.WebGLState=Zt,e.WebGLTextures=Jt,e.LensFlarePlugin=Xt,e.ShadowMapPlugin=Yt,e.SpritePlugin=qt,e.Fog=$t,e.FogExp2=er,e.Scene=Tt,e.CompressedTexture=dt,e.CubeTexture=ie,e.DataTexture=re,e.TextureIdCount=te,e.Texture=ee,e.VideoTexture=tr});